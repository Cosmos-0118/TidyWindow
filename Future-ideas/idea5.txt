Registry Optimizer Page — Implementation Blueprint
===================================================

## 1. Goals
- Present every registry tweak with the same guardrails as system Settings (description, safety notes, undo path).
- Handle growth (20+ tweaks) through a paged/catalog UI instead of an unscrollable toggle dump.
- Persist user choices and actual registry state so closing the app never resets toggles.
- Use one execution pipeline that can detect current value, apply the new value, and roll it back per tweak.

## 2. UX & Navigation
1. **Category rail (left)** — stacked tabs for: `Startup & Shell`, `Performance & Gaming`, `Networking`, `Input & Devices`, `Advanced Scripts`.
2. **Catalog page (middle)** — cards/list of tweaks inside the selected category. Each card shows: toggle, short text, "Learn more" link, and status chip (Applied / Not applied / Needs attention).
3. **Details drawer (right)** — opens when a tweak is selected. Contains long description, registry path/value preview, safety level, dependencies, and action buttons (Apply, Revert, Export .reg).
4. **Action log panel (bottom)** — displays the last N operations with timestamps pulled from the automation logger.

Pagination rules:
- If a category has >8 tweaks, split into subpages with a pager control (e.g., `Startup & Shell ▸ Page 1/2`).
- Filter/search box at top filters within current category only.

## 3. Persistence Requirements
- Store toggle intent + last-known registry value in `%AppData%/TidyWindow/registry-optimizer-state.json`.
- Schema per entry: `{ "id": "startup-delay", "category": "startup", "desiredState": "enabled", "detectedState": "applied", "lastRun": "2025-11-22T10:42:30Z", "hash": "sha256 of reg path+value" }`.
- On launch, hydrate UI from the JSON file, then asynchronously re-detect actual registry state to ensure the UI reflects reality.
- Keep the last 20 actions in `%AppData%/TidyWindow/registry-optimizer-history.log` for surface in the action log.

## 4. Data Model & Registry Catalog
Represent tweaks in a reusable JSON/embedded resource (consumed by UI and automation):

```
{
	"id": "startup-delay",
	"title": "Disable Startup Delay",
	"category": "startup",
	"description": "Launch startup programs immediately after sign-in.",
	"impact": "Faster boot experience.",
	"dangerLevel": "low",
	"keys": [
		{
			"hive": "HKCU",
			"path": "Software/ Microsoft/ Windows/ CurrentVersion/ Explorer",
			"name": "StartupDelayInMSec",
			"type": "DWORD",
			"value": "0",
			"default": "1"
		},
		{
			"hive": "HKCU",
			"path": ".../Explorer",
			"name": "WaitForIdleState",
			"type": "DWORD",
			"value": "0",
			"default": "1"
		}
	],
	"scripts": {
		"apply": "automation/registry/auto-end-tasks.ps1 --id startup-delay",
		"revert": "automation/registry/auto-end-tasks.ps1 --id startup-delay --revert"
	},
	"notes": "Requires sign-out to fully apply"
}
```

Primary tweaks to preload (mirrors `newregistoryadditions.txt`):

**Startup & Shell**
- Disable Startup Delay (HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer — `StartupDelayInMSec=0`, `WaitForIdleState=0`).
- Show Seconds on Taskbar Clock (HKCU\...\Explorer\Advanced — `ShowSecondsInSystemClock=1`).
- Last Active Click on Taskbar (HKCU\...\Explorer\Advanced — `LastActiveClick=1`).
- Speed Up Folder Browsing (HKCU\Software\Classes\Local Settings\...\Shell — `FolderType=NotSpecified`).
- Take Ownership Context Menu (bundle reference to .reg script; mark `dangerLevel=medium`).

**Performance & Gaming**
- Win32 Priority Separation (HKLM\SYSTEM\CurrentControlSet\Control\PriorityControl — `Win32PrioritySeparation=0x26`).
- Disable Power Throttling (HKLM\SYSTEM\CurrentControlSet\Control\Power\PowerThrottling — `PowerThrottlingOff=1`).
- Disable CPU Core Parking (HKLM\SYSTEM\ControlSet001\Control\Power\PowerSettings\... — `ValueMax=0`).
- MMCSS System Responsiveness (HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile — `SystemResponsiveness=10`).
- GPU Scheduling Priority (HKLM\...\SystemProfile\Tasks\Games — `Priority=8`, `GPU Priority=8`).
- Disable HPET (special handling: run `bcdedit` commands and show reboot banner afterwards).

**Networking**
- TCP ACK Frequency (HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\{GUID} — `TcpAckFrequency=1`, `TCPNoDelay=1`). Provide NIC picker to resolve `{GUID}`.
- Network Throttling Index (HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile — `NetworkThrottlingIndex=0xffffffff`).
- Tune Network Latency (map to existing script `automation/registry/tune-network-latency.ps1`).

**Input & Devices**
- Keyboard PollStatusIterations (HKLM\SYSTEM\CurrentControlSet\Services\i8042prt\Parameters — `PollStatusIterations=1`).
- Disable USB Selective Suspend (`powercfg` commands); treat as hybrid tweak (registry + powercfg) with success detection via power plan query.

**Advanced Scripts**
- Take Ownership context quick toggle (runs bundled .reg file with backup).
- System verbosity (`VerboseStatus=1`) for debugging; highlight that this writes to HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System.

Every entry must include: `riskLevel`, `requiresReboot`, `supportsRevert`, `testedOn` (list of Windows builds).

## 5. Execution Pipeline
1. **Detection** — before rendering toggle state, call a shared `RegistryStateService` that reads each key/value and emits `Applied`, `Different`, `Missing`. Cache results for 30 seconds.
2. **Apply Flow**
	 - Confirm admin privileges; if missing, show UAC re-launch prompt.
	 - Create a point-in-time backup `.reg` snippet per key and store under `%AppData%/TidyWindow/backups/<tweakId>-yyyyMMddHHmm.reg`.
	 - Invoke PowerShell host (can reuse `automation/modules/TidyWindow.Automation.psm1`) with structured payload describing operations.
	 - Update persistence JSON + add entry to history log.
3. **Revert Flow** — use stored backup when available; otherwise compute revert values from `default` field and reapply.
4. **Conflict Handling** — if detection shows `Different`, surface yellow badge and allow Compare action showing current vs desired values.

## 6. Multi-Page Implementation Notes
- Use MVVM navigation: `RegistryOptimizerView` hosts `CategoryNavView` + `CatalogView` + `DetailsView` components.
- Each category fetches items via query `registryCatalogService.GetByCategory("startup", pageIndex)`.
- Paging metadata lives in catalog dataset (`pageSize`, `displayOrder`).
- When user changes page, persist `lastViewedPage` for that category in state file.

## 7. Testing & Telemetry
- Unit-test registry catalog deserialization + validation (missing fields, duplicate IDs).
- Integration tests for apply/revert using the stub registry provider inside `tests/TidyWindow.Automation.Tests`.
- Instrument action results (success/failure) and send anonymous aggregates through existing telemetry channel (if available) for feature health.

## 8. Delivery Checklist
- [ ] Convert `newregistoryadditions.txt` into structured catalog JSON.
- [ ] Build navigation shell and catalog UI with paging + search.
- [ ] Implement `RegistryStateService` + persistence storage.
- [ ] Wire apply/revert buttons to automation runner with backup + history logging.
- [ ] QA on Windows 10 22H2 and Windows 11 24H2, including reboot-required tweaks.
- [ ] Update docs (`docs/automation.md`) with new registry optimizer behavior and support matrix.

This blueprint replaces the loose idea with a build-ready plan so engineering can immediately start implementing and testing the registry optimizer rework.