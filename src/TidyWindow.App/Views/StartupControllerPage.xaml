<Page x:Class="TidyWindow.App.Views.StartupControllerPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:converters="clr-namespace:TidyWindow.App.Converters"
      xmlns:viewModels="clr-namespace:TidyWindow.App.ViewModels"
      mc:Ignorable="d"
      Title="Startup Controller"
      Background="Transparent"
      UseLayoutRounding="True"
      SnapsToDevicePixels="True"
      TextOptions.TextFormattingMode="Display"
      TextOptions.TextRenderingMode="ClearType"
      TextOptions.TextHintingMode="Fixed"
      RenderOptions.BitmapScalingMode="HighQuality">
    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />

        <LinearGradientBrush x:Key="StartupHeroBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#0A1F36" Offset="0" />
            <GradientStop Color="#0F2F4A" Offset="0.5" />
            <GradientStop Color="#0B3B4D" Offset="1" />
        </LinearGradientBrush>

        <SolidColorBrush x:Key="StartupHeroTitleBrush" Color="#F5F7FF" />
        <SolidColorBrush x:Key="StartupHeroBodyBrush" Color="#C6D4EE" />
        <SolidColorBrush x:Key="StartupMutedBrush" Color="#9CA3AF" />
        <SolidColorBrush x:Key="StartupCardBrush" Color="#0C1424" />
        <SolidColorBrush x:Key="StartupCardBorderBrush" Color="#1B2538" />
        <SolidColorBrush x:Key="StartupBadgeBrush" Color="#103347" />
        <SolidColorBrush x:Key="StartupBadgeForegroundBrush" Color="#7DD3FC" />
        <SolidColorBrush x:Key="StartupWarningBadgeBrush" Color="#3B1D22" />
        <SolidColorBrush x:Key="StartupWarningForegroundBrush" Color="#FBBF24" />
        <SolidColorBrush x:Key="StartupSafeBrush" Color="#10B981" />
        <SolidColorBrush x:Key="StartupDangerBrush" Color="#EF4444" />

        <Style x:Key="HeroTitleTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{StaticResource StartupHeroTitleBrush}" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>

        <Style x:Key="HeroBodyTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="{StaticResource StartupHeroBodyBrush}" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>

        <Style x:Key="PrimaryChipStyle" TargetType="Border">
            <Setter Property="Background" Value="#0E1D33" />
            <Setter Property="BorderBrush" Value="#1D3B58" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="Margin" Value="0,0,10,0" />
        </Style>

        <Style x:Key="FilterToggleStyle" TargetType="ToggleButton">
            <Setter Property="Foreground" Value="#DDE7FF" />
            <Setter Property="Background" Value="#0F1C2F" />
            <Setter Property="BorderBrush" Value="#1F2E46" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="Margin" Value="0,0,10,10" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#134E4A" />
                                <Setter Property="Foreground" Value="#ECFDF3" />
                                <Setter TargetName="Root" Property="BorderBrush" Value="#22C55E" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="BorderBrush" Value="#38BDF8" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.5" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="#07111D" />
            <Setter Property="Padding" Value="16,9" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                CornerRadius="12"
                                Padding="{TemplateBinding Padding}">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#34D399" Offset="0" />
                                    <GradientStop Color="#22C55E" Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.01" ScaleY="1.01" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DangerButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="#0F0A0A" />
            <Setter Property="Padding" Value="16,9" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                CornerRadius="12"
                                Padding="{TemplateBinding Padding}">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#F87171" Offset="0" />
                                    <GradientStop Color="#EF4444" Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.01" ScaleY="1.01" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="OutlineButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="#E2E8F0" />
            <Setter Property="Background" Value="#0E1A2C" />
            <Setter Property="BorderBrush" Value="#1F2E46" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="BorderBrush" Value="#38BDF8" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="StartupStatusBadgeStyle" TargetType="Border">
            <Setter Property="Background" Value="#0F1C2F" />
            <Setter Property="BorderBrush" Value="#1F2E46" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="10,6" />
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsEnabled}" Value="True">
                    <Setter Property="Background" Value="#0F2F25" />
                    <Setter Property="BorderBrush" Value="#22C55E" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsEnabled}" Value="False">
                    <Setter Property="Background" Value="#2C1A1A" />
                    <Setter Property="BorderBrush" Value="#F87171" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="StartupCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource StartupCardBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource StartupCardBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,0,12" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="UseLayoutRounding" Value="True" />
            <Setter Property="MinHeight" Value="170" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="0" Opacity="0" Color="#111827" />
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="#38BDF8" />
                    <Setter Property="BorderThickness" Value="1.5" />
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.25" Color="#38BDF8" />
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <CollectionViewSource x:Key="StartupEntriesView"
                              Source="{Binding Entries}"
                              Filter="OnEntriesFilter" />
    </Page.Resources>

    <Grid>
        <Grid x:Name="ContentHost">
            <Grid.Style>
                <Style TargetType="Grid">
                    <Setter Property="Opacity" Value="1" />
                    <Setter Property="IsHitTestVisible" Value="True" />
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsBusy}" Value="True">
                            <Setter Property="Opacity" Value="0.45" />
                            <Setter Property="IsHitTestVisible" Value="False" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>

            <Grid Margin="24"
                HorizontalAlignment="Stretch">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Border Grid.Row="0"
                    Background="{StaticResource StartupHeroBrush}"
                    Padding="20"
                    CornerRadius="16"
                    BorderThickness="1"
                    BorderBrush="#12314A"
                    Visibility="{Binding ShowStartupHero, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Startup controller" Style="{StaticResource HeroTitleTextStyle}" />
                            <TextBlock Margin="0,6,0,0" Text="Review everything that launches at logon and toggle entries with safety nets and backups." Style="{StaticResource HeroBodyTextStyle}" />
                            <WrapPanel Margin="0,4,0,0">
                                <Border Style="{StaticResource PrimaryChipStyle}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Visible" Foreground="#A5F3FC" FontWeight="SemiBold" />
                                        <TextBlock Margin="6,0,0,0" Text="entries" Foreground="#A5F3FC" />
                                        <TextBlock Margin="6,0,0,0" Text="•" Foreground="#334155" />
                                        <TextBlock Margin="6,0,0,0" Text="{Binding VisibleCount}" Foreground="{StaticResource StartupHeroTitleBrush}" />
                                    </StackPanel>
                                </Border>
                                <Border Style="{StaticResource PrimaryChipStyle}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Disabled" Foreground="#FACC15" FontWeight="SemiBold" />
                                        <TextBlock Margin="6,0,0,0" Text="{Binding DisabledVisibleCount}" Foreground="{StaticResource StartupHeroTitleBrush}" />
                                        <TextBlock Margin="6,0,0,0" Text="/" Foreground="#334155" />
                                        <TextBlock Margin="6,0,0,0" Text="{Binding BaselineDisabledCount}" Foreground="#C7D2FE" />
                                    </StackPanel>
                                </Border>
                                <Border Style="{StaticResource PrimaryChipStyle}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Enabled" Foreground="#34D399" FontWeight="SemiBold" />
                                        <TextBlock Margin="6,0,0,0" Text="{Binding EnabledVisibleCount}" Foreground="{StaticResource StartupHeroTitleBrush}" />
                                    </StackPanel>
                                </Border>
                                <Border Style="{StaticResource PrimaryChipStyle}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Unsigned" Foreground="#F97316" FontWeight="SemiBold" />
                                        <TextBlock Margin="6,0,0,0" Text="{Binding UnsignedVisibleCount}" Foreground="{StaticResource StartupHeroTitleBrush}" />
                                    </StackPanel>
                                </Border>
                                <Border Style="{StaticResource PrimaryChipStyle}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="High impact" Foreground="#FACC15" FontWeight="SemiBold" />
                                        <TextBlock Margin="6,0,0,0" Text="{Binding HighImpactVisibleCount}" Foreground="{StaticResource StartupHeroTitleBrush}" />
                                    </StackPanel>
                                </Border>
                            </WrapPanel>
                        </StackPanel>
                        <StackPanel Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center" Orientation="Horizontal">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" Margin="0,0,10,0">
                                <ProgressBar Width="90" Height="8" IsIndeterminate="True" Foreground="#38BDF8" Background="#0E1C30" BorderBrush="#1F2E46" />
                                <TextBlock Text="Working..." Margin="8,0,0,0" Foreground="#E5E7EB" FontSize="12" VerticalAlignment="Center" />
                            </StackPanel>
                            <ToggleButton Content="Background auto-disable"
                                          Style="{StaticResource FilterToggleStyle}"
                                          Margin="0,0,10,0"
                                          IsChecked="{Binding StartupGuardEnabled, Mode=TwoWay}"
                                          ToolTip="Keeps guarded startup apps disabled automatically in the background (respects Run in background setting)." />
                            <Button Content="Refresh"
                                    Style="{StaticResource OutlineButtonStyle}"
                                    Command="{Binding RefreshCommand}"
                                    Margin="0,0,10,0"
                                    ToolTip="Re-run the inventory; toggles apply immediately." />
                            <TextBlock Text="Toggles apply instantly"
                                       Foreground="#C6D4EE"
                                       FontSize="12"
                                       VerticalAlignment="Center"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,0" />
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Grid.Row="1"
                        Background="#0E1A2C"
                        BorderBrush="#1B2538"
                        BorderThickness="1"
                        CornerRadius="12"
                        Padding="14"
                        Margin="0,16,0,12">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Margin="0,0,0,8">
                            <ToggleButton Content="Show overview"
                                          Style="{StaticResource FilterToggleStyle}"
                                          IsChecked="{Binding ShowStartupHero, Mode=TwoWay}"
                                          ToolTip="Hide the title and counters panel to reclaim space on smaller screens." />
                        </StackPanel>

                        <TextBox x:Name="SearchBox"
                                 Margin="0,0,0,6"
                                 MinWidth="240"
                                 Padding="12,8"
                                 Background="#0E1C30"
                                 BorderBrush="#1F2E46"
                                 BorderThickness="1"
                                 Foreground="#E5E7EB"
                                 CaretBrush="#38BDF8"
                                 TextChanged="OnSearchTextChanged"
                                 ToolTip="Search name, publisher, or path" />
                        <WrapPanel Margin="0,12,0,0">
                            <ToggleButton x:Name="RunFilter"
                                          Content="Run keys"
                                          Style="{StaticResource FilterToggleStyle}"
                                          IsChecked="True"
                                          Checked="OnFilterChanged"
                                          Unchecked="OnFilterChanged" />
                            <ToggleButton x:Name="StartupFilter"
                                          Content="Startup folder"
                                          Style="{StaticResource FilterToggleStyle}"
                                          IsChecked="True"
                                          Checked="OnFilterChanged"
                                          Unchecked="OnFilterChanged" />
                            <ToggleButton x:Name="TasksFilter"
                                          Content="Logon tasks"
                                          Style="{StaticResource FilterToggleStyle}"
                                          IsChecked="True"
                                          Checked="OnFilterChanged"
                                          Unchecked="OnFilterChanged" />
                            <ToggleButton x:Name="ServicesFilter"
                                          Content="Services"
                                          Style="{StaticResource FilterToggleStyle}"
                                          IsChecked="True"
                                          Checked="OnFilterChanged"
                                          Unchecked="OnFilterChanged" />
                            <ToggleButton x:Name="SafeFilter"
                                          Content="Safe to disable"
                                          Style="{StaticResource FilterToggleStyle}"
                                          Checked="OnFilterChanged"
                                          Unchecked="OnFilterChanged" />
                            <ToggleButton x:Name="SystemFilter"
                                          Content="System-critical"
                                          Style="{StaticResource FilterToggleStyle}"
                                          Checked="OnFilterChanged"
                                          Unchecked="OnFilterChanged"
                                          ToolTip="Show only items classified as system-critical (core OS/driver/security)" />
                            <ToggleButton x:Name="UnsignedFilter"
                                          Content="Unsigned"
                                          Style="{StaticResource FilterToggleStyle}"
                                          Checked="OnFilterChanged"
                                          Unchecked="OnFilterChanged" />
                            <ToggleButton x:Name="HighImpactFilter"
                                          Content="High impact"
                                          Style="{StaticResource FilterToggleStyle}"
                                          Checked="OnFilterChanged"
                                          Unchecked="OnFilterChanged" />
                            <ToggleButton x:Name="ShowEnabledFilter"
                                          Content="Show enabled"
                                          Style="{StaticResource FilterToggleStyle}"
                                          IsChecked="True"
                                          Checked="OnFilterChanged"
                                          Unchecked="OnFilterChanged" />
                            <ToggleButton x:Name="ShowDisabledFilter"
                                          Content="Show disabled"
                                          Style="{StaticResource FilterToggleStyle}"
                                          IsChecked="True"
                                          Checked="OnFilterChanged"
                                          Unchecked="OnFilterChanged" />
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <ListView Grid.Row="2"
                          x:Name="EntriesItemsControl"
                          ItemsSource="{Binding PagedEntries}"
                          Loaded="OnEntriesLoaded"
                          Background="Transparent"
                          BorderThickness="0"
                          Padding="0,0,16,0"
                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                          ScrollViewer.CanContentScroll="True"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.IsVirtualizingWhenGrouping="True"
                          VirtualizingPanel.VirtualizationMode="Recycling"
                          VirtualizingPanel.ScrollUnit="Pixel"
                          VirtualizingPanel.CacheLength="4">
                    <ListView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <VirtualizingStackPanel />
                        </ItemsPanelTemplate>
                    </ListView.ItemsPanel>
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="Padding" Value="0" />
                            <Setter Property="Margin" Value="0,0,0,12" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            <Setter Property="Focusable" Value="False" />
                            <Setter Property="MinHeight" Value="170" />
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.ItemTemplate>
                        <DataTemplate DataType="{x:Type viewModels:StartupEntryItemViewModel}">
                            <Border Style="{StaticResource StartupCardStyle}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="SemiBold" Foreground="#E5E7EB" TextWrapping="Wrap" TextTrimming="None" />
                                            <Border Margin="8,0,0,0"
                                                    Background="{StaticResource StartupBadgeBrush}"
                                                    BorderBrush="#1F3B55"
                                                    BorderThickness="1"
                                                    CornerRadius="8"
                                                    Padding="8,4">
                                                <TextBlock Text="{Binding Source}" Foreground="{StaticResource StartupBadgeForegroundBrush}" FontSize="11" FontWeight="SemiBold" TextWrapping="Wrap" TextTrimming="None" />
                                            </Border>
                                            <Border Margin="8,0,0,0"
                                                    Background="{StaticResource StartupBadgeBrush}"
                                                    BorderBrush="#1F3B55"
                                                    BorderThickness="1"
                                                    CornerRadius="8"
                                                    Padding="8,4">
                                                <TextBlock Text="{Binding UserContext}" Foreground="#C7D2FE" FontSize="11" TextWrapping="Wrap" TextTrimming="None" />
                                            </Border>
                                            <Border Margin="8,0,0,0"
                                                    Background="{StaticResource StartupWarningBadgeBrush}"
                                                    BorderBrush="#7C2D12"
                                                    BorderThickness="1"
                                                    CornerRadius="8"
                                                    Padding="8,4"
                                                    Visibility="{Binding IsSystemCritical, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="" FontFamily="Segoe MDL2 Assets" Foreground="{StaticResource StartupWarningForegroundBrush}" FontSize="11" Margin="0,0,4,0" />
                                                    <TextBlock Text="System" Foreground="{StaticResource StartupWarningForegroundBrush}" FontSize="11" FontWeight="SemiBold" />
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                        <TextBlock Margin="0,6,0,0"
                                                   Text="{Binding Publisher}"
                                                   Foreground="#C7D2FE"
                                                   FontSize="12"
                                                   TextWrapping="Wrap"
                                                   TextTrimming="None" />
                                        <TextBlock Margin="0,4,0,0"
                                                   Text="{Binding Item.ExecutablePath}"
                                                   Foreground="{StaticResource StartupMutedBrush}"
                                                   FontSize="11"
                                                   TextWrapping="Wrap"
                                                   TextTrimming="None" />
                                        <TextBlock Margin="0,4,0,0"
                                                   Text="{Binding LastModifiedDisplay}"
                                                   Foreground="#94A3B8"
                                                   FontSize="11" />

                                        <WrapPanel Margin="0,8,0,0">
                                            <Border Margin="0,0,6,6" Background="#102A43" Padding="8,4" CornerRadius="8" BorderBrush="#1E3A5F" BorderThickness="1">
                                                <TextBlock Text="{Binding Item.SignatureStatus}" Foreground="#7DD3FC" FontSize="11" />
                                            </Border>
                                            <Border Margin="0,0,6,6" Background="#13233A" Padding="8,4" CornerRadius="8" BorderBrush="#233553" BorderThickness="1">
                                                <TextBlock Text="{Binding Impact}" Foreground="#C084FC" FontSize="11" />
                                            </Border>
                                            <Border Margin="0,0,6,6" Background="#10243A" Padding="8,4" CornerRadius="8" BorderBrush="#1E3A5F" BorderThickness="1">
                                                <TextBlock Text="{Binding Item.EntryLocation}" Foreground="#E0F2FE" FontSize="11" TextWrapping="Wrap" />
                                            </Border>
                                        </WrapPanel>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Right">
                                        <Border Style="{StaticResource StartupStatusBadgeStyle}" HorizontalAlignment="Right">
                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                <Ellipse Width="8" Height="8" Fill="#34D399" VerticalAlignment="Center"
                                                         Visibility="{Binding IsEnabled, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                                <Ellipse Width="8" Height="8" Fill="#F87171" VerticalAlignment="Center"
                                                         Visibility="{Binding IsEnabled, Converter={StaticResource InverseBooleanToVisibilityConverter}}" />
                                                <TextBlock Text="Enabled"
                                                           Margin="6,0,0,0"
                                                           FontWeight="SemiBold"
                                                           Foreground="#DCFCE7"
                                                           Visibility="{Binding IsEnabled, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                                <TextBlock Text="Disabled"
                                                           Margin="6,0,0,0"
                                                           FontWeight="SemiBold"
                                                           Foreground="#FEE2E2"
                                                           Visibility="{Binding IsEnabled, Converter={StaticResource InverseBooleanToVisibilityConverter}}" />
                                            </StackPanel>
                                        </Border>

                                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0" HorizontalAlignment="Right">
                                            <Button Content="Enable"
                                                    Style="{StaticResource PrimaryButtonStyle}"
                                                    Command="{Binding DataContext.EnableCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                    CommandParameter="{Binding}" />
                                            <Button Content="Disable"
                                                    Margin="8,0,0,0"
                                                    Style="{StaticResource DangerButtonStyle}"
                                                    Command="{Binding DataContext.DisableCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                    CommandParameter="{Binding}" />
                                        </StackPanel>

                                        <ToggleButton Content="Auto-keep disabled"
                                                  Margin="0,10,0,0"
                                                  Style="{StaticResource FilterToggleStyle}"
                                                  IsChecked="{Binding IsAutoGuardEnabled, Mode=TwoWay}"
                                                  Checked="OnGuardToggled"
                                                  Unchecked="OnGuardToggled"
                                                  ToolTip="If the app re-enables itself, TidyWindow will disable it again on refresh." />

                                        <Button Content="Delay 45s"
                                                Margin="0,12,0,0"
                                                Style="{StaticResource OutlineButtonStyle}"
                                                Command="{Binding DataContext.DelayCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                CommandParameter="{Binding}"
                                                ToolTip="Defers this user-scope entry to a delayed logon task"
                                                IsEnabled="{Binding CanDelay}" />
                                        <ProgressBar Height="6"
                                                     Width="160"
                                                     IsIndeterminate="True"
                                                     Margin="0,10,0,0"
                                                     Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

            </Grid>
        </Grid>

                <Grid Background="#E60B1629"
                            Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Panel.ZIndex="10">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <ProgressBar Width="160" Height="10" IsIndeterminate="True" Foreground="#38BDF8" Background="#0E1C30" BorderBrush="#1F2E46" />
                                <TextBlock Text="Loading startup apps..."
                                                     Margin="0,10,0,0"
                                                     Foreground="#E5E7EB"
                                                     FontSize="13"
                                                     HorizontalAlignment="Center" />
                        </StackPanel>
                </Grid>

        <!-- Floating pager overlay for navigation without shrinking content -->
        <Border HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Margin="24"
            Padding="10,8"
            Background="#0E1A2C"
            BorderBrush="{StaticResource StartupCardBorderBrush}"
            BorderThickness="1"
            CornerRadius="10"
            Panel.ZIndex="6"
            Visibility="{Binding HasMultiplePages, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border.Effect>
                <DropShadowEffect BlurRadius="12"
                                   ShadowDepth="0"
                                   Opacity="0.25"
                                   Color="#000000" />
            </Border.Effect>
            <StackPanel Orientation="Horizontal"
                VerticalAlignment="Center">
            <TextBlock Text="{Binding PageDisplay}"
                   Foreground="#C6D4EE"
                   FontSize="12"
                   VerticalAlignment="Center" />
            <StackPanel Orientation="Horizontal"
                    Margin="12,0,0,0">
                <Button Content="Previous"
                    Command="{Binding GoToPreviousPageCommand}"
                    Style="{StaticResource OutlineButtonStyle}"
                    Padding="12,6"
                    Margin="0,0,8,0"
                    IsEnabled="{Binding CanGoToPreviousPage}" />
                <Button Content="Next"
                    Command="{Binding GoToNextPageCommand}"
                    Style="{StaticResource PrimaryButtonStyle}"
                    Padding="12,6"
                    IsEnabled="{Binding CanGoToNextPage}" />
            </StackPanel>
            </StackPanel>
        </Border>

    </Grid>
</Page>
