<Page x:Class="TidyWindow.App.Views.InstallHubPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="clr-namespace:TidyWindow.App.Converters"
            xmlns:controls="clr-namespace:TidyWindow.App.Views"
            xmlns:loaders="clr-namespace:TidyWindow.App.Controls.Loaders"
      xmlns:viewModels="clr-namespace:TidyWindow.App.ViewModels"
      xmlns:views="clr-namespace:TidyWindow.App.Views"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    mc:Ignorable="d"
    Title="Install hub"
    Background="Transparent"
    UseLayoutRounding="True"
    SnapsToDevicePixels="True"
    TextOptions.TextFormattingMode="Display"
    TextOptions.TextRenderingMode="ClearType"
    TextOptions.TextHintingMode="Fixed"
    RenderOptions.BitmapScalingMode="HighQuality">
    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="InstallHubResources.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <SineEase x:Key="InstallHubPivotEaseIn" EasingMode="EaseOut"/>
            <SineEase x:Key="InstallHubPivotEaseOut" EasingMode="EaseIn"/>

            <Style x:Key="InstallHubPivotContentBaseStyle"
                   TargetType="FrameworkElement">
                <Setter Property="Opacity" Value="0"/>
                <Setter Property="Visibility" Value="Collapsed"/>
                <Setter Property="IsHitTestVisible" Value="False"/>
                <Setter Property="Panel.ZIndex" Value="0"/>
                <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                <Setter Property="RenderTransform">
                    <Setter.Value>
                        <TranslateTransform Y="12"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="InstallHubBundlesViewStyle"
                   TargetType="views:InstallHubBundlesView"
                   BasedOn="{StaticResource InstallHubPivotContentBaseStyle}">
                <Style.Triggers>
                    <DataTrigger Value="True">
                        <DataTrigger.Binding>
                            <Binding Path="DataContext.CurrentPivot"
                                     RelativeSource="{RelativeSource AncestorType={x:Type Page}}"
                                     Converter="{StaticResource EnumEqualsConverter}"
                                     ConverterParameter="{x:Static viewModels:CurrentInstallHubPivot.Bundles}"/>
                        </DataTrigger.Binding>
                        <Setter Property="Panel.ZIndex" Value="1"/>
                        <Setter Property="IsHitTestVisible" Value="True"/>
                        <DataTrigger.EnterActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                        <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                                    </ObjectAnimationUsingKeyFrames>
                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                     From="0"
                                                     To="1"
                                                     Duration="0:0:0.18"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseIn}"/>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                     From="12"
                                                     To="0"
                                                     Duration="0:0:0.18"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseIn}"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.EnterActions>
                        <DataTrigger.ExitActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                     To="0"
                                                     Duration="0:0:0.16"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseOut}"/>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                     To="12"
                                                     Duration="0:0:0.16"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseOut}"/>
                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                        <DiscreteObjectKeyFrame KeyTime="0:0:0.16" Value="{x:Static Visibility.Collapsed}"/>
                                    </ObjectAnimationUsingKeyFrames>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.ExitActions>
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="InstallHubCatalogViewStyle"
                   TargetType="views:InstallHubCatalogView"
                   BasedOn="{StaticResource InstallHubPivotContentBaseStyle}">
                <Style.Triggers>
                    <DataTrigger Value="True">
                        <DataTrigger.Binding>
                            <Binding Path="DataContext.CurrentPivot"
                                     RelativeSource="{RelativeSource AncestorType={x:Type Page}}"
                                     Converter="{StaticResource EnumEqualsConverter}"
                                     ConverterParameter="{x:Static viewModels:CurrentInstallHubPivot.Catalog}"/>
                        </DataTrigger.Binding>
                        <Setter Property="Panel.ZIndex" Value="1"/>
                        <Setter Property="IsHitTestVisible" Value="True"/>
                        <DataTrigger.EnterActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                        <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                                    </ObjectAnimationUsingKeyFrames>
                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                     From="0"
                                                     To="1"
                                                     Duration="0:0:0.18"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseIn}"/>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                     From="12"
                                                     To="0"
                                                     Duration="0:0:0.18"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseIn}"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.EnterActions>
                        <DataTrigger.ExitActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                     To="0"
                                                     Duration="0:0:0.16"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseOut}"/>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                     To="12"
                                                     Duration="0:0:0.16"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseOut}"/>
                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                        <DiscreteObjectKeyFrame KeyTime="0:0:0.16" Value="{x:Static Visibility.Collapsed}"/>
                                    </ObjectAnimationUsingKeyFrames>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.ExitActions>
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="InstallHubQueueViewStyle"
                   TargetType="views:InstallHubQueueView"
                   BasedOn="{StaticResource InstallHubPivotContentBaseStyle}">
                <Style.Triggers>
                    <DataTrigger Value="True">
                        <DataTrigger.Binding>
                            <Binding Path="DataContext.CurrentPivot"
                                     RelativeSource="{RelativeSource AncestorType={x:Type Page}}"
                                     Converter="{StaticResource EnumEqualsConverter}"
                                     ConverterParameter="{x:Static viewModels:CurrentInstallHubPivot.Queue}"/>
                        </DataTrigger.Binding>
                        <Setter Property="Panel.ZIndex" Value="1"/>
                        <Setter Property="IsHitTestVisible" Value="True"/>
                        <DataTrigger.EnterActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                        <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                                    </ObjectAnimationUsingKeyFrames>
                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                     From="0"
                                                     To="1"
                                                     Duration="0:0:0.18"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseIn}"/>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                     From="12"
                                                     To="0"
                                                     Duration="0:0:0.18"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseIn}"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.EnterActions>
                        <DataTrigger.ExitActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                     To="0"
                                                     Duration="0:0:0.16"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseOut}"/>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                     To="12"
                                                     Duration="0:0:0.16"
                                                     EasingFunction="{StaticResource InstallHubPivotEaseOut}"/>
                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                        <DiscreteObjectKeyFrame KeyTime="0:0:0.16" Value="{x:Static Visibility.Collapsed}"/>
                                    </ObjectAnimationUsingKeyFrames>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.ExitActions>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </ResourceDictionary>
    </Page.Resources>

    <Grid>
        <Grid.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#040714" Offset="0"/>
                <GradientStop Color="#060C1C" Offset="0.45"/>
                <GradientStop Color="#071427" Offset="1"/>
            </LinearGradientBrush>
        </Grid.Background>
        <ScrollViewer Margin="32"
                  Panel.ZIndex="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      HorizontalContentAlignment="Stretch"
                      PanningMode="VerticalOnly">
            <Grid MaxWidth="1360"
                  HorizontalAlignment="Center">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <controls:PageTitleBar Grid.Row="0"
                                       Title="Smart install hub"
                                       Subtitle="Curate developer bundles"
                                       IconGlyph="ðŸ“¦"
                                       Margin="0,0,0,28">
                    <controls:PageTitleBar.BodyContent>
                        <StackPanel>
                            <TextBlock Text="{Binding Headline}"
                                       Foreground="#E2E8F0"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       TextWrapping="Wrap"/>
                            <TextBlock Text="Choose a pivot to focus on bundles, the catalog, or your install queue."
                                       Foreground="#94A3B8"
                                       FontSize="12"
                                       Margin="0,6,0,0"
                                       TextWrapping="Wrap"/>
                            <WrapPanel Margin="0,16,0,0"
                                       ItemHeight="Auto"
                                       ItemWidth="Auto"
                                       MinWidth="0">
                                <ToggleButton Content="Bundles"
                                              Margin="0,0,12,12"
                                              Style="{StaticResource InstallHubPivotButtonStyle}"
                                              Command="{Binding NavigatePivotCommand}"
                                              CommandParameter="{x:Static viewModels:CurrentInstallHubPivot.Bundles}"
                                              IsChecked="{Binding CurrentPivot, Converter={StaticResource EnumEqualsConverter}, ConverterParameter={x:Static viewModels:CurrentInstallHubPivot.Bundles}}"/>
                                <ToggleButton Content="Catalog"
                                              Margin="0,0,12,12"
                                              Style="{StaticResource InstallHubPivotButtonStyle}"
                                              Command="{Binding NavigatePivotCommand}"
                                              CommandParameter="{x:Static viewModels:CurrentInstallHubPivot.Catalog}"
                                              IsChecked="{Binding CurrentPivot, Converter={StaticResource EnumEqualsConverter}, ConverterParameter={x:Static viewModels:CurrentInstallHubPivot.Catalog}}"/>
                                <ToggleButton Content="Queue"
                                              Margin="0,0,12,12"
                                              Style="{StaticResource InstallHubPivotButtonStyle}"
                                              Command="{Binding NavigatePivotCommand}"
                                              CommandParameter="{x:Static viewModels:CurrentInstallHubPivot.Queue}"
                                              IsChecked="{Binding CurrentPivot, Converter={StaticResource EnumEqualsConverter}, ConverterParameter={x:Static viewModels:CurrentInstallHubPivot.Queue}}"/>
                            </WrapPanel>
                        </StackPanel>
                    </controls:PageTitleBar.BodyContent>
                </controls:PageTitleBar>

                <Grid Grid.Row="1">
                    <views:InstallHubBundlesView Style="{StaticResource InstallHubBundlesViewStyle}"/>
                    <views:InstallHubCatalogView Style="{StaticResource InstallHubCatalogViewStyle}"/>
                    <views:InstallHubQueueView Style="{StaticResource InstallHubQueueViewStyle}"/>
                </Grid>
            </Grid>
        </ScrollViewer>

        <loaders:InstallHubLoader Panel.ZIndex="6"
                                  IsActive="{Binding IsLoading}"
                                  HorizontalAlignment="Stretch"
                                  VerticalAlignment="Stretch"/>
    </Grid>
</Page>
