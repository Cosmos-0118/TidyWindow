<Page x:Class="TidyWindow.App.Views.EssentialsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:controls="clr-namespace:TidyWindow.App.Views"
      xmlns:converters="clr-namespace:TidyWindow.App.Converters"
      xmlns:viewModels="clr-namespace:TidyWindow.App.ViewModels"
    xmlns:ux="clr-namespace:TidyWindow.App.Controls"
    mc:Ignorable="d"
    Title="Essentials"
    Background="Transparent"
    UseLayoutRounding="True"
    SnapsToDevicePixels="True"
    TextOptions.TextFormattingMode="Display"
    TextOptions.TextRenderingMode="ClearType"
    TextOptions.TextHintingMode="Fixed"
    RenderOptions.BitmapScalingMode="HighQuality">
    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:EnumEqualsConverter x:Key="EnumEqualsConverter"/>
        <converters:AlternationIndexToBrushConverter x:Key="HighlightBrushConverter"/>

        <LinearGradientBrush x:Key="EssentialsBackdropBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#050914" Offset="0"/>
            <GradientStop Color="#081126" Offset="0.5"/>
            <GradientStop Color="#0A162C" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="EssentialsPrimaryBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#B572FF" Offset="0"/>
            <GradientStop Color="#7C3AED" Offset="1"/>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="EssentialsPrimaryHoverBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#C084FC" Offset="0"/>
            <GradientStop Color="#8B5CF6" Offset="1"/>
        </LinearGradientBrush>
        <SolidColorBrush x:Key="EssentialsPrimaryDisabledBrush" Color="#1E1E2E"/>
        <SolidColorBrush x:Key="EssentialsHeroTitleBrush" Color="#FDFEFE"/>
        <SolidColorBrush x:Key="EssentialsHeroSubtitleBrush" Color="#C8D6F6"/>
        <SolidColorBrush x:Key="EssentialsMutedTextBrush" Color="#9DA9C6"/>

        <Style x:Key="EssentialsHeroTitleTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource EssentialsHeroTitleBrush}"/>
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>

        <Style x:Key="EssentialsHeroBodyTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="{StaticResource EssentialsHeroSubtitleBrush}"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>

        <SineEase x:Key="EssentialsPivotEaseIn" EasingMode="EaseOut"/>
        <SineEase x:Key="EssentialsPivotEaseOut" EasingMode="EaseInOut"/>

        <Style x:Key="EssentialsAccentButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource EssentialsPrimaryBrush}"/>
            <Setter Property="Foreground" Value="#F8FAFC"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="18,10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="MinWidth" Value="112"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="12" ShadowDepth="0" Color="#662C1F4A"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="{StaticResource EssentialsPrimaryHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#6D28D9"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Background" Value="{StaticResource EssentialsPrimaryDisabledBrush}"/>
                                <Setter Property="Foreground" Value="#6B7280"/>
                                <Setter Property="Effect" Value="{x:Null}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="EssentialsSecondaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#111B33"/>
            <Setter Property="Foreground" Value="#E2E8F0"/>
            <Setter Property="BorderBrush" Value="#243552"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="MinWidth" Value="108"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#182448"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#0F1729"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Background" Value="#0B1120"/>
                                <Setter Property="Foreground" Value="#475569"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="EssentialsDialogCloseButtonStyle" TargetType="Button">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#1C2438" Offset="0"/>
                        <GradientStop Color="#11182B" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderBrush" Value="#2F3F60"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="#E5EDFF"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="MinWidth" Value="96"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="12" ShadowDepth="0" Color="#5510122A" Opacity="0.65"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="14"
                                Padding="{TemplateBinding Padding}">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                  <Path Data="M4,4 L10,10 M10,4 L4,10"
                                      StrokeThickness="1.8"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"
                                      Stroke="{TemplateBinding Foreground}"
                                      Margin="0,0,6,0"/>
                                <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#1F2C48"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#0B1220"/>
                                <Setter Property="Foreground" Value="#C7D2FE"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55"/>
                                <Setter Property="Effect" Value="{x:Null}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="EssentialsCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#0F1B30"/>
            <Setter Property="BorderBrush" Value="#1E2E46"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="UseLayoutRounding" Value="True"/>
            <Setter Property="RenderOptions.BitmapScalingMode" Value="HighQuality"/>
            <Setter Property="CacheMode">
                <Setter.Value>
                    <BitmapCache EnableClearType="True"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="EssentialsPivotToggleStyle" TargetType="ToggleButton">
            <Setter Property="Margin" Value="8,0,8,0"/>
            <Setter Property="Padding" Value="18,10"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="#0F1A2F"/>
            <Setter Property="Foreground" Value="#E2E8F0"/>
            <Setter Property="BorderBrush" Value="#263654"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="12"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#7C3AED"/>
                                <Setter Property="Foreground" Value="#F8FAFC"/>
                                <Setter TargetName="Root" Property="BorderBrush" Value="#C084FC"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="BorderBrush" Value="#7DD3FC"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="EssentialsPivotContentBaseStyle" TargetType="FrameworkElement">
            <Setter Property="Opacity" Value="0"/>
            <Setter Property="Visibility" Value="Collapsed"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
            <Setter Property="Panel.ZIndex" Value="0"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <TranslateTransform Y="14"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="EssentialsTasksPivotStyle" TargetType="FrameworkElement" BasedOn="{StaticResource EssentialsPivotContentBaseStyle}">
            <Style.Triggers>
                <DataTrigger Value="True">
                    <DataTrigger.Binding>
                        <Binding Path="DataContext.CurrentPivot"
                                 RelativeSource="{RelativeSource AncestorType={x:Type Page}}"
                                 Converter="{StaticResource EnumEqualsConverter}"
                                 ConverterParameter="{x:Static viewModels:EssentialsPivot.Tasks}"/>
                    </DataTrigger.Binding>
                    <Setter Property="Panel.ZIndex" Value="1"/>
                    <Setter Property="IsHitTestVisible" Value="True"/>
                    <DataTrigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                                </ObjectAnimationUsingKeyFrames>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                 From="0"
                                                 To="1"
                                                 Duration="0:0:0.22"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseIn}"/>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                 From="14"
                                                 To="0"
                                                 Duration="0:0:0.22"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseIn}"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.EnterActions>
                    <DataTrigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                 To="0"
                                                 Duration="0:0:0.18"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseOut}"/>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                 To="14"
                                                 Duration="0:0:0.18"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseOut}"/>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                    <DiscreteObjectKeyFrame KeyTime="0:0:0.18" Value="{x:Static Visibility.Collapsed}"/>
                                </ObjectAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.ExitActions>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="EssentialsQueuePivotStyle" TargetType="FrameworkElement" BasedOn="{StaticResource EssentialsPivotContentBaseStyle}">
            <Style.Triggers>
                <DataTrigger Value="True">
                    <DataTrigger.Binding>
                        <Binding Path="DataContext.CurrentPivot"
                                 RelativeSource="{RelativeSource AncestorType={x:Type Page}}"
                                 Converter="{StaticResource EnumEqualsConverter}"
                                 ConverterParameter="{x:Static viewModels:EssentialsPivot.Queue}"/>
                    </DataTrigger.Binding>
                    <Setter Property="Panel.ZIndex" Value="1"/>
                    <Setter Property="IsHitTestVisible" Value="True"/>
                    <DataTrigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                                </ObjectAnimationUsingKeyFrames>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                 From="0"
                                                 To="1"
                                                 Duration="0:0:0.22"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseIn}"/>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                 From="14"
                                                 To="0"
                                                 Duration="0:0:0.22"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseIn}"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.EnterActions>
                    <DataTrigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                 To="0"
                                                 Duration="0:0:0.18"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseOut}"/>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                 To="14"
                                                 Duration="0:0:0.18"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseOut}"/>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                    <DiscreteObjectKeyFrame KeyTime="0:0:0.18" Value="{x:Static Visibility.Collapsed}"/>
                                </ObjectAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.ExitActions>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="EssentialsSettingsPivotStyle" TargetType="FrameworkElement" BasedOn="{StaticResource EssentialsPivotContentBaseStyle}">
            <Style.Triggers>
                <DataTrigger Value="True">
                    <DataTrigger.Binding>
                        <Binding Path="DataContext.CurrentPivot"
                                 RelativeSource="{RelativeSource AncestorType={x:Type Page}}"
                                 Converter="{StaticResource EnumEqualsConverter}"
                                 ConverterParameter="{x:Static viewModels:EssentialsPivot.Settings}"/>
                    </DataTrigger.Binding>
                    <Setter Property="Panel.ZIndex" Value="1"/>
                    <Setter Property="IsHitTestVisible" Value="True"/>
                    <DataTrigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                    <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                                </ObjectAnimationUsingKeyFrames>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                 From="0"
                                                 To="1"
                                                 Duration="0:0:0.22"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseIn}"/>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                 From="14"
                                                 To="0"
                                                 Duration="0:0:0.22"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseIn}"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.EnterActions>
                    <DataTrigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                 To="0"
                                                 Duration="0:0:0.18"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseOut}"/>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.Y)"
                                                 To="14"
                                                 Duration="0:0:0.18"
                                                 EasingFunction="{StaticResource EssentialsPivotEaseOut}"/>
                                <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                    <DiscreteObjectKeyFrame KeyTime="0:0:0.18" Value="{x:Static Visibility.Collapsed}"/>
                                </ObjectAnimationUsingKeyFrames>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.ExitActions>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="EssentialsTaskListItemStyle" TargetType="ListBoxItem">
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border Background="Transparent"
                                CornerRadius="14"
                                Padding="0">
                            <ContentPresenter/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="EssentialsSettingsHeaderTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#F8FAFC"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType"/>
        </Style>

        <Style x:Key="EssentialsSettingsSubtitleTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#94A3B8"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType"/>
        </Style>

        <Style x:Key="EssentialsSettingsToggleStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="52"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Background" Value="#1F2937"/>
            <Setter Property="BorderBrush" Value="#1F2937"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Grid>
                            <Border x:Name="Track"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="#334155"
                                    BorderThickness="1"
                                    CornerRadius="14"/>
                            <Ellipse x:Name="Thumb"
                                     Width="22"
                                     Height="22"
                                     Fill="#F8FAFC"
                                     Margin="4,3,26,3"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Track" Property="Background" Value="#7C3AED"/>
                                <Setter TargetName="Track" Property="BorderBrush" Value="#7C3AED"/>
                                <Setter TargetName="Thumb" Property="Margin" Value="26,3,4,3"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Track" Property="Background" Value="#1F2937"/>
                                <Setter TargetName="Track" Property="BorderBrush" Value="#1F2937"/>
                                <Setter TargetName="Thumb" Property="Fill" Value="#475569"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Track" Property="BorderBrush" Value="#7C3AED"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="EssentialsAutomationTaskCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#121E35"/>
            <Setter Property="BorderBrush" Value="#1F2F4C"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="14"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.Background>
            <StaticResource ResourceKey="EssentialsBackdropBrush"/>
        </Grid.Background>

        <ScrollViewer Margin="32"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      HorizontalContentAlignment="Stretch"
                      PanningMode="VerticalOnly">
            <Grid MaxWidth="1320"
                  HorizontalAlignment="Center">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <controls:PageTitleBar Grid.Row="0"
                                       Title="Essentials automation"
                                       Subtitle="{Binding Headline}"
                                       IconGlyph="ðŸ‘‘"
                                       BadgeText="Core automations"
                                       Margin="0,0,0,28">
                    <controls:PageTitleBar.BodyContent>
                        <StackPanel>
                            <TextBlock Text="Curate high-impact repairs, then pivot into the live queue when you need status or transcripts."
                                       FontSize="13"
                                       Foreground="#94A3B8"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </controls:PageTitleBar.BodyContent>
                </controls:PageTitleBar>

                <Border Grid.Row="1"
                        Style="{StaticResource EssentialsCardStyle}"
                        Padding="14"
                        Margin="0,0,0,18">
                    <StackPanel>
                        <TextBlock Text="Switch views"
                                   FontSize="12"
                                   Foreground="#8CA0BF"
                                   Margin="0,0,0,10"/>
                        <UniformGrid Columns="3" HorizontalAlignment="Stretch">
                            <ToggleButton Content="Task shelf"
                                          Padding="16,10"
                                          MinHeight="42"
                                          FontWeight="SemiBold"
                                          Style="{StaticResource EssentialsPivotToggleStyle}"
                                          Command="{Binding NavigatePivotCommand}"
                                          CommandParameter="{x:Static viewModels:EssentialsPivot.Tasks}"
                                          IsChecked="{Binding CurrentPivot, Converter={StaticResource EnumEqualsConverter}, ConverterParameter={x:Static viewModels:EssentialsPivot.Tasks}}"/>
                            <ToggleButton Content="Queue + output"
                                          Padding="16,10"
                                          MinHeight="42"
                                          FontWeight="SemiBold"
                                          Style="{StaticResource EssentialsPivotToggleStyle}"
                                          Command="{Binding NavigatePivotCommand}"
                                          CommandParameter="{x:Static viewModels:EssentialsPivot.Queue}"
                                          IsChecked="{Binding CurrentPivot, Converter={StaticResource EnumEqualsConverter}, ConverterParameter={x:Static viewModels:EssentialsPivot.Queue}}"/>
                            <ToggleButton Content="Automation settings"
                                          Padding="16,10"
                                          MinHeight="42"
                                          FontWeight="SemiBold"
                                          Style="{StaticResource EssentialsPivotToggleStyle}"
                                          Command="{Binding NavigatePivotCommand}"
                                          CommandParameter="{x:Static viewModels:EssentialsPivot.Settings}"
                                          IsChecked="{Binding CurrentPivot, Converter={StaticResource EnumEqualsConverter}, ConverterParameter={x:Static viewModels:EssentialsPivot.Settings}}"/>
                        </UniformGrid>
                    </StackPanel>
                </Border>

                <Grid Grid.Row="2">
                    <Grid>
                        <Grid.Resources>
                            <Thickness x:Key="CardSpacing" xml:space="preserve">0,24,0,0</Thickness>
                        </Grid.Resources>

                        <StackPanel Style="{StaticResource EssentialsTasksPivotStyle}">
                            <Border Style="{StaticResource EssentialsCardStyle}" Padding="28">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Zero-guesswork maintenance"
                                                   Style="{StaticResource EssentialsHeroTitleTextStyle}"/>
                                        <TextBlock Text="Run curated repair flows with contextual tips, options, and links to deeper docs."
                                                   Style="{StaticResource EssentialsHeroBodyTextStyle}"
                                                   Margin="0,8,0,0"/>
                                        <WrapPanel Margin="0,18,0,0">
                                            <Border Background="#13233E"
                                                    CornerRadius="8"
                                                    Padding="10,4"
                                                    Margin="0,0,12,12"
                                                    BorderBrush="#1E3454"
                                                    BorderThickness="1">
                                                <TextBlock Text="Curated shortcuts"
                                                           Foreground="{StaticResource EssentialsHeroSubtitleBrush}"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"/>
                                            </Border>
                                            <Border Background="#13233E"
                                                    CornerRadius="8"
                                                    Padding="10,4"
                                                    Margin="0,0,12,12"
                                                    BorderBrush="#1E3454"
                                                    BorderThickness="1">
                                                <TextBlock Text="Live telemetry"
                                                           Foreground="{StaticResource EssentialsHeroSubtitleBrush}"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"/>
                                            </Border>
                                            <Border Background="#13233E"
                                                    CornerRadius="8"
                                                    Padding="10,4"
                                                    Margin="0,0,12,12"
                                                    BorderBrush="#1E3454"
                                                    BorderThickness="1">
                                                <TextBlock Text="Guided decisions"
                                                           Foreground="{StaticResource EssentialsHeroSubtitleBrush}"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"/>
                                            </Border>
                                        </WrapPanel>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <Border Style="{StaticResource EssentialsCardStyle}" Margin="{StaticResource CardSpacing}">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch">
                                        <StackPanel>
                                            <TextBlock Text="Maintenance essentials"
                                                     Style="{StaticResource EssentialsHeroTitleTextStyle}"
                                                     FontSize="18"/>
                                            <TextBlock Text="Queue trusted automations with one click"
                                                     Style="{StaticResource EssentialsHeroBodyTextStyle}"
                                                     FontSize="12"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <StackPanel Orientation="Vertical"
                                                Margin="0,18,0,0">
                                        <TextBlock Text="Smart search"
                                                   FontSize="12"
                                                   Foreground="#8CA0BF"
                                                   Margin="0,0,0,6"/>
                                        <Border Background="#0E1930"
                                                BorderBrush="#1F2F4C"
                                                BorderThickness="1"
                                                CornerRadius="10"
                                                Padding="12,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0"
                                                           Text="ðŸ”"
                                                           FontSize="14"
                                                           VerticalAlignment="Center"
                                                           Margin="0,0,8,0"/>
                                                <TextBox Grid.Column="1"
                                                         BorderThickness="0"
                                                         Background="Transparent"
                                                         Foreground="#E2E8F0"
                                                         FontSize="13"
                                                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged, Delay=150}"
                                                         ToolTip="Type any symptom, category, or partial name to find a repair."/>
                                            </Grid>
                                        </Border>
                                    </StackPanel>

                                    <ListBox x:Name="TasksListBox"
                                             Margin="0,24,0,0"
                                             ItemsSource="{Binding TasksView}"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             ScrollViewer.VerticalScrollBarVisibility="Disabled"
                                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                             SelectionMode="Single"
                                             ItemContainerStyle="{StaticResource EssentialsTaskListItemStyle}">
                                        <ListBox.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <ux:AdaptiveTilePanel MinColumnWidth="320"
                                                                      MaxColumnWidth="420"
                                                                      ColumnSpacing="24"
                                                                      RowSpacing="24"/>
                                            </ItemsPanelTemplate>
                                        </ListBox.ItemsPanel>
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#101E33"
                                                        BorderBrush="#1E3454"
                                                        BorderThickness="1"
                                                        CornerRadius="14"
                                                        Padding="20">
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>

                                                        <StackPanel>
                                                            <TextBlock Text="{Binding Title}"
                                                                       FontSize="15"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="#E2E8F0"/>
                                                            <WrapPanel Margin="0,6,0,0">
                                                                <Border Background="#182842"
                                                                        CornerRadius="6"
                                                                        Padding="6,2"
                                                                        Margin="0,0,10,0">
                                                                    <TextBlock Text="{Binding Category}"
                                                                               FontSize="11"
                                                                               Foreground="#9DB4D3"/>
                                                                </Border>
                                                                <Border Background="{Binding StatusChipBrush}"
                                                                        CornerRadius="10"
                                                                        Padding="10,2"
                                                                        Visibility="{Binding HasStatusChip, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                    <TextBlock Text="{Binding StatusChipLabel}"
                                                                               FontSize="11"
                                                                               FontWeight="SemiBold"
                                                                               Foreground="#020617"/>
                                                                </Border>
                                                            </WrapPanel>

                                                            <TextBlock Text="{Binding Summary}"
                                                                       Margin="0,8,0,0"
                                                                       Foreground="#9FB0C7"
                                                                       FontSize="12"
                                                                       TextWrapping="Wrap"/>

                                                            <TextBlock Text="{Binding DurationSummary}"
                                                                       Margin="0,8,0,0"
                                                                       Foreground="#E2E8F0"
                                                                       FontSize="12">
                                                                <TextBlock.Style>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding DurationSummary}" Value="{x:Null}">
                                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding DurationSummary}" Value="">
                                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </TextBlock.Style>
                                                            </TextBlock>

                                                            <ux:SimpleProgressBar Margin="0,12,0,0"
                                                                                  Value="{Binding ProgressValue}"
                                                                                  Maximum="1"
                                                                                  StatusText="{Binding ProgressStatusText}"
                                                                                  FillBrush="{StaticResource EssentialsPrimaryBrush}"
                                                                                  TrackBrush="#081224"
                                                                                  TextForeground="#F8FAFC"
                                                                                  Visibility="{Binding HasProgress, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                                                            <ItemsControl ItemsSource="{Binding Highlights}"
                                                                          Margin="0,12,0,0"
                                                                          AlternationCount="5">
                                                                <ItemsControl.ItemsPanel>
                                                                    <ItemsPanelTemplate>
                                                                        <WrapPanel/>
                                                                    </ItemsPanelTemplate>
                                                                </ItemsControl.ItemsPanel>
                                                                <ItemsControl.ItemTemplate>
                                                                    <DataTemplate>
                                                                        <Border CornerRadius="10"
                                                                                Padding="8,4"
                                                                                Margin="0,0,8,8"
                                                                                Background="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(ItemsControl.AlternationIndex), Converter={StaticResource HighlightBrushConverter}}">
                                                                            <TextBlock Text="{Binding}"
                                                                                       Foreground="#F8FAFC"
                                                                                       FontSize="12"
                                                                                       FontWeight="SemiBold"/>
                                                                        </Border>
                                                                    </DataTemplate>
                                                                </ItemsControl.ItemTemplate>
                                                            </ItemsControl>

                                                        </StackPanel>

                                                        <StackPanel Grid.Row="1"
                                                                    Margin="0,18,0,0">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>

                                                                <Button Grid.Column="0"
                                                                        Padding="10,4"
                                                                        Command="{Binding DataContext.ShowTaskDetailsCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                                        CommandParameter="{Binding}">
                                                                    <Button.Style>
                                                                        <Style TargetType="Button" BasedOn="{StaticResource EssentialsSecondaryButtonStyle}">
                                                                            <Setter Property="Content" Value="Details"/>
                                                                            <Setter Property="MinWidth" Value="96"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding DetailedDescription}" Value="{x:Null}">
                                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                                </DataTrigger>
                                                                                <DataTrigger Binding="{Binding DetailedDescription}" Value="">
                                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Button.Style>
                                                                </Button>

                                                                <Button Grid.Column="1"
                                                                        Margin="12,0,0,0"
                                                                        Padding="14,6"
                                                                        Content="Run"
                                                                    Command="{Binding DataContext.PrepareTaskRunCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                                        CommandParameter="{Binding}"
                                                                    Style="{StaticResource EssentialsAccentButtonStyle}"/>
                                                            </Grid>
                                                        </StackPanel>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <StackPanel Style="{StaticResource EssentialsQueuePivotStyle}">
                            <Border Style="{StaticResource EssentialsCardStyle}" Padding="28">
                                <StackPanel>
                                    <TextBlock Text="Queue monitor"
                                               FontSize="20"
                                               FontWeight="SemiBold"
                                               Foreground="#F8FAFC"/>
                                    <TextBlock Text="Retry failed jobs, cancel live ones, and inspect transcripts without leaving the tab."
                                               Margin="0,6,0,0"
                                               Foreground="#9DB4D3"
                                               FontSize="13"
                                               TextWrapping="Wrap"/>
                                    <WrapPanel Margin="0,18,0,0">
                                        <Border Background="#13233E"
                                                CornerRadius="8"
                                                Padding="10,4"
                                                Margin="0,0,12,12"
                                                BorderBrush="#1E3454"
                                                BorderThickness="1">
                                            <TextBlock Text="{Binding Operations.Count, StringFormat={}{0} entries}"
                                                       Foreground="#CBD5F5"
                                                       FontSize="12"
                                                       FontWeight="SemiBold"/>
                                        </Border>
                                        <Border Background="#122737"
                                                CornerRadius="8"
                                                Padding="10,4"
                                                Margin="0,0,12,12"
                                                BorderBrush="#244157"
                                                BorderThickness="1"
                                                Visibility="{Binding HasActiveOperations, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <TextBlock Text="Active runs"
                                                       Foreground="#38BDF8"
                                                       FontSize="12"
                                                       FontWeight="SemiBold"/>
                                        </Border>
                                    </WrapPanel>
                                    <StackPanel Orientation="Horizontal"
                                                Margin="0,12,0,0">
                                        <Button Content="Retry failed"
                                                Command="{Binding RetryFailedCommand}"
                                                Style="{StaticResource EssentialsAccentButtonStyle}"
                                                MinWidth="112"/>
                                        <Button Content="Clear completed"
                                                Command="{Binding ClearCompletedCommand}"
                                                Style="{StaticResource EssentialsSecondaryButtonStyle}"
                                                Margin="12,0,0,0"
                                                MinWidth="112"/>
                                    </StackPanel>
                                        <Button Content="Stop old process"
                                            Command="{Binding StopActiveRunCommand}"
                                            Style="{StaticResource EssentialsAccentButtonStyle}"
                                            Background="#B91C1C"
                                            Margin="0,12,0,0"
                                            MinWidth="112"
                                            Visibility="{Binding HasActiveOperations, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource EssentialsCardStyle}" Margin="{StaticResource CardSpacing}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <ListView x:Name="OperationsListView"
                                              Grid.Row="1"
                                              ItemsSource="{Binding Operations}"
                                              SelectedItem="{Binding SelectedOperation, Mode=TwoWay}"
                                              Background="Transparent"
                                              BorderThickness="0"
                                              Foreground="#F8FAFC"
                                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                                              ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                              VirtualizingPanel.IsVirtualizing="True"
                                              VirtualizingPanel.VirtualizationMode="Recycling"
                                              VirtualizingStackPanel.ScrollUnit="Pixel">
                                        <ListView.ItemContainerStyle>
                                            <Style TargetType="ListViewItem">
                                                <Setter Property="Margin" Value="0,0,0,18"/>
                                                <Setter Property="Padding" Value="0"/>
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                            </Style>
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#0F2137"
                                                        BorderBrush="#1E3454"
                                                        BorderThickness="1"
                                                        CornerRadius="14"
                                                        Padding="18">
                                                    <StackPanel>
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <StackPanel>
                                                                <StackPanel Orientation="Horizontal">
                                                                    <TextBlock Text="{Binding TaskName}"
                                                                               FontWeight="SemiBold"
                                                                               FontSize="15"/>
                                                                    <Border x:Name="StatusChip"
                                                                            Margin="10,0,0,0"
                                                                            Padding="8,3"
                                                                            CornerRadius="8"
                                                                            Background="#13233E"
                                                                            BorderBrush="#1E3454"
                                                                            BorderThickness="1"
                                                                            ToolTip="{Binding Message}">
                                                                        <TextBlock x:Name="StatusChipLabel"
                                                                                   Text="{Binding StatusLabel}"
                                                                                   FontSize="11"
                                                                                   FontWeight="SemiBold"
                                                                                   Foreground="#E2E8F0"/>
                                                                        <Border.Style>
                                                                            <Style TargetType="Border">
                                                                                <Setter Property="Background" Value="#13233E"/>
                                                                                <Setter Property="BorderBrush" Value="#1E3454"/>
                                                                                <Setter Property="BorderThickness" Value="1"/>
                                                                                <Setter Property="TextElement.Foreground" Value="#E2E8F0"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding HasErrors}" Value="True">
                                                                                        <Setter Property="Background" Value="#3B1F2B"/>
                                                                                        <Setter Property="BorderBrush" Value="#E11D48"/>
                                                                                        <Setter Property="TextElement.Foreground" Value="#FEE2E2"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding IsCancellationRequested}" Value="True">
                                                                                        <Setter Property="Background" Value="#3A2C1A"/>
                                                                                        <Setter Property="BorderBrush" Value="#F59E0B"/>
                                                                                        <Setter Property="TextElement.Foreground" Value="#FEF3C7"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                                                        <Setter Property="Background" Value="#0E243D"/>
                                                                                        <Setter Property="BorderBrush" Value="#38BDF8"/>
                                                                                        <Setter Property="TextElement.Foreground" Value="#E0F2FE"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding StatusLabel}" Value="Completed">
                                                                                        <Setter Property="Background" Value="#0F2E23"/>
                                                                                        <Setter Property="BorderBrush" Value="#22C55E"/>
                                                                                        <Setter Property="TextElement.Foreground" Value="#DCFCE7"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding StatusLabel}" Value="Queued">
                                                                                        <Setter Property="Background" Value="#132A3F"/>
                                                                                        <Setter Property="BorderBrush" Value="#60A5FA"/>
                                                                                        <Setter Property="TextElement.Foreground" Value="#DBEAFE"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </Border.Style>
                                                                    </Border>
                                                                </StackPanel>
                                                                <TextBlock Text="{Binding StatusLabel}"
                                                                           Margin="0,4,0,0"
                                                                           Foreground="#38BDF8"
                                                                           FontSize="12"/>
                                                                <StackPanel Orientation="Horizontal"
                                                                            Margin="0,8,0,0">
                                                                    <TextBlock Text="{Binding AttemptLabel}"
                                                                               Foreground="#94A3B8"
                                                                               FontSize="11">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding AttemptLabel}" Value="{x:Null}">
                                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding AttemptLabel}" Value="">
                                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                    <TextBlock Text="{Binding CompletedAt, StringFormat={}{0:G}}"
                                                                               Foreground="#5F6B84"
                                                                               FontSize="11"
                                                                               Margin="12,0,0,0">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource Self}}" Value="">
                                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource Self}}" Value="{x:Null}">
                                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                </StackPanel>
                                                            </StackPanel>

                                                            <StackPanel Grid.Column="1"
                                                                        Orientation="Horizontal"
                                                                        HorizontalAlignment="Right"
                                                                        VerticalAlignment="Top">
                                                                <Button Command="{Binding DataContext.ShowOperationOutputCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                                        CommandParameter="{Binding}"
                                                                        Padding="14,6"
                                                                        MinWidth="124">
                                                                    <Button.Content>
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <TextBlock Text="Show output" FontWeight="SemiBold"/>
                                                                            <TextBlock Text=">" Margin="10,0,0,0" Opacity="0.8"/>
                                                                        </StackPanel>
                                                                    </Button.Content>
                                                                    <Button.Style>
                                                                        <Style TargetType="Button" BasedOn="{StaticResource EssentialsAccentButtonStyle}"/>
                                                                    </Button.Style>
                                                                </Button>
                                                                <Button Margin="12,0,0,0"
                                                                        Padding="10,4"
                                                                        MinWidth="96"
                                                                        Command="{Binding DataContext.CancelOperationCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                                        CommandParameter="{Binding}"
                                                                        Visibility="{Binding IsActive, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                                        IsEnabled="{Binding CanCancel}">
                                                                    <Button.Style>
                                                                        <Style TargetType="Button" BasedOn="{StaticResource EssentialsSecondaryButtonStyle}">
                                                                            <Setter Property="Content" Value="Cancel"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding IsCancellationRequested}" Value="True">
                                                                                    <Setter Property="Content" Value="Stopping..."/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Button.Style>
                                                                </Button>
                                                            </StackPanel>
                                                        </Grid>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>

                                    <TextBlock Grid.Row="1"
                                               Text="Nothing in the queue yet. Queue a task to see live output."
                                               HorizontalAlignment="Center"
                                               Margin="0,24,0,0"
                                               Foreground="#7A869C"
                                               FontSize="12">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Operations.Count}" Value="0">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Grid>
                            </Border>
                        </StackPanel>

                        <StackPanel Style="{StaticResource EssentialsSettingsPivotStyle}"
                                    DataContext="{Binding Automation}">
                            <Border Style="{StaticResource EssentialsCardStyle}" Padding="28" Margin="0,0,0,24">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Text="Automation runway"
                                                   Style="{StaticResource EssentialsSettingsHeaderTextStyle}"/>
                                        <ToggleButton Margin="12,0,0,0"
                                                      Style="{StaticResource EssentialsSettingsToggleStyle}"
                                                      IsChecked="{Binding IsAutomationEnabled, Mode=TwoWay}"/>
                                    </StackPanel>
                                    <TextBlock Text="{Binding StatusMessage}"
                                               Style="{StaticResource EssentialsSettingsSubtitleTextStyle}"
                                               Margin="0,6,0,16"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <TextBlock Text="Interval"
                                                   Width="80"
                                                   Foreground="#94A3B8"/>
                                        <ComboBox Width="180"
                                                  ItemsSource="{Binding IntervalOptions}"
                                                  SelectedValuePath="Minutes"
                                                  SelectedValue="{Binding IntervalMinutes, Mode=TwoWay}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Label}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </StackPanel>
                                    <Border Background="#2F1F4D"
                                            CornerRadius="8"
                                            Padding="10,6"
                                            Margin="0,0,0,16"
                                            Visibility="{Binding HasPendingChanges, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <TextBlock Text="Pending changes will take effect when you press apply."
                                                   Foreground="#C084FC"
                                                   FontWeight="SemiBold"/>
                                    </Border>
                                    <WrapPanel>
                                        <Button Content="Apply &amp; queue now"
                                                Style="{StaticResource EssentialsAccentButtonStyle}"
                                                Command="{Binding ApplyAutomationCommand}"
                                                Margin="0,0,12,12"/>
                                        <Button Content="Run now"
                                                Style="{StaticResource EssentialsSecondaryButtonStyle}"
                                                Command="{Binding RunAutomationNowCommand}"
                                                Margin="0,0,0,12"/>
                                    </WrapPanel>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource EssentialsCardStyle}" Padding="28">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Text="Task selection"
                                                   Style="{StaticResource EssentialsSettingsHeaderTextStyle}"/>
                                        <Border Background="#1B2A44"
                                                Padding="10,4"
                                                CornerRadius="10"
                                                Margin="12,0,0,0">
                                            <TextBlock Text="{Binding SelectionSummary}"
                                                       Foreground="#C8D6F6"
                                                       FontSize="12"
                                                       FontWeight="SemiBold"/>
                                        </Border>
                                    </StackPanel>
                                    <TextBlock Text="Choose the flows that should run automatically. TidyWindow queues them sequentially to stay battery-friendly."
                                               Style="{StaticResource EssentialsSettingsSubtitleTextStyle}"
                                               Margin="0,6,0,18"/>
                                    <ItemsControl ItemsSource="{Binding TaskOptions}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <ux:AdaptiveTilePanel MinColumnWidth="320"
                                                                      MaxColumnWidth="420"
                                                                      ColumnSpacing="18"
                                                                      RowSpacing="18"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Style="{StaticResource EssentialsAutomationTaskCardStyle}">
                                                    <StackPanel>
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                                      VerticalAlignment="Center"
                                                                      Margin="0,0,10,0"/>
                                                            <StackPanel>
                                                                <TextBlock Text="{Binding Title}"
                                                                           FontSize="15"
                                                                           FontWeight="SemiBold"
                                                                           Foreground="#F8FAFC"/>
                                                                <WrapPanel Margin="0,4,0,0"
                                                                           VerticalAlignment="Center">
                                                                    <Border Background="#1B2A44"
                                                                            BorderBrush="#243552"
                                                                            BorderThickness="1"
                                                                            CornerRadius="6"
                                                                            Padding="8,2">
                                                                        <TextBlock Text="{Binding Category}"
                                                                                   Foreground="#94A3B8"
                                                                                   FontSize="12"/>
                                                                    </Border>
                                                                    <Border Background="#0F2E23"
                                                                            BorderBrush="#16A34A"
                                                                            BorderThickness="1"
                                                                            CornerRadius="6"
                                                                            Padding="8,2"
                                                                            Margin="8,0,0,0"
                                                                            Visibility="{Binding IsRecommended, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                                            ToolTip="Reliable to run on a schedule; pairs well with other maintenance flows.">
                                                                        <TextBlock Text="Recommended"
                                                                                   Foreground="#BBF7D0"
                                                                                   FontSize="12"
                                                                                   FontWeight="SemiBold"/>
                                                                    </Border>
                                                                </WrapPanel>
                                                            </StackPanel>
                                                        </StackPanel>
                                                        <TextBlock Text="{Binding Summary}"
                                                                   Margin="0,8,0,0"
                                                                   Foreground="#B4C4E0"
                                                                   TextWrapping="Wrap"/>
                                                        <TextBlock Text="{Binding DurationHint}"
                                                                   Margin="0,6,0,0"
                                                                   Foreground="#7DD3FC"
                                                                   FontSize="12">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding DurationHint}" Value="">
                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding DurationHint}" Value="{x:Null}">
                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                        <WrapPanel Margin="0,12,0,0">
                                                            <Button Content="Configure includes"
                                                                    Style="{StaticResource EssentialsSecondaryButtonStyle}"
                                                                    Padding="10,4"
                                                                    MinWidth="140"
                                                                    Command="{Binding DataContext.ConfigureAutomationTaskCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                                    CommandParameter="{Binding}"/>
                                                        </WrapPanel>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Grid>
        </ScrollViewer>

        <Grid x:Name="EssentialsTaskDetailsOverlay"
              Panel.ZIndex="6"
              Background="#B0020617"
              Visibility="{Binding IsTaskDetailsVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
              IsHitTestVisible="{Binding IsTaskDetailsVisible}">
            <Border MaxWidth="780"
                    Margin="32"
                    Padding="30"
                    Background="#0B1729"
                    BorderBrush="#24344F"
                    BorderThickness="1"
                    CornerRadius="26"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <DockPanel Margin="0,0,0,18"
                               LastChildFill="False">
                        <StackPanel DockPanel.Dock="Left">
                            <TextBlock Text="{Binding DetailsTask.Title, TargetNullValue=Task details}"
                                       FontSize="20"
                                       FontWeight="SemiBold"
                                       Foreground="#F8FAFC"
                                       TextWrapping="Wrap"/>
                            <StackPanel Orientation="Horizontal"
                                        Margin="0,10,0,0">
                                <Border Background="#192B45"
                                        CornerRadius="8"
                                        Padding="8,3">
                                    <TextBlock Text="{Binding DetailsTask.Category}"
                                               Foreground="#9DB4D3"
                                               FontSize="12"
                                               FontWeight="SemiBold"/>
                                </Border>
                                <Border Margin="10,0,0,0"
                                        Background="#17253E"
                                        CornerRadius="10"
                                        Padding="10,3">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding DetailsTask.DurationHint}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding DetailsTask.DurationHint}" Value="">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding DetailsTask.DurationHint}"
                                               Foreground="#FACC15"
                                               FontSize="11"
                                               FontWeight="SemiBold"/>
                                </Border>
                            </StackPanel>
                            <TextBlock Text="{Binding DetailsTask.Summary}"
                                       Margin="0,10,0,0"
                                       Foreground="#9FB0C7"
                                       FontSize="13"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </DockPanel>

                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="What this automation covers"
                                   Foreground="#9DB4D3"
                                   FontWeight="SemiBold"
                                   FontSize="13"/>

                        <ScrollViewer Grid.Row="1"
                                      Margin="0,12,0,0"
                                      Padding="0,0,14,0"
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled"
                                      MaxHeight="480">
                            <ScrollViewer.Style>
                                <Style TargetType="ScrollViewer">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding DetailsTask}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ScrollViewer.Style>
                            <StackPanel DataContext="{Binding DetailsTask}">
                                <TextBlock Text="{Binding DetailedDescription, TargetNullValue=No additional details available.}"
                                           Foreground="#E2E8F0"
                                           FontSize="13"
                                           TextWrapping="Wrap"/>

                                <ItemsControl ItemsSource="{Binding Highlights}"
                                              Margin="0,18,0,0"
                                              AlternationCount="5">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="10"
                                                    Padding="8,4"
                                                    Margin="0,0,10,10"
                                                    Background="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(ItemsControl.AlternationIndex), Converter={StaticResource HighlightBrushConverter}}">
                                                <TextBlock Text="{Binding}"
                                                           Foreground="#F8FAFC"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"/>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <StackPanel Margin="0,18,0,0"
                                            Visibility="{Binding HasOptions, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock Text="Option snapshot"
                                               Foreground="#9DB4D3"
                                               FontSize="12"
                                               FontWeight="SemiBold"/>
                                    <ItemsControl ItemsSource="{Binding Options}"
                                                  Margin="0,10,0,0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#101C32"
                                                        BorderBrush="#1E2F4B"
                                                        BorderThickness="1"
                                                        CornerRadius="10"
                                                        Padding="10"
                                                        Margin="0,0,0,10">
                                                    <StackPanel>
                                                        <StackPanel Orientation="Horizontal"
                                                                    VerticalAlignment="Center">
                                                            <Border Padding="8,2"
                                                                    CornerRadius="8"
                                                                    Margin="0,0,8,0">
                                                                <Border.Style>
                                                                    <Style TargetType="Border">
                                                                        <Setter Property="Background" Value="#2C1A10"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding IsEnabled}" Value="True">
                                                                                <Setter Property="Background" Value="#0F2B1B"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Border.Style>
                                                                <TextBlock FontSize="11"
                                                                           FontWeight="SemiBold">
                                                                    <TextBlock.Style>
                                                                        <Style TargetType="TextBlock">
                                                                            <Setter Property="Foreground" Value="#F97316"/>
                                                                            <Setter Property="Text" Value="Skipped"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding IsEnabled}" Value="True">
                                                                                    <Setter Property="Foreground" Value="#22C55E"/>
                                                                                    <Setter Property="Text" Value="Enabled"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </TextBlock.Style>
                                                                </TextBlock>
                                                            </Border>
                                                            <TextBlock Text="{Binding Label}"
                                                                       Foreground="#E2E8F0"
                                                                       FontWeight="SemiBold"/>
                                                        </StackPanel>
                                                        <TextBlock Text="{Binding Description}"
                                                                   Margin="0,8,0,0"
                                                                   Foreground="#9FB0C7"
                                                                   FontSize="12"
                                                                   TextWrapping="Wrap"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                                <Border Margin="0,18,0,0"
                                        Background="#091528"
                                        BorderBrush="#152238"
                                        BorderThickness="1"
                                        CornerRadius="12"
                                        Padding="12">
                                    <StackPanel>
                                        <TextBlock Text="Latest run status"
                                                   Foreground="#9DB4D3"
                                                   FontSize="12"
                                                   FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding LastStatus, TargetNullValue=No history yet.}"
                                                   Foreground="#E2E8F0"
                                                   FontSize="12"
                                                   Margin="0,6,0,0"
                                                   TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            <Button Content="Close"
                                Command="{Binding DataContext.CloseTaskDetailsCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                Style="{StaticResource EssentialsDialogCloseButtonStyle}"
                                Padding="12,6"
                                MinWidth="120"
                                Margin="0,18,8,0"
                                HorizontalAlignment="Right"/>
                            </StackPanel>
                        </ScrollViewer>

                        <TextBlock Grid.Row="1"
                                   Text="Select a task to inspect."
                                   Foreground="#94A3B8"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   FontSize="13">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding DetailsTask}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>
                </Grid>
            </Border>
        </Grid>

        <Grid x:Name="OperationOutputOverlay"
              Panel.ZIndex="9"
              Background="#B0020617"
              Visibility="{Binding IsOutputDialogVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
              IsHitTestVisible="{Binding IsOutputDialogVisible}">
            <Border MaxWidth="900"
                    Margin="32"
                    Padding="28"
                    Background="#0B1729"
                    BorderBrush="#24344F"
                    BorderThickness="1"
                    CornerRadius="26"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <DockPanel Margin="0,0,0,18">
                        <StackPanel DockPanel.Dock="Left">
                            <TextBlock Text="{Binding OutputDialogTitle}"
                                       FontSize="20"
                                       FontWeight="SemiBold"
                                       Foreground="#F8FAFC"
                                       TextWrapping="Wrap"/>
                            <TextBlock Text="{Binding OutputDialogOperation.StatusLabel}"
                                       Margin="0,6,0,0"
                                       Foreground="#9FB0C7"
                                       FontSize="12"
                                       TextWrapping="Wrap"/>
                            <TextBlock Text="{Binding OutputDialogOperation.Message}"
                                       Margin="0,6,0,0"
                                       Foreground="#B4C4E0"
                                       FontSize="12"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </DockPanel>

                    <Border Grid.Row="1"
                            Background="#0A162C"
                            BorderBrush="#1E2F4B"
                            BorderThickness="1"
                            CornerRadius="12"
                            Padding="12">
                        <Grid>
                            <ScrollViewer VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Disabled"
                                          MaxHeight="520">
                                <ItemsControl ItemsSource="{Binding OutputDialogOperation.DisplayLines}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}"
                                                       FontFamily="Consolas"
                                                       FontSize="12"
                                                       Foreground="#E2E8F0"
                                                       Margin="0,2"
                                                       TextWrapping="Wrap"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                            <TextBlock Text="No output yet."
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Foreground="#5F6B84"
                                       FontSize="12">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding OutputDialogOperation}" Value="{x:Null}">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding OutputDialogOperation.DisplayLines.Count, TargetNullValue=0}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>
                    </Border>

                    <StackPanel Grid.Row="2"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,18,0,0">
                        <Button Content="Copy output"
                                Command="{Binding CopyOperationOutputCommand}"
                                Style="{StaticResource EssentialsSecondaryButtonStyle}"
                                Padding="12,6"
                                MinWidth="120"/>
                        <Button Content="Close"
                                Command="{Binding CloseOutputDialogCommand}"
                                Style="{StaticResource EssentialsAccentButtonStyle}"
                                Padding="14,6"
                                MinWidth="120"
                                Margin="12,0,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <Grid x:Name="RestoreGuardOverlay"
              Panel.ZIndex="8"
              Margin="32"
              Background="#C0081324"
              Visibility="{Binding IsRestoreGuardDialogVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
              IsHitTestVisible="{Binding IsRestoreGuardDialogVisible}">
            <Border MaxWidth="600"
                    Padding="28"
                    Background="#111B2A"
                    BorderBrush="#374151"
                    BorderThickness="1"
                    CornerRadius="26"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="28"
                                      ShadowDepth="0"
                                      Opacity="0.35"
                                      Color="#111827"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="{Binding RestoreGuardHeadline}"
                               FontSize="20"
                               FontWeight="SemiBold"
                               Foreground="#FDE68A"
                               TextWrapping="Wrap"/>
                    <TextBlock Text="{Binding RestoreGuardBody}"
                               Margin="0,10,0,0"
                               Foreground="#E2E8F0"
                               FontSize="13"
                               TextWrapping="Wrap"/>
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,22,0,0">
                        <Button Content="{Binding RestoreGuardSecondaryActionLabel}"
                                Command="{Binding DismissRestoreGuardCommand}"
                                Style="{StaticResource EssentialsSecondaryButtonStyle}"
                                Padding="12,6"
                                MinWidth="120"/>
                        <Button Content="{Binding RestoreGuardPrimaryActionLabel}"
                                Command="{Binding LaunchRestoreGuardTaskCommand}"
                                Margin="12,0,0,0"
                                Style="{StaticResource EssentialsAccentButtonStyle}"
                                Padding="14,6"
                                MinWidth="160"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <Grid x:Name="EssentialsRunDialogOverlay"
              Panel.ZIndex="7"
              Background="#B0020617"
              Visibility="{Binding IsRunDialogVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
              IsHitTestVisible="{Binding IsRunDialogVisible}">
            <Border MaxWidth="760"
                    Margin="32"
                    Padding="30"
                    Background="#0B1729"
                    BorderBrush="#24344F"
                    BorderThickness="1"
                    CornerRadius="26"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel DataContext="{Binding PendingRunTask}">
                        <TextBlock Text="Configure run"
                                   FontSize="12"
                                   Foreground="#94A3B8"
                                   FontWeight="SemiBold"/>
                        <StackPanel Orientation="Horizontal"
                                    Margin="0,6,0,0"
                                    VerticalAlignment="Center">
                            <StackPanel>
                                <TextBlock Text="{Binding Title, TargetNullValue=Select a task}" 
                                           FontSize="20"
                                           FontWeight="SemiBold"
                                           Foreground="#F8FAFC"
                                           TextWrapping="Wrap"/>
                                <TextBlock Text="{Binding Summary}"
                                           Margin="0,6,0,0"
                                           Foreground="#9FB0C7"
                                           FontSize="13"
                                           TextWrapping="Wrap"/>
                                <TextBlock Text="{Binding DurationSummary}"
                                           Margin="0,6,0,0"
                                           Foreground="#E2E8F0"
                                           FontSize="12">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding DurationSummary}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding DurationSummary}" Value="">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <ScrollViewer Grid.Row="1"
                                  Margin="0,20,0,0"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  MaxHeight="500">
                        <StackPanel DataContext="{Binding PendingRunTask}">
                            <ItemsControl ItemsSource="{Binding Highlights}"
                                          Margin="0,0,0,16"
                                          AlternationCount="5">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border CornerRadius="10"
                                                Padding="8,4"
                                                Margin="0,0,8,8"
                                                Background="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(ItemsControl.AlternationIndex), Converter={StaticResource HighlightBrushConverter}}">
                                            <TextBlock Text="{Binding}"
                                                       Foreground="#F8FAFC"
                                                       FontSize="12"
                                                       FontWeight="SemiBold"/>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <StackPanel Margin="0,0,0,16"
                                        Visibility="{Binding IsDefenderTask, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="Scan options"
                                           Foreground="#94A3B8"
                                           FontSize="12"/>
                                <WrapPanel Margin="0,8,0,0">
                                    <CheckBox Style="{StaticResource App.CheckBoxStyle}"
                                              Content="Run full scan"
                                              IsChecked="{Binding UseFullScan}"
                                              Foreground="#E2E8F0"
                                              Margin="0,0,12,8"/>
                                    <CheckBox Style="{StaticResource App.CheckBoxStyle}"
                                              Content="Skip signature update"
                                              IsChecked="{Binding SkipSignatureUpdate}"
                                              Foreground="#E2E8F0"
                                              Margin="0,0,12,8"/>
                                    <CheckBox Style="{StaticResource App.CheckBoxStyle}"
                                              Content="Skip real-time heal"
                                              IsChecked="{Binding SkipRealtimeHeal}"
                                              Foreground="#E2E8F0"
                                              Margin="0,0,12,8"/>
                                    <CheckBox Style="{StaticResource App.CheckBoxStyle}"
                                              Content="Skip service repair"
                                              IsChecked="{Binding SkipServiceHeal}"
                                              Foreground="#E2E8F0"
                                              Margin="0,0,12,8"/>
                                    <CheckBox Style="{StaticResource App.CheckBoxStyle}"
                                              Content="Skip threat scan"
                                              IsChecked="{Binding SkipThreatScan}"
                                              Foreground="#E2E8F0"
                                              Margin="0,0,12,8"/>
                                </WrapPanel>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,16"
                                        Visibility="{Binding HasOptions, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="Additional options"
                                           Foreground="#94A3B8"
                                           FontSize="12"/>
                                <ItemsControl ItemsSource="{Binding Options}"
                                              Margin="0,8,0,0">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <CheckBox Style="{StaticResource App.CheckBoxStyle}"
                                                      Content="{Binding Label}"
                                                      ToolTip="{Binding Description}"
                                                      IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                                      Foreground="#E2E8F0"
                                                      Margin="0,0,12,8"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <StackPanel Margin="0,4,0,0"
                                            Visibility="{Binding ShouldShowLocalePresetPicker, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock Text="Locale reset preset"
                                               Foreground="#C8D6F6"
                                               FontSize="12"
                                               FontWeight="SemiBold"/>
                                    <TextBlock Text="Pick what to apply when locale/language reset is enabled. Default keeps current settings."
                                               Foreground="#8CA0BF"
                                               FontSize="12"
                                               Margin="0,4,0,8"
                                               TextWrapping="Wrap"/>
                                    <Border Background="#0E1930"
                                            BorderBrush="#1F2F4C"
                                            BorderThickness="1"
                                            CornerRadius="10"
                                            Padding="6">
                                        <ListBox ItemsSource="{Binding LocalePresets}"
                                                 SelectedItem="{Binding SelectedLocalePreset, Mode=TwoWay}"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Padding="4"
                                                 MaxHeight="260"
                                                 ScrollViewer.VerticalScrollBarVisibility="Auto">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Margin="0,0,0,10">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Border Width="24"
                                                                Height="24"
                                                                CornerRadius="12"
                                                                VerticalAlignment="Center">
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Setter Property="Background" Value="#0F1F36"/>
                                                                    <Setter Property="BorderBrush" Value="#1F2F4C"/>
                                                                    <Setter Property="BorderThickness" Value="1"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                                                                            <Setter Property="Background" Value="#7C3AED"/>
                                                                            <Setter Property="BorderBrush" Value="#C084FC"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>
                                                            <TextBlock Text="îœ¾"
                                                                       FontFamily="Segoe MDL2 Assets"
                                                                       FontSize="14"
                                                                       HorizontalAlignment="Center"
                                                                       VerticalAlignment="Center">
                                                                <TextBlock.Style>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter Property="Foreground" Value="#7C3AED"/>
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                                <Setter Property="Foreground" Value="#F8FAFC"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </TextBlock.Style>
                                                            </TextBlock>
                                                        </Border>

                                                        <Border Grid.Column="1"
                                                                Background="#101C32"
                                                                BorderBrush="#1E2F4B"
                                                                BorderThickness="1"
                                                                CornerRadius="10"
                                                                Padding="10,8"
                                                                Margin="10,0,0,0">
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Setter Property="Opacity" Value="0.92"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                                                                            <Setter Property="BorderBrush" Value="#7C3AED"/>
                                                                            <Setter Property="Opacity" Value="1"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                                                                            <Setter Property="BorderBrush" Value="#C084FC"/>
                                                                            <Setter Property="Background" Value="#17233A"/>
                                                                            <Setter Property="Opacity" Value="1"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>
                                                            <StackPanel>
                                                                <TextBlock Text="{Binding Name}"
                                                                           Foreground="#E2E8F0"
                                                                           FontWeight="SemiBold"/>
                                                                <TextBlock Text="{Binding Caption}"
                                                                           Foreground="#9FB0C7"
                                                                           FontSize="12"
                                                                           Margin="0,4,0,0"/>
                                                                <TextBlock Text="{Binding Description}"
                                                                           Foreground="#7DD3FC"
                                                                           FontSize="11"
                                                                           Margin="0,4,0,0"
                                                                           TextWrapping="Wrap"/>
                                                            </StackPanel>
                                                        </Border>
                                                    </Grid>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                            <ListBox.ItemContainerStyle>
                                                <Style TargetType="ListBoxItem">
                                                    <Setter Property="Padding" Value="0"/>
                                                    <Setter Property="Background" Value="Transparent"/>
                                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                    <Setter Property="BorderThickness" Value="0"/>
                                                    <Setter Property="SnapsToDevicePixels" Value="True"/>
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="ListBoxItem">
                                                                <Border Background="{TemplateBinding Background}">
                                                                    <ContentPresenter/>
                                                                </Border>
                                                                <ControlTemplate.Triggers>
                                                                    <Trigger Property="IsSelected" Value="True">
                                                                        <Setter Property="Foreground" Value="#F8FAFC"/>
                                                                    </Trigger>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter Property="Background" Value="#111D35"/>
                                                                    </Trigger>
                                                                </ControlTemplate.Triggers>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                            </ListBox.ItemContainerStyle>
                                        </ListBox>
                                    </Border>

                                    <TextBlock Text="Selected"
                                               Foreground="#8CA0BF"
                                               FontSize="12"
                                               Margin="0,10,0,2"/>
                                    <TextBlock Text="{Binding SelectedLocalePreset.Name}"
                                               Foreground="#F8FAFC"
                                               FontWeight="SemiBold"
                                               FontSize="12"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </StackPanel>

                            <TextBlock Text="No configurable options for this automation."
                                       Foreground="#64748B"
                                       FontSize="12">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding HasOptions}" Value="False"/>
                                                    <Condition Binding="{Binding IsDefenderTask}" Value="False"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </ScrollViewer>

                    <StackPanel Grid.Row="2"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,24,0,0">
                        <Button Content="Cancel"
                                Command="{Binding CloseRunDialogCommand}"
                                Style="{StaticResource EssentialsSecondaryButtonStyle}"
                                Padding="12,6"
                                MinWidth="120"/>
                        <Button Content="{Binding RunDialogPrimaryButtonLabel}"
                            Margin="12,0,0,0"
                            Padding="14,6"
                            MinWidth="130"
                            Command="{Binding ConfirmRunConfigurationCommand}"
                            Style="{StaticResource EssentialsAccentButtonStyle}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>
