<Page x:Class="TidyWindow.App.Views.SettingsPage"
          xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
          xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
          xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
          xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
          xmlns:controls="clr-namespace:TidyWindow.App.Views"
          mc:Ignorable="d"
          Background="Transparent"
          Title="Settings">
        <Page.Resources>
                <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
                <Style x:Key="SettingsToggleSwitchStyle"
                           TargetType="ToggleButton">
                        <Setter Property="Width"
                                        Value="52"/>
                        <Setter Property="Height"
                                        Value="28"/>
                        <Setter Property="Background"
                                        Value="#1F2937"/>
                        <Setter Property="BorderBrush"
                                        Value="#1F2937"/>
                        <Setter Property="BorderThickness"
                                        Value="0"/>
                        <Setter Property="Cursor"
                                        Value="Hand"/>
                        <Setter Property="Focusable"
                                        Value="False"/>
                        <Setter Property="Template">
                                <Setter.Value>
                                        <ControlTemplate TargetType="ToggleButton">
                                                <Grid>
                                                        <Border x:Name="Track"
                                                                        Background="{TemplateBinding Background}"
                                                                        BorderBrush="#334155"
                                                                        BorderThickness="1"
                                                                        CornerRadius="14"/>
                                                        <Ellipse x:Name="Thumb"
                                                                         Width="22"
                                                                         Height="22"
                                                                         Fill="#F8FAFC"
                                                                         Margin="4,3,26,3"/>
                                                </Grid>
                                                <ControlTemplate.Triggers>
                                                        <Trigger Property="IsChecked"
                                                                         Value="True">
                                                                <Setter TargetName="Track"
                                                                                Property="Background"
                                                                                Value="#7C3AED"/>
                                                                <Setter TargetName="Track"
                                                                                Property="BorderBrush"
                                                                                Value="#7C3AED"/>
                                                                <Setter TargetName="Thumb"
                                                                                Property="Margin"
                                                                                Value="26,3,4,3"/>
                                                        </Trigger>
                                                        <Trigger Property="IsEnabled"
                                                                         Value="False">
                                                                <Setter TargetName="Track"
                                                                                Property="Background"
                                                                                Value="#1F2937"/>
                                                                <Setter TargetName="Track"
                                                                                Property="BorderBrush"
                                                                                Value="#1F2937"/>
                                                                <Setter TargetName="Thumb"
                                                                                Property="Fill"
                                                                                Value="#475569"/>
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver"
                                                                         Value="True">
                                                                <Setter TargetName="Track"
                                                                                Property="BorderBrush"
                                                                                Value="#7C3AED"/>
                                                        </Trigger>
                                                </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                </Setter.Value>
                        </Setter>
                </Style>

                <Style x:Key="SettingsSectionHeaderTextStyle"
                           TargetType="TextBlock">
                        <Setter Property="Foreground"
                                        Value="#F8FAFC"/>
                        <Setter Property="FontSize"
                                        Value="18"/>
                        <Setter Property="FontWeight"
                                        Value="SemiBold"/>
                </Style>

                <Style x:Key="SettingsSectionSubtitleTextStyle"
                           TargetType="TextBlock">
                        <Setter Property="Foreground"
                                        Value="#94A3B8"/>
                        <Setter Property="FontSize"
                                        Value="12"/>
                        <Setter Property="TextWrapping"
                                        Value="Wrap"/>
                </Style>
        </Page.Resources>

        <ScrollViewer Margin="32"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  CanContentScroll="False">
                <StackPanel>
                        <controls:PageTitleBar Title="Settings"
                                               Subtitle="Tune how TidyWindow runs on your machine."
                                               IconGlyph="⚙️"
                                               Margin="0,0,0,24"/>

                        <StackPanel>
                                <Border Background="#0B1120"
                                                Padding="24"
                                                CornerRadius="16"
                                                BorderBrush="#1D2A44"
                                                BorderThickness="1"
                                                Margin="0,0,0,16">
                                        <StackPanel>
                                                <TextBlock Text="Updates"
                                                                   Style="{StaticResource SettingsSectionHeaderTextStyle}"/>
                                                <TextBlock Text="Check for signed releases without reinstalling everything."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,6,0,16"/>

                                                <Grid>
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Margin="0,0,12,0">
                                                                <TextBlock Text="Current version"
                                                                                   Foreground="#94A3B8"
                                                                                   FontSize="12"/>
                                                                <TextBlock Text="{Binding CurrentVersionDisplay}"
                                                                                   Foreground="#F8FAFC"
                                                                                   FontSize="16"
                                                                                   FontWeight="SemiBold"/>
                                                        </StackPanel>

                                                        <StackPanel Grid.Column="1"
                                                                                Margin="12,0">
                                                                <TextBlock Text="Latest available"
                                                                                   Foreground="#94A3B8"
                                                                                   FontSize="12"/>
                                                                <TextBlock Text="{Binding LatestVersionDisplay}"
                                                                                   Foreground="#F8FAFC"
                                                                                   FontSize="16"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="{Binding UpdateChannelDisplay}"
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>

                                                        <StackPanel Grid.Column="2"
                                                                                Margin="12,0,0,0">
                                                                <TextBlock Text="Last checked"
                                                                                   Foreground="#94A3B8"
                                                                                   FontSize="12"/>
                                                                <TextBlock Text="{Binding LastUpdateCheckDisplay}"
                                                                                   Foreground="#F8FAFC"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"
                                                                                   TextWrapping="Wrap"/>
                                                        </StackPanel>
                                                </Grid>

                                                <StackPanel>
                                                        <StackPanel Orientation="Horizontal"
                                                                        Margin="0,16,0,0"
                                                                        VerticalAlignment="Center">
                                                                <Button Content="{Binding CheckForUpdatesButtonLabel}"
                                                                                Command="{Binding CheckForUpdatesCommand}"
                                                                                Padding="18,8"
                                                                                FontWeight="SemiBold"
                                                                                Foreground="#F8FAFC"
                                                                                Background="#7C3AED"
                                                                                BorderBrush="#7C3AED"
                                                                                Cursor="Hand"/>
                                                                <Button Content="{Binding InstallUpdateButtonLabel}"
                                                                                Command="{Binding InstallUpdateCommand}"
                                                                                Padding="18,8"
                                                                                FontWeight="SemiBold"
                                                                                Foreground="#0F172A"
                                                                                Background="#FACC15"
                                                                                BorderBrush="#FACC15"
                                                                                Cursor="Hand"
                                                                                Margin="12,0,0,0"
                                                                                Visibility="{Binding IsInstallUpdateVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                                <TextBlock Text="{Binding UpdateAvailabilitySummary}"
                                                                                   Foreground="#94A3B8"
                                                                                   Margin="12,6,0,0"/>
                                                        </StackPanel>
                                                        <ProgressBar Height="4"
                                                                         Margin="0,8,0,0"
                                                                         IsIndeterminate="True"
                                                                         Visibility="{Binding IsCheckingForUpdates, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                        <StackPanel Margin="0,8,0,0"
                                                                        Visibility="{Binding ShowInstallerProgress, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                <ProgressBar Height="4"
                                                                                 Maximum="100"
                                                                                 Value="{Binding InstallerDownloadProgress, Mode=OneWay}"
                                                                                 IsIndeterminate="{Binding IsInstallerProgressIndeterminate, Mode=OneWay}"/>
                                                                <TextBlock Text="{Binding InstallerDownloadStatus}"
                                                                                   Foreground="#94A3B8"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                </StackPanel>

                                                <TextBlock Text="{Binding UpdateStatusMessage}"
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,12,0,0"/>

                                                <TextBlock Text="Release summary"
                                                                   Foreground="#94A3B8"
                                                                   FontSize="12"
                                                                   Margin="0,16,0,4"/>
                                                <TextBlock Text="{Binding LatestReleaseSummary}"
                                                                   Foreground="#E2E8F0"
                                                                   TextWrapping="Wrap"/>

                                                <Grid Margin="0,16,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Published"
                                                                                   Foreground="#94A3B8"
                                                                                   FontSize="12"/>
                                                                <TextBlock Text="{Binding LatestReleasePublishedDisplay}"
                                                                                   Foreground="#F8FAFC"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Installer size"
                                                                                   Foreground="#94A3B8"
                                                                                   FontSize="12"
                                                                                   Margin="0,12,0,0"/>
                                                                <TextBlock Text="{Binding InstallerSizeDisplay}"
                                                                                   Foreground="#F8FAFC"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                        </StackPanel>
                                                        <StackPanel Grid.Column="1"
                                                                                Margin="12,0,0,0">
                                                                <TextBlock Text="Integrity"
                                                                                   Foreground="#94A3B8"
                                                                                   FontSize="12"/>
                                                                <TextBlock Text="{Binding LatestIntegrityDisplay}"
                                                                                   Foreground="#F8FAFC"
                                                                                   FontSize="13"
                                                                                   TextWrapping="Wrap"/>
                                                        </StackPanel>
                                                </Grid>

                                                <StackPanel Margin="0,16,0,0"
                                                                Visibility="{Binding HasReleaseNotesLink, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                        <TextBlock Text="Release notes"
                                                                           Foreground="#94A3B8"
                                                                           FontSize="12"/>
                                                        <TextBlock Foreground="#F8FAFC">
                                                                <Hyperlink NavigateUri="{Binding LatestReleaseNotesUri}"
                                                                                   RequestNavigate="UpdateLink_RequestNavigate">Open on GitHub</Hyperlink>
                                                        </TextBlock>
                                                </StackPanel>

                                                <StackPanel Margin="0,12,0,0"
                                                                Visibility="{Binding HasDownloadLink, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                        <TextBlock Text="Download installer"
                                                                           Foreground="#94A3B8"
                                                                           FontSize="12"/>
                                                        <TextBlock Foreground="#F8FAFC">
                                                                <Hyperlink NavigateUri="{Binding LatestDownloadUri}"
                                                                                   RequestNavigate="UpdateLink_RequestNavigate">Download</Hyperlink>
                                                        </TextBlock>
                                                </StackPanel>
                                        </StackPanel>
                                </Border>

                                <Border Background="#0B1120"
                                                Padding="24"
                                                CornerRadius="16"
                                                BorderBrush="#1D2A44"
                                                BorderThickness="1"
                                                Margin="0,0,0,16">
                                        <StackPanel>
                                                <TextBlock Text="Telemetry sharing"
                                                                   Style="{StaticResource SettingsSectionHeaderTextStyle}"/>
                                                <TextBlock Text="Opt in to share anonymized diagnostics so PulseGuard can spot regressions early."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,6,0,20"/>
                                                <CheckBox Style="{StaticResource App.CheckBoxStyle}"
                                                          Content="Enable telemetry"
                                                                  IsChecked="{Binding TelemetryEnabled, Mode=TwoWay}"
                                                                  FontSize="14"
                                                                  Foreground="#E2E8F0"
                                                                  Margin="0,0,0,4"/>
                                                <TextBlock Text="Telemetry never includes personal files or command input; it only tracks script health."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"/>
                                        </StackPanel>
                                </Border>

                                <Border Background="#0B1120"
                                                Padding="24"
                                                CornerRadius="16"
                                                BorderBrush="#1D2A44"
                                                BorderThickness="1"
                                                Margin="0,0,0,16">
                                        <StackPanel>
                                                <TextBlock Text="Session &amp; elevation"
                                                                   Style="{StaticResource SettingsSectionHeaderTextStyle}"/>
                                                <TextBlock Text="Maintenance scripts swap services, installers, and registry state. Staying elevated by default keeps those flows seamless."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,6,0,0"/>
                                                <Border Margin="0,20,0,0"
                                                                Padding="16"
                                                                CornerRadius="12">
                                                        <Border.Style>
                                                                <Style TargetType="Border">
                                                                        <Setter Property="Background"
                                                                                        Value="#0F172A"/>
                                                                        <Setter Property="BorderBrush"
                                                                                        Value="#1D2A44"/>
                                                                        <Setter Property="BorderThickness"
                                                                                        Value="1"/>
                                                                        <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding IsRunningElevated}"
                                                                                                         Value="True">
                                                                                        <Setter Property="Background"
                                                                                                        Value="#1E3A8A"/>
                                                                                        <Setter Property="BorderBrush"
                                                                                                        Value="#3B82F6"/>
                                                                                </DataTrigger>
                                                                        </Style.Triggers>
                                                                </Style>
                                                        </Border.Style>
                                                        <StackPanel>
                                                                <TextBlock Text="{Binding CurrentPrivilegeDisplay}"
                                                                                   FontSize="16"
                                                                                   FontWeight="SemiBold"
                                                                                   Foreground="#F8FAFC"/>
                                                                <TextBlock Text="{Binding CurrentPrivilegeAdvice}"
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,8,0,0"/>
                                                                <TextBlock Text="If you relaunch in user mode, package installs and service repairs will pause until elevation is restored."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,6,0,0"/>
                                                        </StackPanel>
                                                </Border>
                                        </StackPanel>
                                </Border>

                                <Border Background="#0B1120"
                                                Padding="24"
                                                CornerRadius="16"
                                                BorderBrush="#1D2A44"
                                                BorderThickness="1"
                                                Margin="0,0,0,16">
                                        <StackPanel>
                                                <TextBlock Text="Background presence"
                                                                   Style="{StaticResource SettingsSectionHeaderTextStyle}"/>
                                                <TextBlock Text="Keep TidyWindow available from the system tray so queued automation can continue quietly."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,6,0,0"/>

                                                <Grid Margin="0,20,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Run in background"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Minimize to the tray instead of closing the process."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding RunInBackground, Mode=TwoWay}"/>
                                                </Grid>

                                                <Grid Margin="0,16,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Launch at startup"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Create a Task Scheduler entry that runs with highest privileges so Windows won't prompt every logon."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding LaunchAtStartup, Mode=TwoWay}"/>
                                                </Grid>
                                        </StackPanel>
                                </Border>

                                <Border Background="#0B1120"
                                                Padding="24"
                                                CornerRadius="16"
                                                BorderBrush="#1D2A44"
                                                BorderThickness="1">
                                        <StackPanel>
                                                <TextBlock Text="PulseGuard watchdog"
                                                                   Style="{StaticResource SettingsSectionHeaderTextStyle}"/>
                                                <TextBlock Text="PulseGuard keeps a pulse on automation logs, highlighting success digests and urgent issues without spamming your desktop."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,6,0,0"/>

                                                <Grid Margin="0,20,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Enable PulseGuard"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Turn on the watchdog so it can classify automation events."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding PulseGuardEnabled, Mode=TwoWay}"/>
                                                </Grid>

                                                <Grid Margin="0,16,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="PulseGuard notifications"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Allow PulseGuard to raise Windows toasts and tray tips when you're away from the app."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding NotificationsEnabled, Mode=TwoWay}"
                                                                                  IsEnabled="{Binding PulseGuardEnabled}"/>
                                                </Grid>

                                                <Grid Margin="0,16,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Only notify when I'm away"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Mute toast notifications while the window stays in focus."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding NotifyOnlyWhenInactive, Mode=TwoWay}"
                                                                                  IsEnabled="{Binding CanAdjustPulseGuardNotifications}"/>
                                                </Grid>

                                                <Grid Margin="0,16,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Show completion digests"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Get a wrap-up when long-running scripts succeed."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding PulseGuardShowSuccessSummaries, Mode=TwoWay}"
                                                                                  IsEnabled="{Binding CanAdjustPulseGuardNotifications}"/>
                                                </Grid>

                                                <Grid Margin="0,16,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Show action-required alerts"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Keep blockers like legacy PowerShell or pending restarts front and center."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding PulseGuardShowActionAlerts, Mode=TwoWay}"
                                                                                  IsEnabled="{Binding CanAdjustPulseGuardNotifications}"/>
                                                </Grid>

                                                <TextBlock Text="Every PulseGuard toast includes a &quot;View log&quot; action, so you can jump straight to the evidence."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,20,0,0"/>
                                        </StackPanel>
                                </Border>
                        </StackPanel>
                </StackPanel>
        </ScrollViewer>
</Page>
