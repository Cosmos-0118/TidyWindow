<Page x:Class="TidyWindow.App.Views.SettingsPage"
          xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
          xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
          xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
          xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
          xmlns:controls="clr-namespace:TidyWindow.App.Views"
          mc:Ignorable="d"
          Background="Transparent"
          Title="Settings">
        <Page.Resources>
                <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
                <Style x:Key="SettingsToggleSwitchStyle"
                           TargetType="ToggleButton">
                        <Setter Property="Width"
                                        Value="52"/>
                        <Setter Property="Height"
                                        Value="28"/>
                        <Setter Property="Background"
                                        Value="#1F2937"/>
                        <Setter Property="BorderBrush"
                                        Value="#1F2937"/>
                        <Setter Property="BorderThickness"
                                        Value="0"/>
                        <Setter Property="Cursor"
                                        Value="Hand"/>
                        <Setter Property="Focusable"
                                        Value="False"/>
                        <Setter Property="Template">
                                <Setter.Value>
                                        <ControlTemplate TargetType="ToggleButton">
                                                <Grid>
                                                        <Border x:Name="Track"
                                                                        Background="{TemplateBinding Background}"
                                                                        BorderBrush="#334155"
                                                                        BorderThickness="1"
                                                                        CornerRadius="14"/>
                                                        <Ellipse x:Name="Thumb"
                                                                         Width="22"
                                                                         Height="22"
                                                                         Fill="#F8FAFC"
                                                                         Margin="4,3,26,3"/>
                                                </Grid>
                                                <ControlTemplate.Triggers>
                                                        <Trigger Property="IsChecked"
                                                                         Value="True">
                                                                <Setter TargetName="Track"
                                                                                Property="Background"
                                                                                Value="#7C3AED"/>
                                                                <Setter TargetName="Track"
                                                                                Property="BorderBrush"
                                                                                Value="#7C3AED"/>
                                                                <Setter TargetName="Thumb"
                                                                                Property="Margin"
                                                                                Value="26,3,4,3"/>
                                                        </Trigger>
                                                        <Trigger Property="IsEnabled"
                                                                         Value="False">
                                                                <Setter TargetName="Track"
                                                                                Property="Background"
                                                                                Value="#1F2937"/>
                                                                <Setter TargetName="Track"
                                                                                Property="BorderBrush"
                                                                                Value="#1F2937"/>
                                                                <Setter TargetName="Thumb"
                                                                                Property="Fill"
                                                                                Value="#475569"/>
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver"
                                                                         Value="True">
                                                                <Setter TargetName="Track"
                                                                                Property="BorderBrush"
                                                                                Value="#7C3AED"/>
                                                        </Trigger>
                                                </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                </Setter.Value>
                        </Setter>
                </Style>

                <Style x:Key="SettingsSectionHeaderTextStyle"
                           TargetType="TextBlock">
                        <Setter Property="Foreground"
                                        Value="#F8FAFC"/>
                        <Setter Property="FontSize"
                                        Value="18"/>
                        <Setter Property="FontWeight"
                                        Value="SemiBold"/>
                </Style>

                <Style x:Key="SettingsSectionSubtitleTextStyle"
                           TargetType="TextBlock">
                        <Setter Property="Foreground"
                                        Value="#94A3B8"/>
                        <Setter Property="FontSize"
                                        Value="12"/>
                        <Setter Property="TextWrapping"
                                        Value="Wrap"/>
                </Style>

                <LinearGradientBrush x:Key="SettingsCheckButtonBrush"
                                      StartPoint="0,0"
                                      EndPoint="1,1">
                        <GradientStop Color="#7C3AED"
                                      Offset="0"/>
                        <GradientStop Color="#9333EA"
                                      Offset="1"/>
                </LinearGradientBrush>
                <LinearGradientBrush x:Key="SettingsCheckButtonHoverBrush"
                                      StartPoint="0,0"
                                      EndPoint="1,1">
                        <GradientStop Color="#A855F7"
                                      Offset="0"/>
                        <GradientStop Color="#C084FC"
                                      Offset="1"/>
                </LinearGradientBrush>
                <LinearGradientBrush x:Key="SettingsInstallButtonBrush"
                                      StartPoint="0,0"
                                      EndPoint="1,1">
                        <GradientStop Color="#F59E0B"
                                      Offset="0"/>
                        <GradientStop Color="#FBBF24"
                                      Offset="1"/>
                </LinearGradientBrush>
                <LinearGradientBrush x:Key="SettingsInstallButtonHoverBrush"
                                      StartPoint="0,0"
                                      EndPoint="1,1">
                        <GradientStop Color="#FBBF24"
                                      Offset="0"/>
                        <GradientStop Color="#FDE047"
                                      Offset="1"/>
                </LinearGradientBrush>
                <DropShadowEffect x:Key="SettingsActionButtonGlowEffect"
                                  Color="#020617"
                                  BlurRadius="16"
                                  ShadowDepth="0"
                                  Opacity="0.55"/>
                <Style x:Key="SettingsActionButtonStyle"
                           TargetType="Button">
                        <Setter Property="Padding"
                                        Value="18,10"/>
                        <Setter Property="FontWeight"
                                        Value="SemiBold"/>
                        <Setter Property="FontSize"
                                        Value="14"/>
                        <Setter Property="Cursor"
                                        Value="Hand"/>
                        <Setter Property="BorderThickness"
                                        Value="0"/>
                        <Setter Property="Foreground"
                                        Value="#020617"/>
                        <Setter Property="Tag"
                                        Value="#7C3AED"/>
                        <Setter Property="Template">
                                <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                                <Border x:Name="ActionBorder"
                                                                CornerRadius="12"
                                                                Padding="{TemplateBinding Padding}"
                                                                Effect="{StaticResource SettingsActionButtonGlowEffect}">
                                                        <Border.Style>
                                                                <Style TargetType="Border">
                                                                        <Setter Property="Opacity"
                                                                                        Value="1"/>
                                                                        <Setter Property="Background">
                                                                                <Setter.Value>
                                                                                        <Binding Path="Background"
                                                                                                 RelativeSource="{RelativeSource TemplatedParent}"/>
                                                                                </Setter.Value>
                                                                        </Setter>
                                                                        <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource TemplatedParent}}"
                                                                                             Value="True">
                                                                                        <Setter Property="Background"
                                                                                                        Value="{Binding Tag, RelativeSource={RelativeSource TemplatedParent}}"/>
                                                                                </DataTrigger>
                                                                                <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource TemplatedParent}}"
                                                                                             Value="False">
                                                                                        <Setter Property="Opacity"
                                                                                                        Value="0.55"/>
                                                                                </DataTrigger>
                                                                        </Style.Triggers>
                                                                </Style>
                                                        </Border.Style>
                                                        <ContentPresenter HorizontalAlignment="Center"
                                                                          VerticalAlignment="Center"/>
                                                </Border>
                                        </ControlTemplate>
                                </Setter.Value>
                        </Setter>
                </Style>
                <Style x:Key="SettingsCheckButtonStyle"
                           TargetType="Button"
                           BasedOn="{StaticResource SettingsActionButtonStyle}">
                        <Setter Property="Background"
                                        Value="{StaticResource SettingsCheckButtonBrush}"/>
                        <Setter Property="Tag"
                                        Value="{StaticResource SettingsCheckButtonHoverBrush}"/>
                        <Setter Property="Foreground"
                                        Value="#F8FAFC"/>
                </Style>
                <Style x:Key="SettingsInstallButtonStyle"
                           TargetType="Button"
                           BasedOn="{StaticResource SettingsActionButtonStyle}">
                        <Setter Property="Background"
                                        Value="{StaticResource SettingsInstallButtonBrush}"/>
                        <Setter Property="Tag"
                                        Value="{StaticResource SettingsInstallButtonHoverBrush}"/>
                        <Setter Property="Foreground"
                                        Value="#0F172A"/>
                </Style>

                <Style x:Key="SettingsInfoChipStyle" TargetType="Border">
                        <Setter Property="Background" Value="#0F172A"/>
                        <Setter Property="BorderBrush" Value="#1E2E46"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Setter Property="CornerRadius" Value="12"/>
                        <Setter Property="Padding" Value="12,10"/>
                        <Setter Property="Margin" Value="0,8,8,0"/>
                        <Setter Property="SnapsToDevicePixels" Value="True"/>
                        <Setter Property="RenderOptions.BitmapScalingMode" Value="HighQuality"/>
                </Style>
        </Page.Resources>

        <Grid>
                <ScrollViewer Margin="32"
                                          VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Disabled"
                                          CanContentScroll="False">
                        <StackPanel>
                        <controls:PageTitleBar Title="Settings"
                                               Subtitle="Tune how TidyWindow runs on your machine."
                                               IconGlyph="⚙️"
                                               Margin="0,0,0,24"/>

                        <StackPanel>
                                <Border Background="#0B1120"
                                                Padding="24"
                                                CornerRadius="16"
                                                BorderBrush="#1D2A44"
                                                BorderThickness="1"
                                                Margin="0,0,0,16">
                                        <StackPanel>
                                                <TextBlock Text="Updates"
                                                                   Style="{StaticResource SettingsSectionHeaderTextStyle}"/>
                                                <TextBlock Text="Check for signed releases without reinstalling everything."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,6,0,16"/>

                                                <Grid>
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Margin="0,0,12,0">
                                                                <TextBlock Text="Current version"
                                                                                   Foreground="#94A3B8"
                                                                                   FontSize="12"/>
                                                                <TextBlock Text="{Binding CurrentVersionDisplay}"
                                                                                   Foreground="#F8FAFC"
                                                                                   FontSize="16"
                                                                                   FontWeight="SemiBold"/>
                                                        </StackPanel>

                                                        <StackPanel Grid.Column="1"
                                                                                Margin="12,0">
                                                                <TextBlock Text="Latest available"
                                                                                   Foreground="#94A3B8"
                                                                                   FontSize="12"/>
                                                                <TextBlock Text="{Binding LatestVersionDisplay}"
                                                                                   Foreground="#F8FAFC"
                                                                                   FontSize="16"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="{Binding UpdateChannelDisplay}"
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>

                                                        <StackPanel Grid.Column="2"
                                                                                Margin="12,0,0,0">
                                                                <TextBlock Text="Last checked"
                                                                                   Foreground="#94A3B8"
                                                                                   FontSize="12"/>
                                                                <TextBlock Text="{Binding LastUpdateCheckDisplay}"
                                                                                   Foreground="#F8FAFC"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"
                                                                                   TextWrapping="Wrap"/>
                                                        </StackPanel>
                                                </Grid>

                                                <StackPanel>
                                                        <StackPanel Orientation="Horizontal"
                                                                        Margin="0,16,0,0"
                                                                        VerticalAlignment="Center">
                                                                <Button Content="{Binding CheckForUpdatesButtonLabel}"
                                                                                Command="{Binding CheckForUpdatesCommand}"
                                                                                Style="{StaticResource SettingsCheckButtonStyle}"
                                                                                IsEnabled="{Binding IsUpdateActionsEnabled}"/>
                                                                <Button Content="{Binding InstallUpdateButtonLabel}"
                                                                                Command="{Binding InstallUpdateCommand}"
                                                                                Style="{StaticResource SettingsInstallButtonStyle}"
                                                                                Margin="12,0,0,0"
                                                                                IsEnabled="{Binding IsUpdateActionsEnabled}"
                                                                                Visibility="{Binding IsInstallUpdateVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                                <TextBlock Text="{Binding UpdateAvailabilitySummary}"
                                                                                   Foreground="#94A3B8"
                                                                                   Margin="12,6,0,0"/>
                                                        </StackPanel>
                                                        <ProgressBar Height="4"
                                                                         Margin="0,8,0,0"
                                                                         IsIndeterminate="True"
                                                                         Visibility="{Binding IsCheckingForUpdates, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                        <StackPanel Margin="0,8,0,0"
                                                                        Visibility="{Binding ShowInstallerProgress, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                <ProgressBar Height="4"
                                                                                 Maximum="100"
                                                                                 Value="{Binding InstallerDownloadProgress, Mode=OneWay}"
                                                                                 IsIndeterminate="{Binding IsInstallerProgressIndeterminate, Mode=OneWay}"/>
                                                                <TextBlock Text="{Binding InstallerDownloadStatus}"
                                                                                   Foreground="#94A3B8"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                </StackPanel>

                                                <TextBlock Text="{Binding UpdateStatusMessage}"
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,12,0,0"/>

                                                <WrapPanel Margin="0,16,0,0">
                                                        <Border Style="{StaticResource SettingsInfoChipStyle}">
                                                                <StackPanel>
                                                                        <TextBlock Text="Published"
                                                                                           Foreground="#94A3B8"
                                                                                           FontSize="11"/>
                                                                        <TextBlock Text="{Binding LatestReleasePublishedDisplay}"
                                                                                           Foreground="#F8FAFC"
                                                                                           FontSize="14"
                                                                                           FontWeight="SemiBold"/>
                                                                </StackPanel>
                                                        </Border>

                                                        <Border Style="{StaticResource SettingsInfoChipStyle}">
                                                                <StackPanel>
                                                                        <TextBlock Text="Installer size"
                                                                                           Foreground="#94A3B8"
                                                                                           FontSize="11"/>
                                                                        <TextBlock Text="{Binding InstallerSizeDisplay}"
                                                                                           Foreground="#F8FAFC"
                                                                                           FontSize="14"
                                                                                           FontWeight="SemiBold"/>
                                                                </StackPanel>
                                                        </Border>

                                                        <Border Style="{StaticResource SettingsInfoChipStyle}">
                                                                <StackPanel>
                                                                        <TextBlock Text="Integrity"
                                                                                           Foreground="#94A3B8"
                                                                                           FontSize="11"/>
                                                                        <TextBlock Text="{Binding LatestIntegrityDisplay}"
                                                                                           Foreground="#F8FAFC"
                                                                                           FontSize="13"
                                                                                           TextWrapping="Wrap"
                                                                                           MaxWidth="220"/>
                                                                </StackPanel>
                                                        </Border>
                                                </WrapPanel>

                                                <StackPanel Margin="0,16,0,0"
                                                                Visibility="{Binding HasReleaseNotes, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                        <TextBlock Text="Release notes"
                                                                           Foreground="#94A3B8"
                                                                           FontSize="12"/>
                                                        <StackPanel Orientation="Horizontal"
                                                                        Margin="0,6,0,0">
                                                                <Button Content="View release notes"
                                                                                Command="{Binding ShowReleaseNotesCommand}"
                                                                                Style="{StaticResource SettingsCheckButtonStyle}"
                                                                                MinWidth="170"/>
                                                                <Button Content="Open on GitHub"
                                                                                Command="{Binding OpenReleaseNotesLinkCommand}"
                                                                                Style="{StaticResource SettingsActionButtonStyle}"
                                                                                Background="#111B33"
                                                                                Foreground="#E2E8F0"
                                                                                Tag="#1E293B"
                                                                                Margin="8,0,0,0"
                                                                                MinWidth="150"
                                                                                IsEnabled="{Binding HasReleaseNotesLink}"/>
                                                        </StackPanel>
                                                        <TextBlock Text="Opens a focused popup with structured notes."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,6,0,0"/>
                                                </StackPanel>

                                                <StackPanel Margin="0,12,0,0"
                                                                Visibility="{Binding HasDownloadLink, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                        <TextBlock Text="Download installer"
                                                                           Foreground="#94A3B8"
                                                                           FontSize="12"/>
                                                        <TextBlock Foreground="#F8FAFC">
                                                                <Hyperlink NavigateUri="{Binding LatestDownloadUri}"
                                                                                   RequestNavigate="UpdateLink_RequestNavigate">Download</Hyperlink>
                                                        </TextBlock>
                                                </StackPanel>
                                        </StackPanel>
                                </Border>

                                <Border Background="#0B1120"
                                                Padding="24"
                                                CornerRadius="16"
                                                BorderBrush="#1D2A44"
                                                BorderThickness="1"
                                                Margin="0,0,0,16">
                                        <StackPanel>
                                                <TextBlock Text="Telemetry sharing"
                                                                   Style="{StaticResource SettingsSectionHeaderTextStyle}"/>
                                                <TextBlock Text="Opt in to share anonymized diagnostics so PulseGuard can spot regressions early."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,6,0,20"/>
                                                <CheckBox Style="{StaticResource App.CheckBoxStyle}"
                                                          Content="Enable telemetry"
                                                                  IsChecked="{Binding TelemetryEnabled, Mode=TwoWay}"
                                                                  FontSize="14"
                                                                  Foreground="#E2E8F0"
                                                                  Margin="0,0,0,4"/>
                                                <TextBlock Text="Telemetry never includes personal files or command input; it only tracks script health."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"/>
                                        </StackPanel>
                                </Border>

                                <Border Background="#0B1120"
                                                Padding="24"
                                                CornerRadius="16"
                                                BorderBrush="#1D2A44"
                                                BorderThickness="1"
                                                Margin="0,0,0,16">
                                        <StackPanel>
                                                <TextBlock Text="Session &amp; elevation"
                                                                   Style="{StaticResource SettingsSectionHeaderTextStyle}"/>
                                                <TextBlock Text="Maintenance scripts swap services, installers, and registry state. Staying elevated by default keeps those flows seamless."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,6,0,0"/>
                                                <Border Margin="0,20,0,0"
                                                                Padding="16"
                                                                CornerRadius="12">
                                                        <Border.Style>
                                                                <Style TargetType="Border">
                                                                        <Setter Property="Background"
                                                                                        Value="#0F172A"/>
                                                                        <Setter Property="BorderBrush"
                                                                                        Value="#1D2A44"/>
                                                                        <Setter Property="BorderThickness"
                                                                                        Value="1"/>
                                                                        <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding IsRunningElevated}"
                                                                                                         Value="True">
                                                                                        <Setter Property="Background"
                                                                                                        Value="#1E3A8A"/>
                                                                                        <Setter Property="BorderBrush"
                                                                                                        Value="#3B82F6"/>
                                                                                </DataTrigger>
                                                                        </Style.Triggers>
                                                                </Style>
                                                        </Border.Style>
                                                        <StackPanel>
                                                                <TextBlock Text="{Binding CurrentPrivilegeDisplay}"
                                                                                   FontSize="16"
                                                                                   FontWeight="SemiBold"
                                                                                   Foreground="#F8FAFC"/>
                                                                <TextBlock Text="{Binding CurrentPrivilegeAdvice}"
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,8,0,0"/>
                                                                <TextBlock Text="If you relaunch in user mode, package installs and service repairs will pause until elevation is restored."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,6,0,0"/>
                                                        </StackPanel>
                                                </Border>
                                        </StackPanel>
                                </Border>

                                <Border Background="#0B1120"
                                                Padding="24"
                                                CornerRadius="16"
                                                BorderBrush="#1D2A44"
                                                BorderThickness="1"
                                                Margin="0,0,0,16">
                                        <StackPanel>
                                                <TextBlock Text="Background presence"
                                                                   Style="{StaticResource SettingsSectionHeaderTextStyle}"/>
                                                <TextBlock Text="Keep TidyWindow available from the system tray so queued automation can continue quietly."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,6,0,0"/>

                                                <Grid Margin="0,20,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Run in background"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Minimize to the tray instead of closing the process."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding RunInBackground, Mode=TwoWay}"/>
                                                </Grid>

                                                <Grid Margin="0,16,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Launch at startup"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Create a Task Scheduler entry that runs with highest privileges so Windows won't prompt every logon."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding LaunchAtStartup, Mode=TwoWay}"/>
                                                </Grid>
                                        </StackPanel>
                                </Border>

                                <Border Background="#0B1120"
                                                Padding="24"
                                                CornerRadius="16"
                                                BorderBrush="#1D2A44"
                                                BorderThickness="1">
                                        <StackPanel>
                                                <TextBlock Text="PulseGuard watchdog"
                                                                   Style="{StaticResource SettingsSectionHeaderTextStyle}"/>
                                                <TextBlock Text="PulseGuard keeps a pulse on automation logs, highlighting success digests and urgent issues without spamming your desktop."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,6,0,0"/>

                                                <Grid Margin="0,20,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Enable PulseGuard"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Turn on the watchdog so it can classify automation events."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding PulseGuardEnabled, Mode=TwoWay}"/>
                                                </Grid>

                                                <Grid Margin="0,16,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="PulseGuard notifications"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Allow PulseGuard to raise Windows toasts and tray tips when you're away from the app."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding NotificationsEnabled, Mode=TwoWay}"
                                                                                  IsEnabled="{Binding PulseGuardEnabled}"/>
                                                </Grid>

                                                <Grid Margin="0,16,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Only notify when I'm away"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Mute toast notifications while the window stays in focus."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding NotifyOnlyWhenInactive, Mode=TwoWay}"
                                                                                  IsEnabled="{Binding CanAdjustPulseGuardNotifications}"/>
                                                </Grid>

                                                <Grid Margin="0,16,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Show completion digests"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Get a wrap-up when long-running scripts succeed."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding PulseGuardShowSuccessSummaries, Mode=TwoWay}"
                                                                                  IsEnabled="{Binding CanAdjustPulseGuardNotifications}"/>
                                                </Grid>

                                                <Grid Margin="0,16,0,0">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel>
                                                                <TextBlock Text="Show action-required alerts"
                                                                                   Foreground="#E2E8F0"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"/>
                                                                <TextBlock Text="Keep blockers like legacy PowerShell or pending restarts front and center."
                                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                                   Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <ToggleButton Grid.Column="1"
                                                                                  Style="{StaticResource SettingsToggleSwitchStyle}"
                                                                                  IsChecked="{Binding PulseGuardShowActionAlerts, Mode=TwoWay}"
                                                                                  IsEnabled="{Binding CanAdjustPulseGuardNotifications}"/>
                                                </Grid>

                                                <TextBlock Text="Every PulseGuard toast includes a &quot;View log&quot; action, so you can jump straight to the evidence."
                                                                   Style="{StaticResource SettingsSectionSubtitleTextStyle}"
                                                                   Margin="0,20,0,0"/>
                                        </StackPanel>
                                </Border>
                        </StackPanel>
                                        </StackPanel>
                </ScrollViewer>

                <Grid x:Name="ReleaseNotesOverlay"
                              Panel.ZIndex="9"
                              Background="#B0020617"
                              Visibility="{Binding IsReleaseNotesDialogVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
                              IsHitTestVisible="{Binding IsReleaseNotesDialogVisible}">
                        <Border MinWidth="540"
                                        MaxWidth="980"
                                        Margin="32"
                                        Padding="28"
                                        Background="#0B1729"
                                        BorderBrush="#24344F"
                                        BorderThickness="1"
                                        CornerRadius="24"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                <Grid>
                                        <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <StackPanel Margin="0,0,0,18">
                                                <TextBlock Text="{Binding ReleaseNotesDialogTitle}"
                                                                   FontSize="20"
                                                                   FontWeight="SemiBold"
                                                                   Foreground="#F8FAFC"
                                                                   TextWrapping="Wrap"/>
                                                <TextBlock Text="{Binding ReleaseNotesDialogSubtitle}"
                                                                   Margin="0,6,0,0"
                                                                   Foreground="#9FB0C7"
                                                                   FontSize="12"
                                                                   TextWrapping="Wrap"/>
                                                <TextBlock Text="{Binding UpdateAvailabilitySummary}"
                                                                   Margin="0,6,0,0"
                                                                   Foreground="#B4C4E0"
                                                                   FontSize="12"
                                                                   TextWrapping="Wrap"/>
                                        </StackPanel>

                                        <Border Grid.Row="1"
                                                        Background="#0A162C"
                                                        BorderBrush="#1E2F4B"
                                                        BorderThickness="1"
                                                        CornerRadius="12"
                                                        Padding="12">
                                                <Grid>
                                                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                                                              HorizontalScrollBarVisibility="Disabled"
                                                                              MaxHeight="540">
                                                                <ItemsControl ItemsSource="{Binding ReleaseNotesDisplayLines}"
                                                                                      HorizontalAlignment="Stretch"
                                                                                      Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ScrollViewer}}">
                                                                        <ItemsControl.ItemTemplate>
                                                                                <DataTemplate>
                                                                                        <Grid Margin="0,6,0,6">
                                                                                                <Grid.ColumnDefinitions>
                                                                                                        <ColumnDefinition Width="Auto"/>
                                                                                                        <ColumnDefinition Width="*"/>
                                                                                                </Grid.ColumnDefinitions>
                                                                                                <TextBlock Text="{Binding Icon}"
                                                                                                           FontSize="14"
                                                                                                           Margin="0,0,10,0"
                                                                                                           VerticalAlignment="Top"/>
                                                                                                <TextBlock Grid.Column="1"
                                                                                                           Text="{Binding Text}"
                                                                                                           FontSize="13"
                                                                                                           Foreground="#E2E8F0"
                                                                                                           TextWrapping="Wrap"
                                                                                                           TextTrimming="None"
                                                                                                           Margin="0,0,6,0"/>
                                                                                        </Grid>
                                                                                </DataTemplate>
                                                                        </ItemsControl.ItemTemplate>
                                                                </ItemsControl>
                                                        </ScrollViewer>
                                                        <TextBlock Text="Release notes will appear after the first check."
                                                                       HorizontalAlignment="Center"
                                                                       VerticalAlignment="Center"
                                                                       Foreground="#5F6B84"
                                                                       FontSize="12">
                                                                <TextBlock.Style>
                                                                        <Style TargetType="TextBlock">
                                                                                <Setter Property="Visibility"
                                                                                                Value="Collapsed"/>
                                                                                <Style.Triggers>
                                                                                        <DataTrigger Binding="{Binding ReleaseNotesDisplayLines.Count, TargetNullValue=0}"
                                                                                                         Value="0">
                                                                                                <Setter Property="Visibility"
                                                                                                                Value="Visible"/>
                                                                                        </DataTrigger>
                                                                                </Style.Triggers>
                                                                        </Style>
                                                                </TextBlock.Style>
                                                        </TextBlock>
                                                </Grid>
                                        </Border>

                                        <StackPanel Grid.Row="2"
                                                    Orientation="Horizontal"
                                                    HorizontalAlignment="Right"
                                                    Margin="0,18,0,0">
                                                <Button Content="Open on GitHub"
                                                                Command="{Binding OpenReleaseNotesLinkCommand}"
                                                                Style="{StaticResource SettingsActionButtonStyle}"
                                                                Background="#111B33"
                                                                Foreground="#E2E8F0"
                                                                Tag="#1E293B"
                                                                Padding="14,6"
                                                                MinWidth="140"
                                                                IsEnabled="{Binding HasReleaseNotesLink}"/>
                                                <Button Content="Copy notes"
                                                                Command="{Binding CopyReleaseNotesCommand}"
                                                                Style="{StaticResource SettingsActionButtonStyle}"
                                                                Background="#0F172A"
                                                                Foreground="#E2E8F0"
                                                                Tag="#1F2A3D"
                                                                Padding="14,6"
                                                                MinWidth="120"
                                                                Margin="10,0,0,0"/>
                                                <Button Content="Close"
                                                                Command="{Binding CloseReleaseNotesCommand}"
                                                                Style="{StaticResource SettingsCheckButtonStyle}"
                                                                Padding="16,8"
                                                                MinWidth="120"
                                                                Margin="12,0,0,0"/>
                                        </StackPanel>
                                </Grid>
                        </Border>
                </Grid>
        </Grid>
</Page>
