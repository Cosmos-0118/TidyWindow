<Page x:Class="TidyWindow.App.Views.PerformanceLabPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:controls="clr-namespace:TidyWindow.App.Views"
      mc:Ignorable="d"
      Title="Performance Lab"
      Background="Transparent"
      UseLayoutRounding="True"
      SnapsToDevicePixels="True"
      TextOptions.TextFormattingMode="Display"
      TextOptions.TextRenderingMode="ClearType"
      TextOptions.TextHintingMode="Fixed"
      RenderOptions.BitmapScalingMode="HighQuality">
    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

        <!-- Modern Color Palette -->
        <SolidColorBrush x:Key="PageBg" Color="#050B14" />
        <SolidColorBrush x:Key="CardBg" Color="#0C1829" />
        <SolidColorBrush x:Key="CardBorder" Color="#1A2D47" />
        <SolidColorBrush x:Key="CardBorderHover" Color="#2563EB" />
        <SolidColorBrush x:Key="TextPrimary" Color="#F1F5F9" />
        <SolidColorBrush x:Key="TextSecondary" Color="#94A3B8" />
        <SolidColorBrush x:Key="TextMuted" Color="#64748B" />
        <SolidColorBrush x:Key="AccentBlue" Color="#38BDF8" />
        <SolidColorBrush x:Key="SuccessGreen" Color="#22C55E" />
        <SolidColorBrush x:Key="WarningAmber" Color="#FBBF24" />
        <SolidColorBrush x:Key="AccentTeal" Color="#14B8A6" />

        <!-- Hero Background -->
        <LinearGradientBrush x:Key="HeroBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#0A1628" Offset="0" />
            <GradientStop Color="#0F2847" Offset="0.5" />
            <GradientStop Color="#0D3355" Offset="1" />
        </LinearGradientBrush>

        <!-- Step Card - Enhanced with better sizing -->
        <Style x:Key="StepCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBg}" />
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="16" />
            <Setter Property="Padding" Value="24,20" />
            <Setter Property="Margin" Value="0,0,0,12" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="UseLayoutRounding" Value="True" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource CardBorderHover}" />
                    <Setter Property="Background" Value="#0E1D32" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Step Number Badge - Larger and more prominent -->
        <Style x:Key="StepBadge" TargetType="Border">
            <Setter Property="Width" Value="44" />
            <Setter Property="Height" Value="44" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
        </Style>

        <!-- Chip Style - Warning tag -->
        <Style x:Key="ChipStyle" TargetType="Border">
            <Setter Property="Background" Value="#3B1515" />
            <Setter Property="BorderBrush" Value="#7F1D1D" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
        </Style>

        <!-- Status Chip - Success/Warning indicators -->
        <Style x:Key="StatusChipSuccess" TargetType="Border">
            <Setter Property="Background" Value="#052E16" />
            <Setter Property="BorderBrush" Value="#22C55E" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="10,5" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
        </Style>

        <Style x:Key="StatusChipWarning" TargetType="Border">
            <Setter Property="Background" Value="#422006" />
            <Setter Property="BorderBrush" Value="#F59E0B" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="10,5" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
        </Style>

        <!-- Modern Toggle Switch -->
        <Style x:Key="ModernToggle" TargetType="ToggleButton">
            <Setter Property="Width" Value="52" />
            <Setter Property="Height" Value="28" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Grid>
                            <Border x:Name="Track" CornerRadius="14" Background="#1E293B" BorderBrush="#334155" BorderThickness="1">
                                <Grid>
                                    <Ellipse x:Name="ThumbOff" Width="22" Height="22" Fill="#64748B" 
                                             HorizontalAlignment="Left" Margin="2,0,0,0"/>
                                    <Ellipse x:Name="ThumbOn" Width="22" Height="22" Fill="#F0FDFA" 
                                             HorizontalAlignment="Right" Margin="0,0,2,0" Visibility="Collapsed"/>
                                </Grid>
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Track" Property="Background" Value="#14B8A6"/>
                                <Setter TargetName="Track" Property="BorderBrush" Value="#2DD4BF"/>
                                <Setter TargetName="ThumbOff" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="ThumbOn" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ThumbOff" Property="Fill" Value="#94A3B8"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsChecked" Value="True"/>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="ThumbOn" Property="Fill" Value="#FFFFFF"/>
                                <Setter TargetName="Track" Property="Background" Value="#0D9488"/>
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Primary Button - Larger and more prominent -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Foreground" Value="#022C22" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="MinWidth" Value="90" />
            <Setter Property="Padding" Value="18,10" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" CornerRadius="10" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True" UseLayoutRounding="True">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#34D399" Offset="0" />
                                    <GradientStop Color="#10B981" Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#4ADE80" Offset="0" />
                                            <GradientStop Color="#22C55E" Offset="1" />
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.4" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Secondary Button - Enhanced -->
        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Foreground" Value="#E2E8F0" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="MinWidth" Value="90" />
            <Setter Property="Padding" Value="18,10" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="#0F1D32" BorderBrush="#1E3A5F" BorderThickness="1" CornerRadius="10" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True" UseLayoutRounding="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#38BDF8" />
                                <Setter TargetName="Bd" Property="Background" Value="#152640" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.4" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Compact Button for card actions -->
        <Style x:Key="CompactButton" TargetType="Button">
            <Setter Property="Foreground" Value="#E2E8F0" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="MinWidth" Value="72" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="#0F1D32" BorderBrush="#1E3A5F" BorderThickness="1" CornerRadius="8" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True" UseLayoutRounding="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#38BDF8" />
                                <Setter TargetName="Bd" Property="Background" Value="#152640" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.4" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Compact Primary Button -->
        <Style x:Key="CompactPrimaryButton" TargetType="Button">
            <Setter Property="Foreground" Value="#022C22" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="MinWidth" Value="72" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" CornerRadius="8" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True" UseLayoutRounding="True">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#34D399" Offset="0" />
                                    <GradientStop Color="#10B981" Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#4ADE80" Offset="0" />
                                            <GradientStop Color="#22C55E" Offset="1" />
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.4" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Info Button - More visible -->
        <Style x:Key="InfoButton" TargetType="Button">
            <Setter Property="Foreground" Value="#64748B" />
            <Setter Property="FontSize" Value="11" />
            <Setter Property="Width" Value="24" />
            <Setter Property="Height" Value="24" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="#1E293B" BorderBrush="#334155" BorderThickness="1" CornerRadius="6" Width="24" Height="24" SnapsToDevicePixels="True">
                            <TextBlock Text="?" FontSize="12" FontWeight="Bold" Foreground="{TemplateBinding Foreground}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#334155" />
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#38BDF8" />
                                <Setter Property="Foreground" Value="#38BDF8" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Status Indicator -->
        <Style x:Key="StatusIndicator" TargetType="Border">
            <Setter Property="Width" Value="10" />
            <Setter Property="Height" Value="10" />
            <Setter Property="CornerRadius" Value="5" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
        </Style>

        <!-- Title Text Style - Larger -->
        <Style x:Key="StepTitleStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#F1F5F9" />
            <Setter Property="FontSize" Value="15" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="TextOptions.TextFormattingMode" Value="Display" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>

        <!-- Description Text Style -->
        <Style x:Key="StepDescStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#94A3B8" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="TextOptions.TextFormattingMode" Value="Display" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>

        <!-- Modern ComboBox Style -->
        <Style x:Key="ModernComboBox" TargetType="ComboBox">
            <Setter Property="Background" Value="#0F1D32" />
            <Setter Property="Foreground" Value="#E2E8F0" />
            <Setter Property="BorderBrush" Value="#1E3A5F" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="MinWidth" Value="140" />
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.Style>
            <Style TargetType="Grid">
                <Setter Property="Opacity" Value="1" />
                <Setter Property="IsHitTestVisible" Value="True" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsBusy}" Value="True">
                        <Setter Property="Opacity" Value="0.5" />
                        <Setter Property="IsHitTestVisible" Value="False" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Grid.Style>

        <Grid Margin="28,24,28,24" HorizontalAlignment="Stretch">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Hero Header - Enhanced -->
            <Border Grid.Row="0" Background="{StaticResource HeroBrush}" Padding="28,24" CornerRadius="16" BorderThickness="1" BorderBrush="#1A3A5F" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <Border Background="#1E3A5F" CornerRadius="10" Width="42" Height="42" Margin="0,0,14,0">
                                <TextBlock Text="⚡" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Performance Lab" FontSize="22" FontWeight="SemiBold" Foreground="#F5F7FF" TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType" />
                                <TextBlock Text="8-step performance tuning with restore-point gating" Foreground="#94A3B8" FontSize="13" Margin="0,4,0,0" TextOptions.TextFormattingMode="Display" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button Content="Configure boot" Style="{StaticResource SecondaryButton}" Command="{Binding OpenBootConfigCommand}" Margin="0,0,10,0" />
                        <Button Content="Refresh" Style="{StaticResource SecondaryButton}" Command="{Binding RefreshCommand}" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Arm Tweaks Control Panel - NEW Modern Design -->
            <Border Grid.Row="1" Background="#0C1829" BorderBrush="#1A2D47" BorderThickness="1" CornerRadius="14" Padding="20,16" Margin="0,14,0,0" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Arm Tweaks Toggle with Clear Indication -->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- Visual Status Indicator -->
                        <Border Width="12" Height="12" CornerRadius="6" Margin="0,0,12,0" VerticalAlignment="Center">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="#EF4444" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsApplyArmed}" Value="True">
                                            <Setter Property="Background" Value="#22C55E" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                        </Border>

                        <StackPanel VerticalAlignment="Center" Margin="0,0,20,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center" TextOptions.TextFormattingMode="Display">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Tweaks Locked" />
                                            <Setter Property="Foreground" Value="#F87171" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsApplyArmed}" Value="True">
                                                    <Setter Property="Text" Value="Tweaks Armed" />
                                                    <Setter Property="Foreground" Value="#4ADE80" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                            <TextBlock FontSize="12" Foreground="#64748B" Margin="0,3,0,0" TextOptions.TextFormattingMode="Display">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="Enable to apply performance tweaks" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsApplyArmed}" Value="True">
                                                <Setter Property="Text" Value="Apply and restore buttons are now active" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>

                        <!-- Modern Toggle Switch -->
                        <ToggleButton Style="{StaticResource ModernToggle}" IsChecked="{Binding IsApplyArmed, Mode=TwoWay}" ToolTip="Toggle to enable or disable applying tweaks" />
                    </StackPanel>

                    <!-- Separator -->
                    <Border Grid.Column="1" Width="1" Height="36" Background="#1E3A5F" Margin="20,0" VerticalAlignment="Center" />

                    <!-- Boot Automation Toggle -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <StackPanel VerticalAlignment="Center" Margin="0,0,16,0">
                            <TextBlock Text="Boot Automation" FontSize="13" FontWeight="Medium" Foreground="#E2E8F0" TextOptions.TextFormattingMode="Display" />
                            <TextBlock FontSize="11" Foreground="#64748B" Margin="0,2,0,0" TextOptions.TextFormattingMode="Display">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="Off" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsBootAutomationEnabled}" Value="True">
                                                <Setter Property="Text" Value="Runs on startup" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                        <ToggleButton Style="{StaticResource ModernToggle}" IsChecked="{Binding IsBootAutomationEnabled, Mode=TwoWay}" ToolTip="Toggle boot automation" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Status Bar - Compact -->
            <Border Grid.Row="2" Background="#0A1525" BorderBrush="#152640" BorderThickness="1" CornerRadius="10" Padding="16,10" Margin="0,12,0,0" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <TextBlock Text="{Binding ApplyGuardStatus}" Foreground="#94A3B8" FontSize="12" VerticalAlignment="Center" TextOptions.TextFormattingMode="Display" />
            </Border>

            <!-- Steps List - Enhanced Cards -->
            <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto" Margin="0,14,0,0" Padding="0,0,8,0">
                <StackPanel UseLayoutRounding="True" SnapsToDevicePixels="True">

                    <!-- Step 1: Power Plan -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#1E3A5F" Offset="0"/>
                                        <GradientStop Color="#0F2038" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock Text="1" Foreground="#38BDF8" FontWeight="Bold" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="18,0,24,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Power Plan" Style="{StaticResource StepTitleStyle}" />
                                    <!-- Status Chip -->
                                    <Border Margin="12,0,0,0" VerticalAlignment="Center">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#422006" />
                                                <Setter Property="BorderBrush" Value="#F59E0B" />
                                                <Setter Property="BorderThickness" Value="1" />
                                                <Setter Property="CornerRadius" Value="6" />
                                                <Setter Property="Padding" Value="10,4" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsPowerPlanSuccess}" Value="True">
                                                        <Setter Property="Background" Value="#052E16" />
                                                        <Setter Property="BorderBrush" Value="#22C55E" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock FontSize="11" FontWeight="Medium">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="Standard" />
                                                    <Setter Property="Foreground" Value="#FBBF24" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsPowerPlanSuccess}" Value="True">
                                                            <Setter Property="Text" Value="Ultimate Active" />
                                                            <Setter Property="Foreground" Value="#4ADE80" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="PowerPlan" Margin="10,0,0,0" ToolTip="Learn more about power plans" />
                                </StackPanel>
                                <TextBlock Text="{Binding PowerPlanHeadline}" Style="{StaticResource StepDescStyle}" TextTrimming="CharacterEllipsis" />
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Ultimate" Style="{StaticResource CompactPrimaryButton}" Command="{Binding EnableUltimatePlanCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,8,0" />
                                <Button Content="Restore" Style="{StaticResource CompactButton}" Command="{Binding RestorePowerPlanCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 2: Services -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#2E1065" Offset="0"/>
                                        <GradientStop Color="#1E1B4B" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock Text="2" Foreground="#A78BFA" FontWeight="Bold" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="18,0,24,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Service Templates" Style="{StaticResource StepTitleStyle}" />
                                    <Border Margin="12,0,0,0" VerticalAlignment="Center">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#422006" />
                                                <Setter Property="BorderBrush" Value="#F59E0B" />
                                                <Setter Property="BorderThickness" Value="1" />
                                                <Setter Property="CornerRadius" Value="6" />
                                                <Setter Property="Padding" Value="10,4" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsServiceSuccess}" Value="True">
                                                        <Setter Property="Background" Value="#052E16" />
                                                        <Setter Property="BorderBrush" Value="#22C55E" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock FontSize="11" FontWeight="Medium">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="Not Applied" />
                                                    <Setter Property="Foreground" Value="#FBBF24" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsServiceSuccess}" Value="True">
                                                            <Setter Property="Text" Value="Applied" />
                                                            <Setter Property="Foreground" Value="#4ADE80" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Services" Margin="10,0,0,0" ToolTip="Learn more about service templates" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Disable telemetry, Xbox, and consumer services" Style="{StaticResource StepDescStyle}" Margin="0,0,14,0" />
                                    <ComboBox Width="150" ItemsSource="{Binding Templates}" SelectedItem="{Binding SelectedTemplate, Mode=TwoWay}" Background="#0F1D32" Foreground="#E2E8F0" BorderBrush="#1E3A5F" Padding="10,6" FontSize="12">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Apply" Style="{StaticResource CompactPrimaryButton}" Command="{Binding ApplyServiceTemplateCommand}" CommandParameter="{Binding SelectedTemplate}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,8,0" />
                                <Button Content="Restore" Style="{StaticResource CompactButton}" Command="{Binding RestoreServicesCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 3: Hardware Reserved -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#7C2D12" Offset="0"/>
                                        <GradientStop Color="#431407" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock Text="3" Foreground="#FB923C" FontWeight="Bold" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="18,0,24,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Hardware Reserved" Style="{StaticResource StepTitleStyle}" />
                                    <Border Margin="12,0,0,0" VerticalAlignment="Center">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#422006" />
                                                <Setter Property="BorderBrush" Value="#F59E0B" />
                                                <Setter Property="BorderThickness" Value="1" />
                                                <Setter Property="CornerRadius" Value="6" />
                                                <Setter Property="Padding" Value="10,4" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsHardwareSuccess}" Value="True">
                                                        <Setter Property="Background" Value="#052E16" />
                                                        <Setter Property="BorderBrush" Value="#22C55E" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock FontSize="11" FontWeight="Medium">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="Not Checked" />
                                                    <Setter Property="Foreground" Value="#FBBF24" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsHardwareSuccess}" Value="True">
                                                            <Setter Property="Text" Value="Optimized" />
                                                            <Setter Property="Foreground" Value="#4ADE80" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Hardware" Margin="10,0,0,0" ToolTip="Learn more about hardware reserved memory" />
                                </StackPanel>
                                <TextBlock Text="Clear memory caps and manage compression" Style="{StaticResource StepDescStyle}" />
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Detect" Style="{StaticResource CompactButton}" Command="{Binding DetectHardwareReservedCommand}" Margin="0,0,8,0" />
                                <Button Content="Fix" Style="{StaticResource CompactPrimaryButton}" Command="{Binding ApplyHardwareFixCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,8,0" />
                                <Button Content="Restore" Style="{StaticResource CompactButton}" Command="{Binding RestoreCompressionCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 4: Kernel & Boot -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#164E63" Offset="0"/>
                                        <GradientStop Color="#0E3A4A" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock Text="4" Foreground="#22D3EE" FontWeight="Bold" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="18,0,24,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Kernel &amp; Boot" Style="{StaticResource StepTitleStyle}" />
                                    <Border Style="{StaticResource ChipStyle}" Margin="12,0,0,0">
                                        <TextBlock Text="⚠ Anti-cheat" Foreground="#FECACA" FontSize="10" FontWeight="Medium" />
                                    </Border>
                                    <Border Margin="10,0,0,0" VerticalAlignment="Center">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#422006" />
                                                <Setter Property="BorderBrush" Value="#F59E0B" />
                                                <Setter Property="BorderThickness" Value="1" />
                                                <Setter Property="CornerRadius" Value="6" />
                                                <Setter Property="Padding" Value="10,4" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsKernelSuccess}" Value="True">
                                                        <Setter Property="Background" Value="#052E16" />
                                                        <Setter Property="BorderBrush" Value="#22C55E" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock FontSize="11" FontWeight="Medium">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="Default" />
                                                    <Setter Property="Foreground" Value="#FBBF24" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsKernelSuccess}" Value="True">
                                                            <Setter Property="Text" Value="Tuned" />
                                                            <Setter Property="Foreground" Value="#4ADE80" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Kernel" Margin="10,0,0,0" ToolTip="Learn more about kernel tweaks" />
                                </StackPanel>
                                <TextBlock Text="Timer and boot tweaks with restore-point gating" Style="{StaticResource StepDescStyle}" />
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Apply" Style="{StaticResource CompactPrimaryButton}" Command="{Binding ApplyKernelPresetCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,8,0" />
                                <Button Content="Restore" Style="{StaticResource CompactButton}" Command="{Binding RestoreKernelDefaultsCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 5: VBS/HVCI -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#115E59" Offset="0"/>
                                        <GradientStop Color="#0D3D38" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock Text="5" Foreground="#2DD4BF" FontWeight="Bold" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="18,0,24,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Core Isolation (VBS)" Style="{StaticResource StepTitleStyle}" />
                                    <Border Style="{StaticResource ChipStyle}" Margin="12,0,0,0">
                                        <TextBlock Text="⚠ Anti-cheat" Foreground="#FECACA" FontSize="10" FontWeight="Medium" />
                                    </Border>
                                    <Border Margin="10,0,0,0" VerticalAlignment="Center">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#422006" />
                                                <Setter Property="BorderBrush" Value="#F59E0B" />
                                                <Setter Property="BorderThickness" Value="1" />
                                                <Setter Property="CornerRadius" Value="6" />
                                                <Setter Property="Padding" Value="10,4" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsVbsSuccess}" Value="True">
                                                        <Setter Property="Background" Value="#052E16" />
                                                        <Setter Property="BorderBrush" Value="#22C55E" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock FontSize="11" FontWeight="Medium">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="Enabled" />
                                                    <Setter Property="Foreground" Value="#FBBF24" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsVbsSuccess}" Value="True">
                                                            <Setter Property="Text" Value="Disabled" />
                                                            <Setter Property="Foreground" Value="#4ADE80" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Vbs" Margin="10,0,0,0" ToolTip="Learn more about VBS/HVCI" />
                                </StackPanel>
                                <TextBlock Text="Toggle VBS/HVCI for benchmarking or security" Style="{StaticResource StepDescStyle}" />
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Detect" Style="{StaticResource CompactButton}" Command="{Binding DetectVbsHvciCommand}" Margin="0,0,8,0" />
                                <Button Content="Disable" Style="{StaticResource CompactPrimaryButton}" Command="{Binding DisableVbsHvciCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,8,0" />
                                <Button Content="Restore" Style="{StaticResource CompactButton}" Command="{Binding RestoreVbsHvciCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 6: ETW -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#1E40AF" Offset="0"/>
                                        <GradientStop Color="#1E3A8A" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock Text="6" Foreground="#60A5FA" FontWeight="Bold" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="18,0,24,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="ETW Tracing" Style="{StaticResource StepTitleStyle}" />
                                    <Border Style="{StaticResource ChipStyle}" Margin="12,0,0,0">
                                        <TextBlock Text="⚠ Anti-cheat" Foreground="#FECACA" FontSize="10" FontWeight="Medium" />
                                    </Border>
                                    <Border Margin="10,0,0,0" VerticalAlignment="Center">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#422006" />
                                                <Setter Property="BorderBrush" Value="#F59E0B" />
                                                <Setter Property="BorderThickness" Value="1" />
                                                <Setter Property="CornerRadius" Value="6" />
                                                <Setter Property="Padding" Value="10,4" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsEtwSuccess}" Value="True">
                                                        <Setter Property="Background" Value="#052E16" />
                                                        <Setter Property="BorderBrush" Value="#22C55E" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock FontSize="11" FontWeight="Medium">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="Default" />
                                                    <Setter Property="Foreground" Value="#FBBF24" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsEtwSuccess}" Value="True">
                                                            <Setter Property="Text" Value="Cleaned" />
                                                            <Setter Property="Foreground" Value="#4ADE80" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Etw" Margin="10,0,0,0" ToolTip="Learn more about ETW tracing" />
                                </StackPanel>
                                <TextBlock Text="Stop noisy traces and restore from baseline" Style="{StaticResource StepDescStyle}" />
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Detect" Style="{StaticResource CompactButton}" Command="{Binding DetectEtwSessionsCommand}" Margin="0,0,8,0" />
                                <Button Content="Minimal" Style="{StaticResource CompactPrimaryButton}" Command="{Binding CleanupEtwMinimalCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,8,0" />
                                <Button Content="Aggressive" Style="{StaticResource CompactButton}" Command="{Binding CleanupEtwAggressiveCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,8,0" />
                                <Button Content="Restore" Style="{StaticResource CompactButton}" Command="{Binding RestoreEtwDefaultsCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 7: Scheduler -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#92400E" Offset="0"/>
                                        <GradientStop Color="#78350F" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock Text="7" Foreground="#FBBF24" FontWeight="Bold" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="18,0,24,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Scheduler &amp; Affinity" Style="{StaticResource StepTitleStyle}" />
                                    <Border Style="{StaticResource ChipStyle}" Margin="12,0,0,0">
                                        <TextBlock Text="⚠ Anti-cheat" Foreground="#FECACA" FontSize="10" FontWeight="Medium" />
                                    </Border>
                                    <Border Margin="10,0,0,0" VerticalAlignment="Center">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#422006" />
                                                <Setter Property="BorderBrush" Value="#F59E0B" />
                                                <Setter Property="BorderThickness" Value="1" />
                                                <Setter Property="CornerRadius" Value="6" />
                                                <Setter Property="Padding" Value="10,4" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsSchedulerSuccess}" Value="True">
                                                        <Setter Property="Background" Value="#052E16" />
                                                        <Setter Property="BorderBrush" Value="#22C55E" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock FontSize="11" FontWeight="Medium">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="Default" />
                                                    <Setter Property="Foreground" Value="#FBBF24" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsSchedulerSuccess}" Value="True">
                                                            <Setter Property="Text" Value="Applied" />
                                                            <Setter Property="Foreground" Value="#4ADE80" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Scheduler" Margin="10,0,0,0" ToolTip="Learn more about scheduler" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding SchedulerProcessNames, StringFormat='Targets: {0}', FallbackValue='No processes configured'}" Style="{StaticResource StepDescStyle}" Margin="0,0,14,0" TextTrimming="CharacterEllipsis" MaxWidth="200" />
                                    <Button Content="Manage" Style="{StaticResource CompactButton}" Command="{Binding OpenSchedulerPickerCommand}" Padding="12,6" FontSize="11" MinWidth="64" Margin="0,0,8,0" />
                                    <ComboBox Width="130" ItemsSource="{Binding SchedulerPresets}" SelectedItem="{Binding SelectedSchedulerPreset, Mode=TwoWay}" Background="#0F1D32" Foreground="#E2E8F0" BorderBrush="#1E3A5F" Padding="10,6" FontSize="12">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Detect" Style="{StaticResource CompactButton}" Command="{Binding DetectSchedulerCommand}" Margin="0,0,8,0" />
                                <Button Content="Apply" Style="{StaticResource CompactPrimaryButton}" Command="{Binding ApplySchedulerPresetCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,8,0" />
                                <Button Content="Restore" Style="{StaticResource CompactButton}" Command="{Binding RestoreSchedulerDefaultsCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 8: Auto-tune -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#5B21B6" Offset="0"/>
                                        <GradientStop Color="#4C1D95" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock Text="8" Foreground="#C4B5FD" FontWeight="Bold" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="18,0,24,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Auto-tune Monitor" Style="{StaticResource StepTitleStyle}" />
                                    <Border Margin="12,0,0,0" VerticalAlignment="Center">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#422006" />
                                                <Setter Property="BorderBrush" Value="#F59E0B" />
                                                <Setter Property="BorderThickness" Value="1" />
                                                <Setter Property="CornerRadius" Value="6" />
                                                <Setter Property="Padding" Value="10,4" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsAutoTuneSuccess}" Value="True">
                                                        <Setter Property="Background" Value="#052E16" />
                                                        <Setter Property="BorderBrush" Value="#22C55E" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock FontSize="11" FontWeight="Medium">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="Stopped" />
                                                    <Setter Property="Foreground" Value="#FBBF24" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsAutoTuneSuccess}" Value="True">
                                                            <Setter Property="Text" Value="Running" />
                                                            <Setter Property="Foreground" Value="#4ADE80" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="AutoTune" Margin="10,0,0,0" ToolTip="Learn more about auto-tune" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Watch for apps and apply presets automatically" Style="{StaticResource StepDescStyle}" Margin="0,0,14,0" />
                                    <Button Content="Manage" Style="{StaticResource CompactButton}" Command="{Binding OpenAutoTunePickerCommand}" Padding="12,6" FontSize="11" MinWidth="64" Margin="0,0,8,0" />
                                    <ComboBox Width="130" ItemsSource="{Binding SchedulerPresets}" SelectedValuePath="Id" SelectedValue="{Binding AutoTunePresetId, Mode=TwoWay}" Background="#0F1D32" Foreground="#E2E8F0" BorderBrush="#1E3A5F" Padding="10,6" FontSize="12">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Detect" Style="{StaticResource CompactButton}" Command="{Binding DetectAutoTuneCommand}" Margin="0,0,8,0" />
                                <Button Content="Start" Style="{StaticResource CompactPrimaryButton}" Command="{Binding StartAutoTuneCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,8,0" />
                                <Button Content="Stop" Style="{StaticResource CompactButton}" Command="{Binding StopAutoTuneCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Boot Config Dialog - Modern Design -->
        <Grid Panel.ZIndex="12" Background="#E0020617" Visibility="{Binding IsBootConfigDialogVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border MaxWidth="500" Padding="28,24" Background="#0C1829" BorderBrush="#1A3A5F" BorderThickness="1" CornerRadius="20" HorizontalAlignment="Center" VerticalAlignment="Center" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="60" ShadowDepth="8" Opacity="0.7" Color="#000000"/>
                </Border.Effect>
                <StackPanel>
                    <!-- Header -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <Border CornerRadius="14" Width="52" Height="52" SnapsToDevicePixels="True">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#1E40AF" Offset="0"/>
                                    <GradientStop Color="#1E3A8A" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="🚀" FontSize="22" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel Margin="16,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="Boot Automation" FontSize="18" FontWeight="SemiBold" Foreground="#F1F5F9" TextOptions.TextFormattingMode="Display" />
                            <TextBlock Text="Select which performance steps run automatically on system startup." Foreground="#94A3B8" FontSize="12" Margin="0,4,0,0" TextWrapping="Wrap" MaxWidth="340" TextOptions.TextFormattingMode="Display" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Checkbox List -->
                    <Border Background="#0A1525" BorderBrush="#152640" BorderThickness="1" CornerRadius="14" Padding="20,16" Margin="0,0,0,20">
                        <StackPanel>
                            <CheckBox Content="Power Plan (Ultimate Performance)" IsChecked="{Binding AutoApplyPowerPlan, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="13" Margin="0,0,0,12" />
                            <CheckBox Content="Service Templates" IsChecked="{Binding AutoApplyServices, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="13" Margin="0,0,0,12" />
                            <CheckBox Content="Hardware Reserved Fix" IsChecked="{Binding AutoApplyHardware, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="13" Margin="0,0,0,12" />
                            <CheckBox Content="Kernel &amp; Boot Tweaks" IsChecked="{Binding AutoApplyKernel, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="13" Margin="0,0,0,12" />
                            <CheckBox Content="Core Isolation (VBS/HVCI)" IsChecked="{Binding AutoApplyVbs, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="13" Margin="0,0,0,12" />
                            <CheckBox Content="ETW Tracing Cleanup" IsChecked="{Binding AutoApplyEtw, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="13" Margin="0,0,0,12" />
                            <CheckBox Content="Scheduler &amp; Affinity" IsChecked="{Binding AutoApplyScheduler, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="13" Margin="0,0,0,12" />
                            <CheckBox Content="Auto-tune Monitor" IsChecked="{Binding AutoApplyAutoTune, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="13" />
                        </StackPanel>
                    </Border>

                    <!-- Status Message -->
                    <Border Background="#0A1525" BorderBrush="#152640" BorderThickness="1" CornerRadius="10" Padding="14,10" Margin="0,0,0,20">
                        <StackPanel Orientation="Horizontal">
                            <Border Width="8" Height="8" CornerRadius="4" Margin="0,0,10,0" VerticalAlignment="Center">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Background" Value="#64748B" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsBootAutomationEnabled}" Value="True">
                                                <Setter Property="Background" Value="#22C55E" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>
                            <TextBlock Text="{Binding BootAutomationStatus}" Foreground="#94A3B8" FontSize="12" TextWrapping="Wrap" TextOptions.TextFormattingMode="Display" />
                        </StackPanel>
                    </Border>

                    <!-- Actions -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="1" Content="Save" Style="{StaticResource PrimaryButton}" Command="{Binding ApplyBootAutomationCommand}" MinWidth="100" Margin="0,0,10,0" />
                        <Button Grid.Column="2" Content="Close" Style="{StaticResource SecondaryButton}" Command="{Binding CloseBootConfigDialogCommand}" MinWidth="100" />
                    </Grid>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Scheduler Picker Dialog - Modern Design -->
        <Grid Panel.ZIndex="11" Background="#E0020617" Visibility="{Binding IsSchedulerPickerVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border MaxWidth="520" Padding="28,24" Background="#0C1829" BorderBrush="#1A3A5F" BorderThickness="1" CornerRadius="20" HorizontalAlignment="Center" VerticalAlignment="Center" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="60" ShadowDepth="8" Opacity="0.7" Color="#000000"/>
                </Border.Effect>
                <StackPanel>
                    <!-- Header -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <Border CornerRadius="14" Width="52" Height="52" SnapsToDevicePixels="True">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#92400E" Offset="0"/>
                                    <GradientStop Color="#78350F" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="⚙" FontSize="22" Foreground="#FBBF24" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel Margin="16,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="Scheduler Processes" FontSize="18" FontWeight="SemiBold" Foreground="#F1F5F9" TextOptions.TextFormattingMode="Display" />
                            <TextBlock Text="Add processes that should receive the scheduler performance preset." Foreground="#94A3B8" FontSize="12" Margin="0,4,0,0" TextWrapping="Wrap" MaxWidth="360" TextOptions.TextFormattingMode="Display" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Process List -->
                    <Border Background="#0A1525" BorderBrush="#152640" BorderThickness="1" CornerRadius="14" Padding="16" Margin="0,0,0,20">
                        <StackPanel>
                            <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                                <ListBox ItemsSource="{Binding SchedulerProcesses}" SelectedItem="{Binding SelectedSchedulerProcess, Mode=TwoWay}" Background="Transparent" BorderThickness="0" Foreground="#E2E8F0">
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Padding" Value="14,10" />
                                            <Setter Property="Margin" Value="0,3" />
                                            <Setter Property="Background" Value="#0C1829" />
                                            <Setter Property="BorderBrush" Value="#1E3A5F" />
                                            <Setter Property="BorderThickness" Value="1" />
                                            <Setter Property="FontSize" Value="13" />
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="BorderBrush" Value="#38BDF8" />
                                                    <Setter Property="Background" Value="#152640" />
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#0E1D32" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                </ListBox>
                            </ScrollViewer>
                            <TextBlock Text="No processes configured yet. Add a process name below." Foreground="#64748B" FontSize="12" HorizontalAlignment="Center" Margin="0,16,0,16">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SchedulerProcesses.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <StackPanel Orientation="Horizontal" Margin="0,14,0,0">
                                <TextBox Width="240" Margin="0,0,10,0" Background="#0C1829" Foreground="#E2E8F0" BorderBrush="#1E3A5F" Padding="14,10" FontSize="13" Text="{Binding NewSchedulerProcessName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                <Button Content="Add" Style="{StaticResource PrimaryButton}" Command="{Binding AddSchedulerProcessCommand}" Padding="16,10" Margin="0,0,8,0" />
                                <Button Content="Remove" Style="{StaticResource SecondaryButton}" Command="{Binding RemoveSchedulerProcessCommand}" Padding="16,10" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Button Content="Close" Style="{StaticResource SecondaryButton}" Command="{Binding CloseSchedulerPickerCommand}" HorizontalAlignment="Right" MinWidth="100" />
                </StackPanel>
            </Border>
        </Grid>

        <!-- Auto-tune Picker Dialog - Modern Design -->
        <Grid Panel.ZIndex="10" Background="#E0020617" Visibility="{Binding IsAutoTunePickerVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border MaxWidth="520" Padding="28,24" Background="#0C1829" BorderBrush="#1A3A5F" BorderThickness="1" CornerRadius="20" HorizontalAlignment="Center" VerticalAlignment="Center" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="60" ShadowDepth="8" Opacity="0.7" Color="#000000"/>
                </Border.Effect>
                <StackPanel>
                    <!-- Header -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <Border CornerRadius="14" Width="52" Height="52" SnapsToDevicePixels="True">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#5B21B6" Offset="0"/>
                                    <GradientStop Color="#4C1D95" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="🎯" FontSize="22" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel Margin="16,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="Auto-tune Processes" FontSize="18" FontWeight="SemiBold" Foreground="#F1F5F9" TextOptions.TextFormattingMode="Display" />
                            <TextBlock Text="Add games or apps that trigger auto-tune optimization on launch." Foreground="#94A3B8" FontSize="12" Margin="0,4,0,0" TextWrapping="Wrap" MaxWidth="360" TextOptions.TextFormattingMode="Display" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Process List -->
                    <Border Background="#0A1525" BorderBrush="#152640" BorderThickness="1" CornerRadius="14" Padding="16" Margin="0,0,0,20">
                        <StackPanel>
                            <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                                <ListBox ItemsSource="{Binding AutoTuneProcesses}" SelectedItem="{Binding SelectedAutoTuneProcess, Mode=TwoWay}" Background="Transparent" BorderThickness="0" Foreground="#E2E8F0">
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Padding" Value="14,10" />
                                            <Setter Property="Margin" Value="0,3" />
                                            <Setter Property="Background" Value="#0C1829" />
                                            <Setter Property="BorderBrush" Value="#1E3A5F" />
                                            <Setter Property="BorderThickness" Value="1" />
                                            <Setter Property="FontSize" Value="13" />
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="BorderBrush" Value="#A78BFA" />
                                                    <Setter Property="Background" Value="#152640" />
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#0E1D32" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                </ListBox>
                            </ScrollViewer>
                            <TextBlock Text="No processes configured yet. Add a game or app name below." Foreground="#64748B" FontSize="12" HorizontalAlignment="Center" Margin="0,16,0,16">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding AutoTuneProcesses.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <StackPanel Orientation="Horizontal" Margin="0,14,0,0">
                                <TextBox Width="240" Margin="0,0,10,0" Background="#0C1829" Foreground="#E2E8F0" BorderBrush="#1E3A5F" Padding="14,10" FontSize="13" Text="{Binding NewAutoTuneProcessName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                <Button Content="Add" Style="{StaticResource PrimaryButton}" Command="{Binding AddAutoTuneProcessCommand}" Padding="16,10" Margin="0,0,8,0" />
                                <Button Content="Remove" Style="{StaticResource SecondaryButton}" Command="{Binding RemoveAutoTuneProcessCommand}" Padding="16,10" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Button Content="Close" Style="{StaticResource SecondaryButton}" Command="{Binding CloseAutoTunePickerCommand}" HorizontalAlignment="Right" MinWidth="100" />
                </StackPanel>
            </Border>
        </Grid>

        <!-- Info Dialog - Modern Design -->
        <Grid Panel.ZIndex="9" Background="#E0020617" Visibility="{Binding IsInfoDialogVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border MaxWidth="520" Padding="28,24" Background="#0C1829" BorderBrush="#1A3A5F" BorderThickness="1" CornerRadius="20" HorizontalAlignment="Center" VerticalAlignment="Center" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="60" ShadowDepth="8" Opacity="0.7" Color="#000000"/>
                </Border.Effect>
                <StackPanel>
                    <!-- Header -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <Border CornerRadius="14" Width="52" Height="52" SnapsToDevicePixels="True">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#0E7490" Offset="0"/>
                                    <GradientStop Color="#0D5A73" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="ℹ" FontSize="24" Foreground="#22D3EE" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel Margin="16,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="{Binding InfoDialogTitle}" FontSize="18" FontWeight="SemiBold" Foreground="#F1F5F9" TextOptions.TextFormattingMode="Display" />
                            <TextBlock Text="Performance tip" Foreground="#64748B" FontSize="12" Margin="0,2,0,0" TextOptions.TextFormattingMode="Display" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Content -->
                    <Border Background="#0A1525" BorderBrush="#152640" BorderThickness="1" CornerRadius="14" Padding="20,16" Margin="0,0,0,20">
                        <ScrollViewer MaxHeight="280" VerticalScrollBarVisibility="Auto">
                            <TextBlock Text="{Binding InfoDialogBody}" Foreground="#CBD5E1" FontSize="13" TextWrapping="Wrap" LineHeight="22" TextOptions.TextFormattingMode="Display" />
                        </ScrollViewer>
                    </Border>

                    <Button Content="Got it" Style="{StaticResource PrimaryButton}" Command="{Binding CloseInfoDialogCommand}" HorizontalAlignment="Right" MinWidth="100" />
                </StackPanel>
            </Border>
        </Grid>

        <!-- Busy Overlay - Modern Design -->
        <Grid Panel.ZIndex="8" Background="#E0020617" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Background="#0C1829" Padding="32,28" CornerRadius="20" BorderBrush="#1A3A5F" BorderThickness="1" HorizontalAlignment="Center" VerticalAlignment="Center" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="60" ShadowDepth="8" Opacity="0.7" Color="#000000"/>
                </Border.Effect>
                <StackPanel HorizontalAlignment="Center">
                    <Border Width="48" Height="48" CornerRadius="24" Margin="0,0,0,16">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#14B8A6" Offset="0"/>
                                <GradientStop Color="#0D9488" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <TextBlock Text="⚡" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <TextBlock Text="Applying changes..." Foreground="#F1F5F9" FontWeight="SemiBold" FontSize="14" HorizontalAlignment="Center" Margin="0,0,0,12" TextOptions.TextFormattingMode="Display" />
                    <ProgressBar IsIndeterminate="True" Height="4" Width="180" Background="#1E293B" Foreground="#14B8A6" />
                    <TextBlock Text="Please wait" Foreground="#64748B" FontSize="11" HorizontalAlignment="Center" Margin="0,10,0,0" TextOptions.TextFormattingMode="Display" />
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>
