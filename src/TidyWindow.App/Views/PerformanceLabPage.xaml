<Page x:Class="TidyWindow.App.Views.PerformanceLabPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d"
      Title="Performance Lab"
      Background="Transparent"
      UseLayoutRounding="True"
      SnapsToDevicePixels="True"
      TextOptions.TextFormattingMode="Display"
      TextOptions.TextRenderingMode="ClearType"
      TextOptions.TextHintingMode="Fixed"
      RenderOptions.BitmapScalingMode="HighQuality">
    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

        <LinearGradientBrush x:Key="PerfHeroBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#0A1F36" Offset="0" />
            <GradientStop Color="#0D2740" Offset="0.45" />
            <GradientStop Color="#0B334A" Offset="1" />
        </LinearGradientBrush>

        <SolidColorBrush x:Key="PerfHeroTitleBrush" Color="#F5F7FF" />
        <SolidColorBrush x:Key="PerfHeroBodyBrush" Color="#C6D4EE" />
        <SolidColorBrush x:Key="PerfCardBrush" Color="#0C1424" />
        <SolidColorBrush x:Key="PerfCardBorderBrush" Color="#1B2538" />
        <SolidColorBrush x:Key="PerfCardOverlayBrush" Color="#0F1B30" />
        <SolidColorBrush x:Key="PerfChipSuccessBrush" Color="#0F2F25" />
        <SolidColorBrush x:Key="PerfChipWarningBrush" Color="#2C1A1A" />
        <SolidColorBrush x:Key="PerfChipBorderSuccess" Color="#22C55E" />
        <SolidColorBrush x:Key="PerfChipBorderWarning" Color="#F87171" />
        <SolidColorBrush x:Key="PerfAccentBrush" Color="#38BDF8" />
        <SolidColorBrush x:Key="PerfAccentDeepBrush" Color="#0EA5E9" />
        <SolidColorBrush x:Key="PerfMutedBrush" Color="#8CA3C5" />

        <Style x:Key="HeroTitleTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{StaticResource PerfHeroTitleBrush}" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>

        <Style x:Key="HeroBodyTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="{StaticResource PerfHeroBodyBrush}" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>

        <Style x:Key="ChipStyle" TargetType="Border">
            <Setter Property="Background" Value="#0E1D33" />
            <Setter Property="BorderBrush" Value="#1D3B58" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="Margin" Value="0,0,10,0" />
        </Style>

        <Style x:Key="StatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPowerPlanSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsPowerPlanSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ServiceStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsServiceSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsServiceSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="HardwareStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsHardwareSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsHardwareSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="KernelStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsKernelSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsKernelSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="VbsStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsVbsSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsVbsSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="EtwStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsEtwSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsEtwSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PagefileStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPagefileSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsPagefileSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SchedulerStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsSchedulerSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsSchedulerSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DirectStorageStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsDirectStorageSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsDirectStorageSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="AutoTuneStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsAutoTuneSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsAutoTuneSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="#07111D" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root" CornerRadius="12" Padding="{TemplateBinding Padding}">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#34D399" Offset="0" />
                                    <GradientStop Color="#22C55E" Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.01" ScaleY="1.01" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="OutlineButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="#E2E8F0" />
            <Setter Property="Background" Value="#0E1A2C" />
            <Setter Property="BorderBrush" Value="#1F2E46" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="BorderBrush" Value="#38BDF8" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource PerfCardBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource PerfCardBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,0,12" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="UseLayoutRounding" Value="True" />
        </Style>

        <Style x:Key="SectionHeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="#E5E7EB" />
        </Style>

        <Style x:Key="SubtleCaptionTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Foreground" Value="{StaticResource PerfMutedBrush}" />
            <Setter Property="TextWrapping" Value="Wrap" />
        </Style>

        <Style x:Key="StepBadgeStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="Padding" Value="10,6" />
            <Setter Property="Background" Value="#111B2D" />
            <Setter Property="BorderBrush" Value="#1F2E46" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Margin" Value="0,0,10,0" />
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.Style>
            <Style TargetType="Grid">
                <Setter Property="Opacity" Value="1" />
                <Setter Property="IsHitTestVisible" Value="True" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsBusy}" Value="True">
                        <Setter Property="Opacity" Value="0.5" />
                        <Setter Property="IsHitTestVisible" Value="False" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Grid.Style>

        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="24">
                <Border Background="{StaticResource PerfHeroBrush}" Padding="22" CornerRadius="18" BorderThickness="1" BorderBrush="#12314A">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel>
                            <TextBlock Text="Performance Lab" Style="{StaticResource HeroTitleTextStyle}" FontSize="22" />
                            <TextBlock Margin="0,6,0,0" Text="10-step performance stack: power, services, memory, kernel, security, tracing, storage, scheduler, and auto-tune—each with backups and rollbacks." Style="{StaticResource HeroBodyTextStyle}" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" Margin="0,0,10,0">
                                    <ProgressBar Width="90" Height="8" IsIndeterminate="True" Foreground="{StaticResource PerfAccentBrush}" Background="#0E1C30" BorderBrush="#1F2E46" />
                                    <TextBlock Text="Working..." Margin="8,0,0,0" Foreground="#E5E7EB" FontSize="12" VerticalAlignment="Center" />
                                </StackPanel>
                                <Button Content="Refresh" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RefreshCommand}" Margin="0,0,10,0" />
                                <Button Content="Show status" Style="{StaticResource OutlineButtonStyle}" Command="{Binding ShowStatusCommand}" Margin="0,0,10,0" />
                                <Border Padding="10,8" CornerRadius="12" Background="#102033" BorderBrush="#1F2E46" BorderThickness="1">
                                    <TextBlock Text="Guarded tweaks only" Foreground="#C6D4EE" FontSize="12" />
                                </Border>
                            </StackPanel>
                            <TextBlock Margin="0,8,0,0" Text="Follow the steps below. Each feature is isolated, backed up, and reversible." Style="{StaticResource HeroBodyTextStyle}" />
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Feature walk-through removed for a cleaner layout -->

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 1" Foreground="{StaticResource PerfAccentBrush}" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Power plan" Style="{StaticResource SectionHeaderTextStyle}" />
                            <Button Content="Info"
                                    Style="{StaticResource OutlineButtonStyle}"
                                    Padding="10,4"
                                    Margin="8,0,0,0"
                                    Command="{Binding ShowStepInfoCommand}"
                                    CommandParameter="PowerPlan" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="{Binding PowerPlanDetails}" Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Enable Ultimate plan" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding EnableUltimatePlanCommand}" Margin="0,0,10,0" />
                            <Button Content="Restore previous plan" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestorePowerPlanCommand}" />
                        </StackPanel>

                        <Border Margin="0,12,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Active plan" Foreground="#A5F3FC" FontSize="12" />
                                <TextBlock Margin="0,2,0,0" Text="{Binding PowerPlanHeadline}" Foreground="#E5E7EB" FontSize="14" FontWeight="SemiBold" />
                                <TextBlock Margin="0,2,0,0" Text="{Binding PowerPlanDetails}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="{Binding LastPowerPlanBackupPath}" Foreground="#9CA3AF" FontSize="11" TextWrapping="Wrap" Visibility="{Binding HasPowerPlanBackup, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                <TextBlock Margin="0,6,0,0" Text="Backups live at %ProgramData%/TidyWindow/PerformanceLab/powerplan-state.json." Foreground="#93A3BC" FontSize="11" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource StatusChipStyle}">
                                <TextBlock Text="{Binding PowerPlanStatusSimple}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 2" Foreground="#A5B4FC" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Service templates" Style="{StaticResource SectionHeaderTextStyle}" />
                            <Button Content="Info"
                                    Style="{StaticResource OutlineButtonStyle}"
                                    Padding="10,4"
                                    Margin="8,0,0,0"
                                    Command="{Binding ShowStepInfoCommand}"
                                    CommandParameter="Services" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Disable telemetry, Xbox, and other consumer services with reversible templates." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <ListBox ItemsSource="{Binding Templates}" SelectedItem="{Binding SelectedTemplate, Mode=TwoWay}" Margin="0,8,0,0" Background="#0E1C30" BorderBrush="#1F2E46" Foreground="#E5E7EB">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Margin" Value="4" />
                                    <Setter Property="Padding" Value="8" />
                                    <Setter Property="Background" Value="Transparent" />
                                    <Setter Property="BorderThickness" Value="1" />
                                    <Setter Property="BorderBrush" Value="#1F2E46" />
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="BorderBrush" Value="{StaticResource PerfAccentBrush}" />
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#11243A" />
                                            <Setter Property="BorderBrush" Value="{StaticResource PerfAccentBrush}" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Vertical">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                                            <Border Margin="8,0,0,0" Padding="8,3" Background="#12263C" CornerRadius="10">
                                                <TextBlock Text="{Binding ServiceCount}" Foreground="#93C5FD" FontSize="11" />
                                            </Border>
                                        </StackPanel>
                                        <TextBlock Text="{Binding Description}" Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                            <Button Content="Apply template" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding ApplyServiceTemplateCommand}" CommandParameter="{Binding SelectedTemplate}" Margin="0,0,10,0" />
                            <Button Content="Restore services" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestoreServicesCommand}" />
                        </StackPanel>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="{Binding ServicesDetails}" Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="{Binding LastServiceBackupPath}" Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" Visibility="{Binding HasServiceBackup, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource ServiceStatusChipStyle}">
                                <TextBlock Text="{Binding ServiceStatusSimple}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 3" Foreground="#F97316" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Hardware reserved memory" Style="{StaticResource SectionHeaderTextStyle}" />
                            <Button Content="Info"
                                    Style="{StaticResource OutlineButtonStyle}"
                                    Padding="10,4"
                                    Margin="8,0,0,0"
                                    Command="{Binding ShowStepInfoCommand}"
                                    CommandParameter="Hardware" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Detect misreported RAM, clear truncatememory/maxmem flags, and control memory compression." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Detect reserved memory" Style="{StaticResource OutlineButtonStyle}" Command="{Binding DetectHardwareReservedCommand}" Margin="0,0,10,0" />
                            <Button Content="Apply fixer" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding ApplyHardwareFixCommand}" Margin="0,0,10,0" />
                            <Button Content="Restore compression" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestoreCompressionCommand}" />
                        </StackPanel>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Keeps BCD memory caps clear and disables memory compression by request. Use detect first to understand current state." Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="Reminder: msconfig > Boot > Advanced options should have Maximum memory unchecked." Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource HardwareStatusChipStyle}">
                                <TextBlock Text="{Binding HardwareStatusSimple}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 4" Foreground="#22D3EE" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Kernel &amp; boot controls" Style="{StaticResource SectionHeaderTextStyle}" />
                            <Button Content="Info"
                                    Style="{StaticResource OutlineButtonStyle}"
                                    Padding="10,4"
                                    Margin="8,0,0,0"
                                    Command="{Binding ShowStepInfoCommand}"
                                    CommandParameter="Kernel" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Apply timer and boot tweaks with restore-point gating: dynamic tick, platform clock, tscsyncpolicy, and linearaddress57." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Apply recommended preset" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding ApplyKernelPresetCommand}" Margin="0,0,10,0" />
                            <Button Content="Restore defaults" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestoreKernelDefaultsCommand}" />
                        </StackPanel>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Recommended preset sets disabledynamictick, enables platform clock, sets tscsyncpolicy Enhanced, and toggles linearaddress57 for >128GB rigs." Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="Restore defaults removes those BCD values. A restore point is attempted before apply." Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource KernelStatusChipStyle}">
                                <TextBlock Text="{Binding KernelStatusSimple}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 5" Foreground="#2DD4BF" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Core Isolation (VBS/HVCI)" Style="{StaticResource SectionHeaderTextStyle}" />
                            <Button Content="Info"
                                    Style="{StaticResource OutlineButtonStyle}"
                                    Padding="10,4"
                                    Margin="8,0,0,0"
                                    Command="{Binding ShowStepInfoCommand}"
                                    CommandParameter="Vbs" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Detect Core Isolation status, disable VBS/HVCI for benchmarking, or restore defaults for security." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Detect status" Style="{StaticResource OutlineButtonStyle}" Command="{Binding DetectVbsHvciCommand}" Margin="0,0,10,0" />
                            <Button Content="Disable VBS/HVCI" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding DisableVbsHvciCommand}" Margin="0,0,10,0" />
                            <Button Content="Restore defaults" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestoreVbsHvciCommand}" />
                        </StackPanel>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Disabling uses hypervisorlaunchtype off and clears HVCI registry flags. Restoring sets hypervisor to Auto and re-enables Core Isolation if supported." Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="Reboot is required after disable/restore. Unsupported hardware returns warnings without changes." Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource VbsStatusChipStyle}">
                                <TextBlock Text="{Binding VbsStatusSimple}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 6" Foreground="#60A5FA" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="ETW tracing cleanup" Style="{StaticResource SectionHeaderTextStyle}" />
                            <Button Content="Info"
                                    Style="{StaticResource OutlineButtonStyle}"
                                    Padding="10,4"
                                    Margin="8,0,0,0"
                                    Command="{Binding ShowStepInfoCommand}"
                                    CommandParameter="Etw" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Inspect active ETW sessions, stop noisy traces in tiers, and restore defaults from baseline." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Detect sessions" Style="{StaticResource OutlineButtonStyle}" Command="{Binding DetectEtwSessionsCommand}" Margin="0,0,10,0" />
                            <Button Content="Stop (Minimal)" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding CleanupEtwMinimalCommand}" Margin="0,0,10,0" />
                            <Button Content="Stop (Aggressive)" Style="{StaticResource OutlineButtonStyle}" Command="{Binding CleanupEtwAggressiveCommand}" Margin="0,0,10,0" />
                            <Button Content="Restore defaults" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestoreEtwDefaultsCommand}" />
                        </StackPanel>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Minimal stops noisy user sessions; Aggressive halts more providers. A baseline of defaults is saved to %ProgramData%/TidyWindow/PerformanceLab/etw-baseline.txt on first run." Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="Use restore to restart allowlisted system sessions if anything important was stopped." Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource EtwStatusChipStyle}">
                                <TextBlock Text="{Binding EtwStatusSimple}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 7" Foreground="#C084FC" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Pagefile &amp; memory deep-tuning" Style="{StaticResource SectionHeaderTextStyle}" />
                            <Button Content="Info"
                                    Style="{StaticResource OutlineButtonStyle}"
                                    Padding="10,4"
                                    Margin="8,0,0,0"
                                    Command="{Binding ShowStepInfoCommand}"
                                    CommandParameter="Pagefile" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Move the pagefile to a fast drive, set fixed sizes, or sweep working sets. Defaults remain system-managed." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <ComboBox Width="220"
                                      Margin="0,0,8,0"
                                      ItemsSource="{Binding PagefilePresets}"
                                      SelectedItem="{Binding SelectedPagefilePreset, Mode=TwoWay}"
                                      TextSearch.TextPath="Name"
                                      IsEditable="False"
                                      ToolTip="Choose a pagefile preset">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <Button Content="Detect pagefile" Style="{StaticResource OutlineButtonStyle}" Command="{Binding DetectPagefileCommand}" Margin="0,0,8,0" />
                            <Button Content="Apply preset" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding ApplyPagefilePresetCommand}" Margin="0,0,8,0" />
                            <Button Content="Sweep working sets" Style="{StaticResource OutlineButtonStyle}" Command="{Binding SweepWorkingSetsCommand}" />
                        </StackPanel>

                        <Grid Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Vertical">
                                <TextBlock Text="Target drive (e.g., C:)" Foreground="#9CA3AF" FontSize="12" />
                                <TextBox Text="{Binding TargetPagefileDrive, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Background="#0E1C30" Foreground="#E5E7EB" BorderBrush="#1F2E46" Margin="0,6,0,0" />
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <StackPanel Width="140">
                                        <TextBlock Text="Initial MB" Foreground="#9CA3AF" FontSize="12" />
                                        <TextBox Text="{Binding PagefileInitialMb, Mode=TwoWay}" Background="#0E1C30" Foreground="#E5E7EB" BorderBrush="#1F2E46" Margin="0,6,0,0" />
                                    </StackPanel>
                                    <StackPanel Width="140" Margin="8,0,0,0">
                                        <TextBlock Text="Max MB" Foreground="#9CA3AF" FontSize="12" />
                                        <TextBox Text="{Binding PagefileMaxMb, Mode=TwoWay}" Background="#0E1C30" Foreground="#E5E7EB" BorderBrush="#1F2E46" Margin="0,6,0,0" />
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Vertical">
                                <CheckBox Content="Run working-set sweep after apply"
                                          IsChecked="{Binding RunWorkingSetSweep, Mode=TwoWay}"
                                          Foreground="#E5E7EB"
                                          Margin="0,8,0,4" />
                                <CheckBox Content="Include pinned/always-on apps in sweep"
                                          IsChecked="{Binding SweepPinnedApps, Mode=TwoWay}"
                                          Foreground="#E5E7EB"
                                          Margin="0,0,0,6" />
                                <TextBlock Text="System-managed is safest for most devices; fixed sizes work best on fast NVMe drives." Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" Margin="0,6,0,0" />
                            </StackPanel>
                        </Grid>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Presets:" Foreground="#A5F3FC" FontSize="12" />
                                <TextBlock Text="System managed: Windows sizes automatically." Foreground="#9CA3AF" FontSize="12" />
                                <TextBlock Text="NVMe performance: fixed file on fast drive with 4–16 GB window." Foreground="#9CA3AF" FontSize="12" />
                                <TextBlock Text="Custom fixed: uses the fields above." Foreground="#9CA3AF" FontSize="12" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource PagefileStatusChipStyle}">
                                <TextBlock Text="{Binding PagefileStatusSimple}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 8" Foreground="#F59E0B" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Scheduler &amp; affinity toolbox" Style="{StaticResource SectionHeaderTextStyle}" />
                            <Button Content="Info"
                                    Style="{StaticResource OutlineButtonStyle}"
                                    Padding="10,4"
                                    Margin="8,0,0,0"
                                    Command="{Binding ShowStepInfoCommand}"
                                    CommandParameter="Scheduler" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Apply CPU priority/affinity presets to selected processes and capture masks for inspection." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <ComboBox Width="220"
                                      Margin="0,0,8,0"
                                      ItemsSource="{Binding SchedulerPresets}"
                                      SelectedItem="{Binding SelectedSchedulerPreset, Mode=TwoWay}"
                                      TextSearch.TextPath="Name"
                                      IsEditable="False">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <TextBox Width="220" Margin="0,0,8,0" Background="#0E1C30" Foreground="#E5E7EB" BorderBrush="#1F2E46" Text="{Binding SchedulerProcessNames, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" ToolTip="Process names separated by semicolon (e.g., dwm;explorer)" />
                            <Button Content="Detect scheduler" Style="{StaticResource OutlineButtonStyle}" Command="{Binding DetectSchedulerCommand}" Margin="0,0,8,0" />
                            <Button Content="Apply preset" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding ApplySchedulerPresetCommand}" Margin="0,0,8,0" />
                            <Button Content="Restore defaults" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestoreSchedulerDefaultsCommand}" />
                        </StackPanel>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Latency boost uses High priority with all cores. Efficiency keeps workloads on the first half of cores at lower priority. Provide process names to target running apps only." Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="Defaults are untouched unless a process is matched; restore resets masks to full cores and Normal priority." Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource SchedulerStatusChipStyle}">
                                <TextBlock Text="{Binding SchedulerStatusSimple}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 9" Foreground="#38BDF8" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="DirectStorage readiness &amp; I/O boosts" Style="{StaticResource SectionHeaderTextStyle}" />
                            <Button Content="Info"
                                    Style="{StaticResource OutlineButtonStyle}"
                                    Padding="10,4"
                                    Margin="8,0,0,0"
                                    Command="{Binding ShowStepInfoCommand}"
                                    CommandParameter="DirectStorage" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Check NVMe/GPU readiness for DirectStorage, then optionally lift I/O and thread priorities with a safe rollback." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <CheckBox Content="Boost I/O priority" IsChecked="{Binding BoostIoPriority, Mode=TwoWay}" Foreground="#E5E7EB" />
                            <CheckBox Content="Boost thread priority" IsChecked="{Binding BoostThreadPriority, Mode=TwoWay}" Foreground="#E5E7EB" Margin="12,0,0,0" />
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Detect readiness" Style="{StaticResource OutlineButtonStyle}" Command="{Binding DetectDirectStorageCommand}" Margin="0,0,8,0" />
                            <Button Content="Apply boosts" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding ApplyIoBoostCommand}" Margin="0,0,8,0" />
                            <Button Content="Rollback boosts" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestoreIoDefaultsCommand}" />
                        </StackPanel>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Detection checks for NVMe, GPU, and driver support signals. Boosts raise I/O hints and thread priority for foreground apps; rollback restores defaults." Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="Use detection first to confirm readiness before applying any boosts." Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource DirectStorageStatusChipStyle}">
                                <TextBlock Text="{Binding DirectStorageStatusSimple}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 10" Foreground="#A78BFA" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Monitoring &amp; auto-tune loop" Style="{StaticResource SectionHeaderTextStyle}" />
                            <Button Content="Info"
                                    Style="{StaticResource OutlineButtonStyle}"
                                    Padding="10,4"
                                    Margin="8,0,0,0"
                                    Command="{Binding ShowStepInfoCommand}"
                                    CommandParameter="AutoTune" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Watch for gaming apps, apply a preset automatically, log deltas, and revert in one click." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBox Width="240" Margin="0,0,8,0" Background="#0E1C30" Foreground="#E5E7EB" BorderBrush="#1F2E46" Text="{Binding AutoTuneProcessNames, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" ToolTip="Process names separated by semicolon (e.g., steam;game.exe)" />
                            <ComboBox Width="200"
                                      Margin="0,0,8,0"
                                      ItemsSource="{Binding SchedulerPresets}"
                                      SelectedValuePath="Id"
                                      SelectedValue="{Binding AutoTunePresetId, Mode=TwoWay}"
                                      TextSearch.TextPath="Name">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <Button Content="Detect monitor" Style="{StaticResource OutlineButtonStyle}" Command="{Binding DetectAutoTuneCommand}" Margin="0,0,8,0" />
                            <Button Content="Start monitor" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding StartAutoTuneCommand}" Margin="0,0,8,0" />
                            <Button Content="Stop &amp; revert" Style="{StaticResource OutlineButtonStyle}" Command="{Binding StopAutoTuneCommand}" />
                        </StackPanel>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Sampler watches running processes; when a match is found it applies the chosen scheduler preset and writes the before/after to the Activity Log." Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="Stop &amp; revert ends the watcher and restores defaults captured in the monitor state file." Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource AutoTuneStatusChipStyle}">
                                <TextBlock Text="{Binding AutoTuneStatusSimple}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <Grid Panel.ZIndex="9"
              Background="#B0020617"
              Visibility="{Binding IsInfoDialogVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
              IsHitTestVisible="{Binding IsInfoDialogVisible}">
            <Border MaxWidth="720"
                    Margin="32"
                    Padding="26"
                    Background="#0B1729"
                    BorderBrush="#24344F"
                    BorderThickness="1"
                    CornerRadius="22"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock Text="{Binding InfoDialogTitle}"
                               FontSize="20"
                               FontWeight="SemiBold"
                               Foreground="#F8FAFC"
                               TextWrapping="Wrap" />

                    <ScrollViewer Grid.Row="1"
                                  Margin="0,16,0,0"
                                  MaxHeight="420"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <TextBlock Text="{Binding InfoDialogBody}"
                                   Foreground="#C5D2EA"
                                   FontSize="13"
                                   TextWrapping="Wrap" />
                    </ScrollViewer>

                    <StackPanel Grid.Row="2"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,18,0,0">
                        <Button Content="Close"
                                Command="{Binding CloseInfoDialogCommand}"
                                Style="{StaticResource OutlineButtonStyle}"
                                Padding="14,6"
                                MinWidth="120" />
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>
