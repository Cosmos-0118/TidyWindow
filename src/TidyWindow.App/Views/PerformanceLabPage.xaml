<Page x:Class="TidyWindow.App.Views.PerformanceLabPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:controls="clr-namespace:TidyWindow.App.Views"
      mc:Ignorable="d"
      Title="Performance Lab"
      Background="Transparent"
      UseLayoutRounding="True"
      SnapsToDevicePixels="True"
      TextOptions.TextFormattingMode="Display"
      TextOptions.TextRenderingMode="ClearType"
      TextOptions.TextHintingMode="Fixed"
      RenderOptions.BitmapScalingMode="HighQuality">
    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

        <!-- Color Palette -->
        <SolidColorBrush x:Key="PageBg" Color="#0A0F1A" />
        <SolidColorBrush x:Key="CardBg" Color="#0C1424" />
        <SolidColorBrush x:Key="CardBorder" Color="#1B2538" />
        <SolidColorBrush x:Key="CardBorderHover" Color="#2D3D54" />
        <SolidColorBrush x:Key="TextPrimary" Color="#F1F5F9" />
        <SolidColorBrush x:Key="TextSecondary" Color="#94A3B8" />
        <SolidColorBrush x:Key="TextMuted" Color="#64748B" />
        <SolidColorBrush x:Key="AccentBlue" Color="#38BDF8" />
        <SolidColorBrush x:Key="SuccessGreen" Color="#22C55E" />
        <SolidColorBrush x:Key="WarningAmber" Color="#FBBF24" />

        <!-- Hero Background -->
        <LinearGradientBrush x:Key="HeroBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#0A1F36" Offset="0" />
            <GradientStop Color="#0F2F4A" Offset="0.5" />
            <GradientStop Color="#0B3B4D" Offset="1" />
        </LinearGradientBrush>

        <!-- Step Card -->
        <Style x:Key="StepCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBg}" />
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="Padding" Value="20,14" />
            <Setter Property="Margin" Value="0,0,0,8" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="UseLayoutRounding" Value="True" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource CardBorderHover}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Step Number Badge -->
        <Style x:Key="StepBadge" TargetType="Border">
            <Setter Property="Width" Value="32" />
            <Setter Property="Height" Value="32" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Background" Value="#1E293B" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
        </Style>

        <!-- Chip Style -->
        <Style x:Key="ChipStyle" TargetType="Border">
            <Setter Property="Background" Value="#3B1515" />
            <Setter Property="BorderBrush" Value="#7F1D1D" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Padding" Value="6,2" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
        </Style>

        <!-- Primary Button -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Foreground" Value="#0F172A" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="MinWidth" Value="72" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" CornerRadius="6" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True" UseLayoutRounding="True">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#34D399" Offset="0" />
                                    <GradientStop Color="#22C55E" Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#4ADE80" Offset="0" />
                                            <GradientStop Color="#34D399" Offset="1" />
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.5" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Secondary Button -->
        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Foreground" Value="#E2E8F0" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="MinWidth" Value="72" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="#0E1A2C" BorderBrush="#1F2E46" BorderThickness="1" CornerRadius="6" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="True" UseLayoutRounding="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#38BDF8" />
                                <Setter TargetName="Bd" Property="Background" Value="#132033" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.5" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Info Button -->
        <Style x:Key="InfoButton" TargetType="Button">
            <Setter Property="Foreground" Value="#64748B" />
            <Setter Property="FontSize" Value="10" />
            <Setter Property="Width" Value="18" />
            <Setter Property="Height" Value="18" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="#1E293B" BorderBrush="#334155" BorderThickness="1" CornerRadius="4" Width="18" Height="18" SnapsToDevicePixels="True">
                            <TextBlock Text="i" FontSize="10" FontWeight="Bold" FontStyle="Italic" Foreground="{TemplateBinding Foreground}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-1,0,0" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#334155" />
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#475569" />
                                <Setter Property="Foreground" Value="#E2E8F0" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Status Dot -->
        <Style x:Key="StatusDot" TargetType="Ellipse">
            <Setter Property="Width" Value="6" />
            <Setter Property="Height" Value="6" />
            <Setter Property="Fill" Value="#64748B" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
        </Style>

        <!-- Title Text Style -->
        <Style x:Key="StepTitleStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#F1F5F9" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="TextOptions.TextFormattingMode" Value="Display" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>

        <!-- Description Text Style -->
        <Style x:Key="StepDescStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#94A3B8" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="TextOptions.TextFormattingMode" Value="Display" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.Style>
            <Style TargetType="Grid">
                <Setter Property="Opacity" Value="1" />
                <Setter Property="IsHitTestVisible" Value="True" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsBusy}" Value="True">
                        <Setter Property="Opacity" Value="0.5" />
                        <Setter Property="IsHitTestVisible" Value="False" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Grid.Style>

        <Grid Margin="24" HorizontalAlignment="Stretch">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Hero Header -->
            <Border Grid.Row="0" Background="{StaticResource HeroBrush}" Padding="20,16" CornerRadius="12" BorderThickness="1" BorderBrush="#12314A" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <TextBlock Text="âš¡" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0" />
                            <TextBlock Text="Performance Lab" FontSize="18" FontWeight="SemiBold" Foreground="#F5F7FF" TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType" />
                        </StackPanel>
                        <TextBlock Text="8-step performance tuning stack with restore-point gating and anti-cheat safe tweaks." Foreground="#A5B4C8" FontSize="12" TextWrapping="Wrap" TextOptions.TextFormattingMode="Display" />
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                            <CheckBox Content="Arm tweaks" IsChecked="{Binding IsApplyArmed, Mode=TwoWay}" Foreground="#E2E8F0" VerticalAlignment="Center" Margin="0,0,16,0" />
                            <CheckBox Content="Boot automation" IsChecked="{Binding IsBootAutomationEnabled, Mode=TwoWay}" Foreground="#E2E8F0" VerticalAlignment="Center" />
                        </StackPanel>
                        <Button Content="Configure boot" Style="{StaticResource SecondaryButton}" Command="{Binding OpenBootConfigCommand}" Margin="0,0,8,0" />
                        <Button Content="Refresh" Style="{StaticResource SecondaryButton}" Command="{Binding RefreshCommand}" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Status Bar -->
            <Border Grid.Row="1" Background="#0E1A2C" BorderBrush="#1B2538" BorderThickness="1" CornerRadius="8" Padding="12,8" Margin="0,10,0,0" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <TextBlock Text="{Binding ApplyGuardStatus}" Foreground="#94A3B8" FontSize="11" VerticalAlignment="Center" TextOptions.TextFormattingMode="Display" />
            </Border>

            <!-- Steps List -->
            <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="0,10,0,0" Padding="0,0,6,0">
                <StackPanel UseLayoutRounding="True" SnapsToDevicePixels="True">

                    <!-- Step 1: Power Plan -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <TextBlock Text="1" Foreground="#38BDF8" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="14,0,20,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Power Plan" Style="{StaticResource StepTitleStyle}" />
                                    <Ellipse Margin="8,0,0,0">
                                        <Ellipse.Style>
                                            <Style TargetType="Ellipse" BasedOn="{StaticResource StatusDot}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsPowerPlanSuccess}" Value="True">
                                                        <Setter Property="Fill" Value="#22C55E" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsPowerPlanSuccess}" Value="False">
                                                        <Setter Property="Fill" Value="#FBBF24" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Ellipse.Style>
                                    </Ellipse>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="PowerPlan" Margin="6,0,0,0" ToolTip="Learn more" />
                                </StackPanel>
                                <TextBlock Text="{Binding PowerPlanHeadline}" Style="{StaticResource StepDescStyle}" Margin="0,3,0,0" TextTrimming="CharacterEllipsis" />
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Ultimate" Style="{StaticResource PrimaryButton}" Command="{Binding EnableUltimatePlanCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,6,0" />
                                <Button Content="Restore" Style="{StaticResource SecondaryButton}" Command="{Binding RestorePowerPlanCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 2: Services -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <TextBlock Text="2" Foreground="#A78BFA" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="14,0,20,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Service Templates" Style="{StaticResource StepTitleStyle}" />
                                    <Ellipse Margin="8,0,0,0">
                                        <Ellipse.Style>
                                            <Style TargetType="Ellipse" BasedOn="{StaticResource StatusDot}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsServiceSuccess}" Value="True">
                                                        <Setter Property="Fill" Value="#22C55E" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsServiceSuccess}" Value="False">
                                                        <Setter Property="Fill" Value="#FBBF24" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Ellipse.Style>
                                    </Ellipse>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Services" Margin="6,0,0,0" ToolTip="Learn more" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBlock Text="Disable telemetry, Xbox, and consumer services" Style="{StaticResource StepDescStyle}" Margin="0,0,10,0" />
                                    <ComboBox Width="140" ItemsSource="{Binding Templates}" SelectedItem="{Binding SelectedTemplate, Mode=TwoWay}" Background="#1E293B" Foreground="#E2E8F0" BorderBrush="#334155" Padding="8,4" FontSize="11">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Apply" Style="{StaticResource PrimaryButton}" Command="{Binding ApplyServiceTemplateCommand}" CommandParameter="{Binding SelectedTemplate}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,6,0" />
                                <Button Content="Restore" Style="{StaticResource SecondaryButton}" Command="{Binding RestoreServicesCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 3: Hardware Reserved -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <TextBlock Text="3" Foreground="#F97316" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="14,0,20,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Hardware Reserved" Style="{StaticResource StepTitleStyle}" />
                                    <Ellipse Margin="8,0,0,0">
                                        <Ellipse.Style>
                                            <Style TargetType="Ellipse" BasedOn="{StaticResource StatusDot}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsHardwareSuccess}" Value="True">
                                                        <Setter Property="Fill" Value="#22C55E" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsHardwareSuccess}" Value="False">
                                                        <Setter Property="Fill" Value="#FBBF24" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Ellipse.Style>
                                    </Ellipse>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Hardware" Margin="6,0,0,0" ToolTip="Learn more" />
                                </StackPanel>
                                <TextBlock Text="Clear memory caps and manage compression" Style="{StaticResource StepDescStyle}" Margin="0,3,0,0" />
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Detect" Style="{StaticResource SecondaryButton}" Command="{Binding DetectHardwareReservedCommand}" Margin="0,0,6,0" />
                                <Button Content="Fix" Style="{StaticResource PrimaryButton}" Command="{Binding ApplyHardwareFixCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,6,0" />
                                <Button Content="Restore" Style="{StaticResource SecondaryButton}" Command="{Binding RestoreCompressionCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 4: Kernel & Boot -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <TextBlock Text="4" Foreground="#22D3EE" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="14,0,20,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Kernel &amp; Boot" Style="{StaticResource StepTitleStyle}" />
                                    <Border Style="{StaticResource ChipStyle}" Margin="8,0,0,0">
                                        <TextBlock Text="Anti-cheat" Foreground="#FECACA" FontSize="9" />
                                    </Border>
                                    <Ellipse Margin="8,0,0,0">
                                        <Ellipse.Style>
                                            <Style TargetType="Ellipse" BasedOn="{StaticResource StatusDot}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsKernelSuccess}" Value="True">
                                                        <Setter Property="Fill" Value="#22C55E" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsKernelSuccess}" Value="False">
                                                        <Setter Property="Fill" Value="#FBBF24" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Ellipse.Style>
                                    </Ellipse>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Kernel" Margin="6,0,0,0" ToolTip="Learn more" />
                                </StackPanel>
                                <TextBlock Text="Timer and boot tweaks with restore-point gating" Style="{StaticResource StepDescStyle}" Margin="0,3,0,0" />
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Apply" Style="{StaticResource PrimaryButton}" Command="{Binding ApplyKernelPresetCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,6,0" />
                                <Button Content="Restore" Style="{StaticResource SecondaryButton}" Command="{Binding RestoreKernelDefaultsCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 5: VBS/HVCI -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <TextBlock Text="5" Foreground="#2DD4BF" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="14,0,20,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Core Isolation (VBS)" Style="{StaticResource StepTitleStyle}" />
                                    <Border Style="{StaticResource ChipStyle}" Margin="8,0,0,0">
                                        <TextBlock Text="Anti-cheat" Foreground="#FECACA" FontSize="9" />
                                    </Border>
                                    <Ellipse Margin="8,0,0,0">
                                        <Ellipse.Style>
                                            <Style TargetType="Ellipse" BasedOn="{StaticResource StatusDot}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsVbsSuccess}" Value="True">
                                                        <Setter Property="Fill" Value="#22C55E" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsVbsSuccess}" Value="False">
                                                        <Setter Property="Fill" Value="#FBBF24" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Ellipse.Style>
                                    </Ellipse>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Vbs" Margin="6,0,0,0" ToolTip="Learn more" />
                                </StackPanel>
                                <TextBlock Text="Toggle VBS/HVCI for benchmarking or security" Style="{StaticResource StepDescStyle}" Margin="0,3,0,0" />
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Detect" Style="{StaticResource SecondaryButton}" Command="{Binding DetectVbsHvciCommand}" Margin="0,0,6,0" />
                                <Button Content="Disable" Style="{StaticResource PrimaryButton}" Command="{Binding DisableVbsHvciCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,6,0" />
                                <Button Content="Restore" Style="{StaticResource SecondaryButton}" Command="{Binding RestoreVbsHvciCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 6: ETW -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <TextBlock Text="6" Foreground="#60A5FA" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="14,0,20,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ETW Tracing" Style="{StaticResource StepTitleStyle}" />
                                    <Border Style="{StaticResource ChipStyle}" Margin="8,0,0,0">
                                        <TextBlock Text="Anti-cheat" Foreground="#FECACA" FontSize="9" />
                                    </Border>
                                    <Ellipse Margin="8,0,0,0">
                                        <Ellipse.Style>
                                            <Style TargetType="Ellipse" BasedOn="{StaticResource StatusDot}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsEtwSuccess}" Value="True">
                                                        <Setter Property="Fill" Value="#22C55E" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsEtwSuccess}" Value="False">
                                                        <Setter Property="Fill" Value="#FBBF24" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Ellipse.Style>
                                    </Ellipse>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Etw" Margin="6,0,0,0" ToolTip="Learn more" />
                                </StackPanel>
                                <TextBlock Text="Stop noisy traces and restore from baseline" Style="{StaticResource StepDescStyle}" Margin="0,3,0,0" />
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Detect" Style="{StaticResource SecondaryButton}" Command="{Binding DetectEtwSessionsCommand}" Margin="0,0,6,0" />
                                <Button Content="Minimal" Style="{StaticResource PrimaryButton}" Command="{Binding CleanupEtwMinimalCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,6,0" />
                                <Button Content="Aggressive" Style="{StaticResource SecondaryButton}" Command="{Binding CleanupEtwAggressiveCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,6,0" />
                                <Button Content="Restore" Style="{StaticResource SecondaryButton}" Command="{Binding RestoreEtwDefaultsCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 7: Scheduler -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <TextBlock Text="7" Foreground="#F59E0B" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="14,0,20,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Scheduler &amp; Affinity" Style="{StaticResource StepTitleStyle}" />
                                    <Border Style="{StaticResource ChipStyle}" Margin="8,0,0,0">
                                        <TextBlock Text="Anti-cheat" Foreground="#FECACA" FontSize="9" />
                                    </Border>
                                    <Ellipse Margin="8,0,0,0">
                                        <Ellipse.Style>
                                            <Style TargetType="Ellipse" BasedOn="{StaticResource StatusDot}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsSchedulerSuccess}" Value="True">
                                                        <Setter Property="Fill" Value="#22C55E" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsSchedulerSuccess}" Value="False">
                                                        <Setter Property="Fill" Value="#FBBF24" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Ellipse.Style>
                                    </Ellipse>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="Scheduler" Margin="6,0,0,0" ToolTip="Learn more" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBlock Text="{Binding SchedulerProcessNames, StringFormat='Targets: {0}', FallbackValue='No processes configured'}" Style="{StaticResource StepDescStyle}" Margin="0,0,10,0" TextTrimming="CharacterEllipsis" MaxWidth="180" />
                                    <Button Content="Manage" Style="{StaticResource SecondaryButton}" Command="{Binding OpenSchedulerPickerCommand}" Padding="10,5" FontSize="11" MinWidth="56" Margin="0,0,6,0" />
                                    <ComboBox Width="120" ItemsSource="{Binding SchedulerPresets}" SelectedItem="{Binding SelectedSchedulerPreset, Mode=TwoWay}" Background="#1E293B" Foreground="#E2E8F0" BorderBrush="#334155" Padding="8,4" FontSize="11">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Detect" Style="{StaticResource SecondaryButton}" Command="{Binding DetectSchedulerCommand}" Margin="0,0,6,0" />
                                <Button Content="Apply" Style="{StaticResource PrimaryButton}" Command="{Binding ApplySchedulerPresetCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,6,0" />
                                <Button Content="Restore" Style="{StaticResource SecondaryButton}" Command="{Binding RestoreSchedulerDefaultsCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Step 8: Auto-tune -->
                    <Border Style="{StaticResource StepCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource StepBadge}" VerticalAlignment="Center">
                                <TextBlock Text="8" Foreground="#A78BFA" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>

                            <StackPanel Grid.Column="1" Margin="14,0,20,0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Auto-tune Monitor" Style="{StaticResource StepTitleStyle}" />
                                    <Ellipse Margin="8,0,0,0">
                                        <Ellipse.Style>
                                            <Style TargetType="Ellipse" BasedOn="{StaticResource StatusDot}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsAutoTuneSuccess}" Value="True">
                                                        <Setter Property="Fill" Value="#22C55E" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsAutoTuneSuccess}" Value="False">
                                                        <Setter Property="Fill" Value="#FBBF24" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Ellipse.Style>
                                    </Ellipse>
                                    <Button Style="{StaticResource InfoButton}" Command="{Binding ShowStepInfoCommand}" CommandParameter="AutoTune" Margin="6,0,0,0" ToolTip="Learn more" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBlock Text="Watch for apps and apply presets automatically" Style="{StaticResource StepDescStyle}" Margin="0,0,10,0" />
                                    <Button Content="Manage" Style="{StaticResource SecondaryButton}" Command="{Binding OpenAutoTunePickerCommand}" Padding="10,5" FontSize="11" MinWidth="56" Margin="0,0,6,0" />
                                    <ComboBox Width="120" ItemsSource="{Binding SchedulerPresets}" SelectedValuePath="Id" SelectedValue="{Binding AutoTunePresetId, Mode=TwoWay}" Background="#1E293B" Foreground="#E2E8F0" BorderBrush="#334155" Padding="8,4" FontSize="11">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Content="Detect" Style="{StaticResource SecondaryButton}" Command="{Binding DetectAutoTuneCommand}" Margin="0,0,6,0" />
                                <Button Content="Start" Style="{StaticResource PrimaryButton}" Command="{Binding StartAutoTuneCommand}" IsEnabled="{Binding IsApplyArmed}" Margin="0,0,6,0" />
                                <Button Content="Stop" Style="{StaticResource SecondaryButton}" Command="{Binding StopAutoTuneCommand}" IsEnabled="{Binding IsApplyArmed}" />
                            </StackPanel>
                        </Grid>
                    </Border>

                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Boot Config Dialog -->
        <Grid Panel.ZIndex="12" Background="#B0020617" Visibility="{Binding IsBootConfigDialogVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border MaxWidth="420" Padding="20,18" Background="#0F172A" BorderBrush="#334155" BorderThickness="1" CornerRadius="12" HorizontalAlignment="Center" VerticalAlignment="Center" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,14">
                        <Border Background="#1E293B" CornerRadius="8" Width="36" Height="36" SnapsToDevicePixels="True">
                            <TextBlock Text="ðŸš€" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="Boot Automation" FontSize="14" FontWeight="SemiBold" Foreground="#F1F5F9" TextOptions.TextFormattingMode="Display" />
                            <TextBlock Text="Select which steps run automatically at boot." Foreground="#94A3B8" FontSize="11" Margin="0,2,0,0" TextOptions.TextFormattingMode="Display" />
                        </StackPanel>
                    </StackPanel>

                    <Border Background="#1E293B" BorderBrush="#334155" BorderThickness="1" CornerRadius="8" Padding="14,12" Margin="0,0,0,14">
                        <StackPanel>
                            <CheckBox Content="Power Plan (Ultimate Performance)" IsChecked="{Binding AutoApplyPowerPlan, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="12" Margin="0,0,0,8" />
                            <CheckBox Content="Service Templates" IsChecked="{Binding AutoApplyServices, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="12" Margin="0,0,0,8" />
                            <CheckBox Content="Hardware Reserved Fix" IsChecked="{Binding AutoApplyHardware, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="12" Margin="0,0,0,8" />
                            <CheckBox Content="Kernel &amp; Boot Tweaks" IsChecked="{Binding AutoApplyKernel, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="12" Margin="0,0,0,8" />
                            <CheckBox Content="Core Isolation (VBS/HVCI)" IsChecked="{Binding AutoApplyVbs, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="12" Margin="0,0,0,8" />
                            <CheckBox Content="ETW Tracing Cleanup" IsChecked="{Binding AutoApplyEtw, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="12" Margin="0,0,0,8" />
                            <CheckBox Content="Scheduler &amp; Affinity" IsChecked="{Binding AutoApplyScheduler, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="12" Margin="0,0,0,8" />
                            <CheckBox Content="Auto-tune Monitor" IsChecked="{Binding AutoApplyAutoTune, Mode=TwoWay}" Foreground="#E2E8F0" FontSize="12" />
                        </StackPanel>
                    </Border>

                    <TextBlock Text="{Binding BootAutomationStatus}" Foreground="#64748B" FontSize="11" Margin="0,0,0,12" TextWrapping="Wrap" TextOptions.TextFormattingMode="Display" />

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="1" Content="Apply" Style="{StaticResource PrimaryButton}" Command="{Binding ApplyBootAutomationCommand}" MinWidth="72" Margin="0,0,6,0" />
                        <Button Grid.Column="2" Content="Close" Style="{StaticResource SecondaryButton}" Command="{Binding CloseBootConfigDialogCommand}" MinWidth="72" />
                    </Grid>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Scheduler Picker Dialog -->
        <Grid Panel.ZIndex="11" Background="#B0020617" Visibility="{Binding IsSchedulerPickerVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border MaxWidth="480" Padding="20,18" Background="#0F172A" BorderBrush="#334155" BorderThickness="1" CornerRadius="12" HorizontalAlignment="Center" VerticalAlignment="Center" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,14">
                        <Border Background="#1E293B" CornerRadius="8" Width="36" Height="36" SnapsToDevicePixels="True">
                            <TextBlock Text="âš™" FontSize="14" Foreground="#F59E0B" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="Scheduler Processes" FontSize="14" FontWeight="SemiBold" Foreground="#F1F5F9" TextOptions.TextFormattingMode="Display" />
                            <TextBlock Text="Processes to receive the scheduler preset." Foreground="#94A3B8" FontSize="11" Margin="0,2,0,0" TextOptions.TextFormattingMode="Display" />
                        </StackPanel>
                    </StackPanel>

                    <Border Background="#1E293B" BorderBrush="#334155" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,0,14">
                        <StackPanel>
                            <ScrollViewer MaxHeight="180" VerticalScrollBarVisibility="Auto">
                                <ListBox ItemsSource="{Binding SchedulerProcesses}" SelectedItem="{Binding SelectedSchedulerProcess, Mode=TwoWay}" Background="Transparent" BorderThickness="0" Foreground="#E2E8F0">
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Padding" Value="10,6" />
                                            <Setter Property="Margin" Value="0,2" />
                                            <Setter Property="Background" Value="#0F172A" />
                                            <Setter Property="BorderBrush" Value="#334155" />
                                            <Setter Property="BorderThickness" Value="1" />
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="BorderBrush" Value="#38BDF8" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                </ListBox>
                            </ScrollViewer>
                            <TextBlock Text="No processes yet" Foreground="#64748B" FontSize="11" HorizontalAlignment="Center" Margin="0,10,0,10">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SchedulerProcesses.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                <TextBox Width="200" Margin="0,0,8,0" Background="#0F172A" Foreground="#E2E8F0" BorderBrush="#334155" Padding="10,6" Text="{Binding NewSchedulerProcessName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                <Button Content="Add" Style="{StaticResource PrimaryButton}" Command="{Binding AddSchedulerProcessCommand}" Padding="12,6" Margin="0,0,6,0" />
                                <Button Content="Remove" Style="{StaticResource SecondaryButton}" Command="{Binding RemoveSchedulerProcessCommand}" Padding="12,6" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Button Content="Close" Style="{StaticResource SecondaryButton}" Command="{Binding CloseSchedulerPickerCommand}" HorizontalAlignment="Right" MinWidth="80" />
                </StackPanel>
            </Border>
        </Grid>

        <!-- Auto-tune Picker Dialog -->
        <Grid Panel.ZIndex="10" Background="#B0020617" Visibility="{Binding IsAutoTunePickerVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border MaxWidth="480" Padding="20,18" Background="#0F172A" BorderBrush="#334155" BorderThickness="1" CornerRadius="12" HorizontalAlignment="Center" VerticalAlignment="Center" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,14">
                        <Border Background="#1E293B" CornerRadius="8" Width="36" Height="36" SnapsToDevicePixels="True">
                            <TextBlock Text="ðŸŽ¯" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="Auto-tune Processes" FontSize="14" FontWeight="SemiBold" Foreground="#F1F5F9" TextOptions.TextFormattingMode="Display" />
                            <TextBlock Text="Processes that trigger auto-tune on launch." Foreground="#94A3B8" FontSize="11" Margin="0,2,0,0" TextOptions.TextFormattingMode="Display" />
                        </StackPanel>
                    </StackPanel>

                    <Border Background="#1E293B" BorderBrush="#334155" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,0,0,14">
                        <StackPanel>
                            <ScrollViewer MaxHeight="180" VerticalScrollBarVisibility="Auto">
                                <ListBox ItemsSource="{Binding AutoTuneProcesses}" SelectedItem="{Binding SelectedAutoTuneProcess, Mode=TwoWay}" Background="Transparent" BorderThickness="0" Foreground="#E2E8F0">
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Padding" Value="10,6" />
                                            <Setter Property="Margin" Value="0,2" />
                                            <Setter Property="Background" Value="#0F172A" />
                                            <Setter Property="BorderBrush" Value="#334155" />
                                            <Setter Property="BorderThickness" Value="1" />
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="BorderBrush" Value="#38BDF8" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                </ListBox>
                            </ScrollViewer>
                            <TextBlock Text="No processes yet" Foreground="#64748B" FontSize="11" HorizontalAlignment="Center" Margin="0,10,0,10">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding AutoTuneProcesses.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                <TextBox Width="200" Margin="0,0,8,0" Background="#0F172A" Foreground="#E2E8F0" BorderBrush="#334155" Padding="10,6" Text="{Binding NewAutoTuneProcessName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                <Button Content="Add" Style="{StaticResource PrimaryButton}" Command="{Binding AddAutoTuneProcessCommand}" Padding="12,6" Margin="0,0,6,0" />
                                <Button Content="Remove" Style="{StaticResource SecondaryButton}" Command="{Binding RemoveAutoTuneProcessCommand}" Padding="12,6" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <Button Content="Close" Style="{StaticResource SecondaryButton}" Command="{Binding CloseAutoTunePickerCommand}" HorizontalAlignment="Right" MinWidth="80" />
                </StackPanel>
            </Border>
        </Grid>

        <!-- Info Dialog -->
        <Grid Panel.ZIndex="9" Background="#B0020617" Visibility="{Binding IsInfoDialogVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border MaxWidth="480" Padding="20,18" Background="#0F172A" BorderBrush="#334155" BorderThickness="1" CornerRadius="12" HorizontalAlignment="Center" VerticalAlignment="Center" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <StackPanel>
                    <TextBlock Text="{Binding InfoDialogTitle}" FontSize="14" FontWeight="SemiBold" Foreground="#F1F5F9" Margin="0,0,0,12" TextOptions.TextFormattingMode="Display" />
                    <ScrollViewer MaxHeight="260" VerticalScrollBarVisibility="Auto">
                        <TextBlock Text="{Binding InfoDialogBody}" Foreground="#94A3B8" FontSize="12" TextWrapping="Wrap" LineHeight="18" TextOptions.TextFormattingMode="Display" />
                    </ScrollViewer>
                    <Button Content="Close" Style="{StaticResource SecondaryButton}" Command="{Binding CloseInfoDialogCommand}" HorizontalAlignment="Right" MinWidth="72" Margin="0,14,0,0" />
                </StackPanel>
            </Border>
        </Grid>

        <!-- Busy Overlay -->
        <Grid Panel.ZIndex="8" Background="#B30B1629" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Background="#0F172A" Padding="20,16" CornerRadius="10" BorderBrush="#334155" BorderThickness="1" HorizontalAlignment="Center" VerticalAlignment="Center" SnapsToDevicePixels="True" UseLayoutRounding="True">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Applying..." Foreground="#F1F5F9" FontWeight="SemiBold" FontSize="12" Margin="0,0,0,10" TextOptions.TextFormattingMode="Display" />
                    <ProgressBar IsIndeterminate="True" Height="4" Width="140" />
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>
