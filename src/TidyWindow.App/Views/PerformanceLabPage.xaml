<Page x:Class="TidyWindow.App.Views.PerformanceLabPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d"
      Title="Performance Lab"
      Background="Transparent"
      UseLayoutRounding="True"
      SnapsToDevicePixels="True"
      TextOptions.TextFormattingMode="Display"
      TextOptions.TextRenderingMode="ClearType"
      TextOptions.TextHintingMode="Fixed"
      RenderOptions.BitmapScalingMode="HighQuality">
    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

        <LinearGradientBrush x:Key="PerfHeroBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#0A1F36" Offset="0" />
            <GradientStop Color="#0D2740" Offset="0.45" />
            <GradientStop Color="#0B334A" Offset="1" />
        </LinearGradientBrush>

        <SolidColorBrush x:Key="PerfHeroTitleBrush" Color="#F5F7FF" />
        <SolidColorBrush x:Key="PerfHeroBodyBrush" Color="#C6D4EE" />
        <SolidColorBrush x:Key="PerfCardBrush" Color="#0C1424" />
        <SolidColorBrush x:Key="PerfCardBorderBrush" Color="#1B2538" />
        <SolidColorBrush x:Key="PerfCardOverlayBrush" Color="#0F1B30" />
        <SolidColorBrush x:Key="PerfChipSuccessBrush" Color="#0F2F25" />
        <SolidColorBrush x:Key="PerfChipWarningBrush" Color="#2C1A1A" />
        <SolidColorBrush x:Key="PerfChipBorderSuccess" Color="#22C55E" />
        <SolidColorBrush x:Key="PerfChipBorderWarning" Color="#F87171" />
        <SolidColorBrush x:Key="PerfAccentBrush" Color="#38BDF8" />
        <SolidColorBrush x:Key="PerfAccentDeepBrush" Color="#0EA5E9" />
        <SolidColorBrush x:Key="PerfMutedBrush" Color="#8CA3C5" />

        <Style x:Key="HeroTitleTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{StaticResource PerfHeroTitleBrush}" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>

        <Style x:Key="HeroBodyTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="{StaticResource PerfHeroBodyBrush}" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>

        <Style x:Key="ChipStyle" TargetType="Border">
            <Setter Property="Background" Value="#0E1D33" />
            <Setter Property="BorderBrush" Value="#1D3B58" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="Margin" Value="0,0,10,0" />
        </Style>

        <Style x:Key="StatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPowerPlanSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsPowerPlanSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ServiceStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsServiceSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsServiceSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="HardwareStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsHardwareSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsHardwareSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="KernelStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsKernelSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsKernelSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="#07111D" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root" CornerRadius="12" Padding="{TemplateBinding Padding}">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#34D399" Offset="0" />
                                    <GradientStop Color="#22C55E" Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.01" ScaleY="1.01" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="OutlineButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="#E2E8F0" />
            <Setter Property="Background" Value="#0E1A2C" />
            <Setter Property="BorderBrush" Value="#1F2E46" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="BorderBrush" Value="#38BDF8" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource PerfCardBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource PerfCardBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,0,12" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="UseLayoutRounding" Value="True" />
        </Style>

        <Style x:Key="SectionHeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="#E5E7EB" />
        </Style>

        <Style x:Key="SubtleCaptionTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Foreground" Value="{StaticResource PerfMutedBrush}" />
            <Setter Property="TextWrapping" Value="Wrap" />
        </Style>

        <Style x:Key="StepBadgeStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="Padding" Value="10,6" />
            <Setter Property="Background" Value="#111B2D" />
            <Setter Property="BorderBrush" Value="#1F2E46" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Margin" Value="0,0,10,0" />
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.Style>
            <Style TargetType="Grid">
                <Setter Property="Opacity" Value="1" />
                <Setter Property="IsHitTestVisible" Value="True" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsBusy}" Value="True">
                        <Setter Property="Opacity" Value="0.5" />
                        <Setter Property="IsHitTestVisible" Value="False" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Grid.Style>

        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="24">
                <Border Background="{StaticResource PerfHeroBrush}" Padding="22" CornerRadius="18" BorderThickness="1" BorderBrush="#12314A">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel>
                            <TextBlock Text="Performance Lab" Style="{StaticResource HeroTitleTextStyle}" FontSize="22" />
                            <TextBlock Margin="0,6,0,0" Text="Guided, high-impact performance tweaks with built-in backups and safe rollbacks." Style="{StaticResource HeroBodyTextStyle}" />

                            <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                <Border Style="{StaticResource ChipStyle}" Background="#0E243D" BorderBrush="#1F3652">
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Text="Plan" Foreground="#A5F3FC" FontWeight="SemiBold" />
                                        <TextBlock Margin="6,0,0,0" Text="status" Foreground="#A5F3FC" />
                                        <TextBlock Margin="10,0,0,0" Text="â€¢" Foreground="#334155" />
                                        <TextBlock Margin="6,0,0,0" Text="{Binding PowerPlanHeadline}" Foreground="{StaticResource PerfHeroTitleBrush}" />
                                    </StackPanel>
                                </Border>
                                <Border Style="{StaticResource ChipStyle}" Background="#221A0F" BorderBrush="#3A2A1A">
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Text="Service backup" Foreground="#FACC15" FontWeight="SemiBold" />
                                        <TextBlock Margin="8,0,0,0" Text="{Binding ServicesDetails}" Foreground="{StaticResource PerfHeroTitleBrush}" />
                                    </StackPanel>
                                </Border>
                                <Border Style="{StaticResource ChipStyle}" Background="#0F2A1D" BorderBrush="#1F3A2C">
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Text="Guarded tweaks" Foreground="#6EE7B7" FontWeight="SemiBold" />
                                        <TextBlock Margin="8,0,0,0" Text="Built-in rollbacks" Foreground="{StaticResource PerfHeroTitleBrush}" />
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" Margin="0,0,10,0">
                                    <ProgressBar Width="90" Height="8" IsIndeterminate="True" Foreground="{StaticResource PerfAccentBrush}" Background="#0E1C30" BorderBrush="#1F2E46" />
                                    <TextBlock Text="Working..." Margin="8,0,0,0" Foreground="#E5E7EB" FontSize="12" VerticalAlignment="Center" />
                                </StackPanel>
                                <Button Content="Refresh" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RefreshCommand}" Margin="0,0,10,0" />
                                <Border Padding="10,8" CornerRadius="12" Background="#102033" BorderBrush="#1F2E46" BorderThickness="1">
                                    <TextBlock Text="Guarded tweaks only" Foreground="#C6D4EE" FontSize="12" />
                                </Border>
                            </StackPanel>
                            <TextBlock Margin="0,8,0,0" Text="Follow the steps below. Each feature is isolated, backed up, and reversible." Style="{StaticResource HeroBodyTextStyle}" />
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Style="{StaticResource CardStyle}" Background="{StaticResource PerfCardOverlayBrush}" BorderBrush="#1D2A3D" Padding="16" CornerRadius="14" Margin="0,16,0,16">
                    <StackPanel>
                        <TextBlock Text="Feature walk-through" Style="{StaticResource SectionHeaderTextStyle}" />
                        <TextBlock Margin="0,4,0,10" Text="Step through the guarded features in order to keep changes contained." Style="{StaticResource SubtleCaptionTextStyle}" />
                        <UniformGrid Columns="3" Rows="1" Margin="0,4,0,0">
                            <Border Style="{StaticResource ChipStyle}" Background="#0F1C2F" BorderBrush="#1F2E46" Padding="14">
                                <StackPanel>
                                    <TextBlock Text="01" Foreground="{StaticResource PerfAccentBrush}" FontWeight="Bold" />
                                    <TextBlock Text="Power plan" Foreground="#E5E7EB" FontWeight="SemiBold" />
                                    <TextBlock Text="Enable Ultimate Performance with an auto-backup." Style="{StaticResource SubtleCaptionTextStyle}" />
                                </StackPanel>
                            </Border>
                            <Border Style="{StaticResource ChipStyle}" Background="#0F1C2F" BorderBrush="#1F2E46" Padding="14">
                                <StackPanel>
                                    <TextBlock Text="02" Foreground="#A5B4FC" FontWeight="Bold" />
                                    <TextBlock Text="Service templates" Foreground="#E5E7EB" FontWeight="SemiBold" />
                                    <TextBlock Text="Disable noisy services; restore with snapshots." Style="{StaticResource SubtleCaptionTextStyle}" />
                                </StackPanel>
                            </Border>
                            <Border Style="{StaticResource ChipStyle}" Background="#0F1C2F" BorderBrush="#1F2E46" Padding="14">
                                <StackPanel>
                                    <TextBlock Text="03" Foreground="#F472B6" FontWeight="Bold" />
                                    <TextBlock Text="Rollback ready" Foreground="#E5E7EB" FontWeight="SemiBold" />
                                    <TextBlock Text="Every change writes a backup you can roll back to." Style="{StaticResource SubtleCaptionTextStyle}" />
                                </StackPanel>
                            </Border>
                        </UniformGrid>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 1" Foreground="{StaticResource PerfAccentBrush}" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Power plan" Style="{StaticResource SectionHeaderTextStyle}" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="{Binding PowerPlanDetails}" Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Enable Ultimate plan" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding EnableUltimatePlanCommand}" Margin="0,0,10,0" />
                            <Button Content="Restore previous plan" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestorePowerPlanCommand}" />
                        </StackPanel>

                        <Border Margin="0,12,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Active plan" Foreground="#A5F3FC" FontSize="12" />
                                <TextBlock Margin="0,2,0,0" Text="{Binding PowerPlanHeadline}" Foreground="#E5E7EB" FontSize="14" FontWeight="SemiBold" />
                                <TextBlock Margin="0,2,0,0" Text="{Binding PowerPlanDetails}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="{Binding LastPowerPlanBackupPath}" Foreground="#9CA3AF" FontSize="11" TextWrapping="Wrap" Visibility="{Binding HasPowerPlanBackup, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                <TextBlock Margin="0,6,0,0" Text="Backups live at %ProgramData%/TidyWindow/PerformanceLab/powerplan-state.json." Foreground="#93A3BC" FontSize="11" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource StatusChipStyle}">
                                <StackPanel>
                                    <TextBlock Text="{Binding PowerPlanStatusMessage}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                                    <TextBlock Text="{Binding PowerPlanStatusTimestamp}" Foreground="#9CA3AF" FontSize="11" />
                                </StackPanel>
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 2" Foreground="#A5B4FC" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Service templates" Style="{StaticResource SectionHeaderTextStyle}" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Disable telemetry, Xbox, and other consumer services with reversible templates." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <ListBox ItemsSource="{Binding Templates}" SelectedItem="{Binding SelectedTemplate, Mode=TwoWay}" Margin="0,8,0,0" Background="#0E1C30" BorderBrush="#1F2E46" Foreground="#E5E7EB">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Margin" Value="4" />
                                    <Setter Property="Padding" Value="8" />
                                    <Setter Property="Background" Value="Transparent" />
                                    <Setter Property="BorderThickness" Value="1" />
                                    <Setter Property="BorderBrush" Value="#1F2E46" />
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="BorderBrush" Value="{StaticResource PerfAccentBrush}" />
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#11243A" />
                                            <Setter Property="BorderBrush" Value="{StaticResource PerfAccentBrush}" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Vertical">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                                            <Border Margin="8,0,0,0" Padding="8,3" Background="#12263C" CornerRadius="10">
                                                <TextBlock Text="{Binding ServiceCount}" Foreground="#93C5FD" FontSize="11" />
                                            </Border>
                                        </StackPanel>
                                        <TextBlock Text="{Binding Description}" Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                            <Button Content="Apply template" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding ApplyServiceTemplateCommand}" CommandParameter="{Binding SelectedTemplate}" Margin="0,0,10,0" />
                            <Button Content="Restore services" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestoreServicesCommand}" />
                        </StackPanel>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="{Binding ServicesDetails}" Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="{Binding LastServiceBackupPath}" Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" Visibility="{Binding HasServiceBackup, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource ServiceStatusChipStyle}">
                                <StackPanel>
                                    <TextBlock Text="{Binding ServiceStatusMessage}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                                    <TextBlock Text="{Binding ServiceStatusTimestamp}" Foreground="#9CA3AF" FontSize="11" />
                                </StackPanel>
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 3" Foreground="#F97316" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Hardware reserved memory" Style="{StaticResource SectionHeaderTextStyle}" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Detect misreported RAM, clear truncatememory/maxmem flags, and control memory compression." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Detect reserved memory" Style="{StaticResource OutlineButtonStyle}" Command="{Binding DetectHardwareReservedCommand}" Margin="0,0,10,0" />
                            <Button Content="Apply fixer" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding ApplyHardwareFixCommand}" Margin="0,0,10,0" />
                            <Button Content="Restore compression" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestoreCompressionCommand}" />
                        </StackPanel>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Keeps BCD memory caps clear and disables memory compression by request. Use detect first to understand current state." Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="Reminder: msconfig > Boot > Advanced options should have Maximum memory unchecked." Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource HardwareStatusChipStyle}">
                                <StackPanel>
                                    <TextBlock Text="{Binding HardwareStatusMessage}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                                    <TextBlock Text="{Binding HardwareStatusTimestamp}" Foreground="#9CA3AF" FontSize="11" />
                                </StackPanel>
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Style="{StaticResource StepBadgeStyle}">
                                <TextBlock Text="Step 4" Foreground="#22D3EE" FontWeight="Bold" />
                            </Border>
                            <TextBlock Text="Kernel &amp; boot controls" Style="{StaticResource SectionHeaderTextStyle}" />
                        </StackPanel>
                        <TextBlock Margin="0,4,0,8" Text="Apply timer and boot tweaks with restore-point gating: dynamic tick, platform clock, tscsyncpolicy, and linearaddress57." Style="{StaticResource SubtleCaptionTextStyle}" />

                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Apply recommended preset" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding ApplyKernelPresetCommand}" Margin="0,0,10,0" />
                            <Button Content="Restore defaults" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestoreKernelDefaultsCommand}" />
                        </StackPanel>

                        <Border Margin="0,10,0,0" Padding="12" CornerRadius="12" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Recommended preset sets disabledynamictick, enables platform clock, sets tscsyncpolicy Enhanced, and toggles linearaddress57 for >128GB rigs." Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Margin="0,4,0,0" Text="Restore defaults removes those BCD values. A restore point is attempted before apply." Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource KernelStatusChipStyle}">
                                <StackPanel>
                                    <TextBlock Text="{Binding KernelStatusMessage}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                                    <TextBlock Text="{Binding KernelStatusTimestamp}" Foreground="#9CA3AF" FontSize="11" />
                                </StackPanel>
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
