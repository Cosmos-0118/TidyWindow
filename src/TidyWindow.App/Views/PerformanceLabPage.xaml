<Page x:Class="TidyWindow.App.Views.PerformanceLabPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d"
      Title="Performance Lab"
      Background="Transparent"
      UseLayoutRounding="True"
      SnapsToDevicePixels="True"
      TextOptions.TextFormattingMode="Display"
      TextOptions.TextRenderingMode="ClearType"
      TextOptions.TextHintingMode="Fixed"
      RenderOptions.BitmapScalingMode="HighQuality">
    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

        <LinearGradientBrush x:Key="PerfHeroBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#0A1F36" Offset="0" />
            <GradientStop Color="#0D2740" Offset="0.45" />
            <GradientStop Color="#0B334A" Offset="1" />
        </LinearGradientBrush>

        <SolidColorBrush x:Key="PerfHeroTitleBrush" Color="#F5F7FF" />
        <SolidColorBrush x:Key="PerfHeroBodyBrush" Color="#C6D4EE" />
        <SolidColorBrush x:Key="PerfCardBrush" Color="#0C1424" />
        <SolidColorBrush x:Key="PerfCardBorderBrush" Color="#1B2538" />
        <SolidColorBrush x:Key="PerfChipSuccessBrush" Color="#0F2F25" />
        <SolidColorBrush x:Key="PerfChipWarningBrush" Color="#2C1A1A" />
        <SolidColorBrush x:Key="PerfChipBorderSuccess" Color="#22C55E" />
        <SolidColorBrush x:Key="PerfChipBorderWarning" Color="#F87171" />

        <Style x:Key="HeroTitleTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{StaticResource PerfHeroTitleBrush}" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>

        <Style x:Key="HeroBodyTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="{StaticResource PerfHeroBodyBrush}" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>

        <Style x:Key="ChipStyle" TargetType="Border">
            <Setter Property="Background" Value="#0E1D33" />
            <Setter Property="BorderBrush" Value="#1D3B58" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="Margin" Value="0,0,10,0" />
        </Style>

        <Style x:Key="StatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsPowerPlanSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsPowerPlanSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ServiceStatusChipStyle" TargetType="Border" BasedOn="{StaticResource ChipStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsServiceSuccess}" Value="True">
                    <Setter Property="Background" Value="{StaticResource PerfChipSuccessBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderSuccess}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsServiceSuccess}" Value="False">
                    <Setter Property="Background" Value="{StaticResource PerfChipWarningBrush}" />
                    <Setter Property="BorderBrush" Value="{StaticResource PerfChipBorderWarning}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="#07111D" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root" CornerRadius="12" Padding="{TemplateBinding Padding}">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#34D399" Offset="0" />
                                    <GradientStop Color="#22C55E" Offset="1" />
                                </LinearGradientBrush>
                            </Border.Background>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.01" ScaleY="1.01" />
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="OutlineButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="#E2E8F0" />
            <Setter Property="Background" Value="#0E1A2C" />
            <Setter Property="BorderBrush" Value="#1F2E46" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="BorderBrush" Value="#38BDF8" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.55" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource PerfCardBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource PerfCardBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,0,12" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="UseLayoutRounding" Value="True" />
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.Style>
            <Style TargetType="Grid">
                <Setter Property="Opacity" Value="1" />
                <Setter Property="IsHitTestVisible" Value="True" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsBusy}" Value="True">
                        <Setter Property="Opacity" Value="0.5" />
                        <Setter Property="IsHitTestVisible" Value="False" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Grid.Style>

        <Grid Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Border Grid.Row="0"
                    Background="{StaticResource PerfHeroBrush}"
                    Padding="20"
                    CornerRadius="16"
                    BorderThickness="1"
                    BorderBrush="#12314A">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <StackPanel>
                        <TextBlock Text="Performance Lab" Style="{StaticResource HeroTitleTextStyle}" />
                        <TextBlock Margin="0,6,0,0" Text="Launch-style cockpit for high-impact tweaks with backups and rollbacks." Style="{StaticResource HeroBodyTextStyle}" />
                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource ChipStyle}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Plan" Foreground="#A5F3FC" FontWeight="SemiBold" />
                                    <TextBlock Margin="6,0,0,0" Text="status" Foreground="#A5F3FC" />
                                    <TextBlock Margin="10,0,0,0" Text="â€¢" Foreground="#334155" />
                                    <TextBlock Margin="6,0,0,0" Text="{Binding PowerPlanHeadline}" Foreground="{StaticResource PerfHeroTitleBrush}" />
                                </StackPanel>
                            </Border>
                            <Border Style="{StaticResource ChipStyle}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Service backup" Foreground="#FACC15" FontWeight="SemiBold" />
                                    <TextBlock Margin="8,0,0,0" Text="{Binding ServicesDetails}" Foreground="{StaticResource PerfHeroTitleBrush}" />
                                </StackPanel>
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" Margin="0,0,10,0">
                            <ProgressBar Width="90" Height="8" IsIndeterminate="True" Foreground="#38BDF8" Background="#0E1C30" BorderBrush="#1F2E46" />
                            <TextBlock Text="Working..." Margin="8,0,0,0" Foreground="#E5E7EB" FontSize="12" VerticalAlignment="Center" />
                        </StackPanel>
                        <Button Content="Refresh" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RefreshCommand}" Margin="0,0,10,0" />
                        <TextBlock Text="Guarded tweaks only" Foreground="#C6D4EE" FontSize="12" VerticalAlignment="Center" />
                    </StackPanel>
                </Grid>
            </Border>

            <Border Grid.Row="1"
                    Background="#0E1A2C"
                    BorderBrush="#1B2538"
                    BorderThickness="1"
                    CornerRadius="12"
                    Padding="14"
                    Margin="0,16,0,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,12,0">
                        <TextBlock Text="Power plan" FontSize="16" FontWeight="SemiBold" Foreground="#E5E7EB" />
                        <TextBlock Margin="0,4,0,0" Text="{Binding PowerPlanDetails}" Foreground="#C6D4EE" FontSize="12" />
                        <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                            <Button Content="Enable Ultimate plan" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding EnableUltimatePlanCommand}" Margin="0,0,10,0" />
                            <Button Content="Restore previous plan" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestorePowerPlanCommand}" />
                        </StackPanel>
                        <TextBlock Margin="0,10,0,0" Text="Keeps a backup of your current scheme at %ProgramData%/TidyWindow/PerformanceLab/powerplan-state.json." Foreground="#93A3BC" FontSize="12" TextWrapping="Wrap" />
                        <TextBlock Margin="0,4,0,0" Text="Active plan" Foreground="#A5F3FC" FontSize="12" />
                        <Border Margin="0,4,0,0" Padding="10" CornerRadius="10" Background="#0F1C2F" BorderBrush="#1F2E46" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="{Binding PowerPlanHeadline}" Foreground="#E5E7EB" FontSize="14" FontWeight="SemiBold" />
                                <TextBlock Text="{Binding PowerPlanDetails}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                                <TextBlock Text="{Binding LastPowerPlanBackupPath}" Foreground="#9CA3AF" FontSize="11" TextWrapping="Wrap" Visibility="{Binding HasPowerPlanBackup, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            </StackPanel>
                        </Border>
                        <WrapPanel Margin="0,10,0,0">
                            <Border Style="{StaticResource StatusChipStyle}">
                                <StackPanel>
                                    <TextBlock Text="{Binding PowerPlanStatusMessage}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                                    <TextBlock Text="{Binding PowerPlanStatusTimestamp}" Foreground="#9CA3AF" FontSize="11" />
                                </StackPanel>
                            </Border>
                        </WrapPanel>
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                        <TextBlock Text="Service templates" FontSize="16" FontWeight="SemiBold" Foreground="#E5E7EB" />
                        <TextBlock Margin="0,4,0,0" Text="Disable telemetry/Xbox/consumer services with backups you can restore." Foreground="#C6D4EE" FontSize="12" />
                        <ListBox ItemsSource="{Binding Templates}" SelectedItem="{Binding SelectedTemplate, Mode=TwoWay}" Margin="0,8,0,0" Background="#0E1C30" BorderBrush="#1F2E46" Foreground="#E5E7EB">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Margin" Value="4" />
                                    <Setter Property="Padding" Value="6" />
                                    <Setter Property="Background" Value="Transparent" />
                                    <Setter Property="BorderThickness" Value="1" />
                                    <Setter Property="BorderBrush" Value="#1F2E46" />
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#11243A" />
                                            <Setter Property="BorderBrush" Value="#38BDF8" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Vertical">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                                            <Border Margin="8,0,0,0" Padding="6,2" Background="#12263C" CornerRadius="8">
                                                <TextBlock Text="{Binding ServiceCount}" Foreground="#93C5FD" FontSize="11" />
                                            </Border>
                                        </StackPanel>
                                        <TextBlock Text="{Binding Description}" Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                        <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                            <Button Content="Apply template" Style="{StaticResource PrimaryButtonStyle}" Command="{Binding ApplyServiceTemplateCommand}" CommandParameter="{Binding SelectedTemplate}" Margin="0,0,10,0" />
                            <Button Content="Restore services" Style="{StaticResource OutlineButtonStyle}" Command="{Binding RestoreServicesCommand}" />
                        </StackPanel>
                        <TextBlock Margin="0,6,0,0" Text="{Binding ServicesDetails}" Foreground="#9CA3AF" FontSize="12" TextWrapping="Wrap" />
                        <TextBlock Margin="0,2,0,0" Text="{Binding LastServiceBackupPath}" Foreground="#6B7280" FontSize="11" TextWrapping="Wrap" Visibility="{Binding HasServiceBackup, Converter={StaticResource BooleanToVisibilityConverter}}" />
                        <WrapPanel Margin="0,8,0,0">
                            <Border Style="{StaticResource ServiceStatusChipStyle}">
                                <StackPanel>
                                    <TextBlock Text="{Binding ServiceStatusMessage}" Foreground="#C6D4EE" FontSize="12" TextWrapping="Wrap" />
                                    <TextBlock Text="{Binding ServiceStatusTimestamp}" Foreground="#9CA3AF" FontSize="11" />
                                </StackPanel>
                            </Border>
                        </WrapPanel>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>
