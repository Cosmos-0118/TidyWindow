<Page x:Class="TidyWindow.App.Views.PathPilotPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="clr-namespace:TidyWindow.App.Views"
    xmlns:converters="clr-namespace:TidyWindow.App.Converters"
    xmlns:vm="clr-namespace:TidyWindow.App.ViewModels"
    xmlns:ux="clr-namespace:TidyWindow.App.Controls"
      Title="PathPilot"
      mc:Ignorable="d"
      Background="Transparent"
      UseLayoutRounding="True"
      SnapsToDevicePixels="True"
      TextOptions.TextFormattingMode="Display"
      TextOptions.TextRenderingMode="ClearType"
      TextOptions.TextHintingMode="Fixed"
      RenderOptions.BitmapScalingMode="HighQuality">

    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:PathPilotStatusSeverityToBrushConverter x:Key="SeverityBrush" />

        <SolidColorBrush x:Key="CardBackground" Color="#0C1729" />
        <SolidColorBrush x:Key="CardBorder" Color="#1E2A3D" />
        <SolidColorBrush x:Key="BadgeForeground" Color="#F8FAFC" />

        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBackground}" />
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="14" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="UseLayoutRounding" Value="True" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="#3A6FA8" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Foreground" Value="#0B1220" />
            <Setter Property="Background" Value="#34D399" />
            <Setter Property="Padding" Value="14,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Opacity" Value="0.9" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.5" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Foreground" Value="#E2E8F0" />
            <Setter Property="Background" Value="#142033" />
            <Setter Property="BorderBrush" Value="#26344D" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#1B2C48" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.5" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryToggleButton" TargetType="ToggleButton">
            <Setter Property="Foreground" Value="#E2E8F0" />
            <Setter Property="Background" Value="#142033" />
            <Setter Property="BorderBrush" Value="#26344D" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#1B2C48" />
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="#1B2C48" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.5" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="BadgeStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="Margin" Value="0,0,8,0" />
            <Setter Property="Background" Value="#0F172A" />
        </Style>

        <DataTemplate x:Key="RuntimeCardTemplate" DataType="{x:Type vm:PathPilotRuntimeCardViewModel}">
            <Border Style="{StaticResource CardStyle}" MinWidth="440" MaxWidth="760" Padding="22">
                <StackPanel>
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement">
                            <Setter Property="Margin" Value="0,0,0,12" />
                        </Style>
                    </StackPanel.Resources>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <StackPanel.Resources>
                            <Style TargetType="FrameworkElement">
                                <Setter Property="Margin" Value="0,0,12,0" />
                            </Style>
                        </StackPanel.Resources>
                        <TextBlock Text="{Binding FriendlyName}"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="#F8FAFC"
                                   TextTrimming="CharacterEllipsis"
                                   MaxWidth="340" />
                        <ItemsControl ItemsSource="{Binding StatusBadges}" Margin="10,0,0,0">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource BadgeStyle}"
                                            Background="{Binding Severity, Converter={StaticResource SeverityBrush}}">
                                        <TextBlock Text="{Binding Label}"
                                                   Foreground="{StaticResource BadgeForeground}"
                                                   FontSize="11"
                                                   FontWeight="SemiBold" />
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,4,0,8">
                        <StackPanel.Resources>
                            <Style TargetType="FrameworkElement">
                                <Setter Property="Margin" Value="0,0,12,0" />
                            </Style>
                        </StackPanel.Resources>
                        <Border Style="{StaticResource BadgeStyle}" Background="#0B2538">
                            <TextBlock Text="{Binding VersionChipLabel}" Foreground="#7DD3FC" FontSize="12" FontWeight="SemiBold" />
                        </Border>
                    </StackPanel>

                    <Border Background="#0F172A" BorderBrush="#1F2E46" BorderThickness="1" CornerRadius="12" Padding="14" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="Current version"
                                       Foreground="#9CA3AF"
                                       FontWeight="SemiBold"
                                       FontSize="12" />
                            <TextBlock Text="{Binding VersionChipLabel}" Foreground="#E2E8F0" TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>

                    <Grid Margin="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Button Content="Switch" Style="{StaticResource PrimaryButton}" MinWidth="96" HorizontalAlignment="Stretch" Margin="0,0,10,0"
                                Command="{Binding DataContext.ShowInstallationsCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                CommandParameter="{Binding}" IsEnabled="{Binding HasInstallations}" />
                        <Button Grid.Column="1" Content="Details" Style="{StaticResource SecondaryButton}" MinWidth="96" HorizontalAlignment="Stretch" Margin="0,0,10,0"
                                Command="{Binding DataContext.ShowDetailsCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                CommandParameter="{Binding}" />
                        <Button Grid.Column="2" Content="Order" Style="{StaticResource SecondaryButton}" MinWidth="96" HorizontalAlignment="Stretch"
                                Command="{Binding DataContext.ShowResolutionOrderCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                CommandParameter="{Binding}" IsEnabled="{Binding HasResolutionOrder}" />
                    </Grid>
                </StackPanel>
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="InstallationTemplate" DataType="{x:Type vm:PathPilotInstallationViewModel}">
            <Border Padding="20" Margin="0,0,0,14">
                <Border.Style>
                    <Style TargetType="Border" BasedOn="{StaticResource CardStyle}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsActive}" Value="True">
                                <Setter Property="Background" Value="#0F1F18" />
                                <Setter Property="BorderBrush" Value="#2F6F55" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="3*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Margin="0,6,16,0">
                        <StackPanel.Resources>
                            <Style TargetType="FrameworkElement">
                                <Setter Property="Margin" Value="0,0,0,8" />
                            </Style>
                        </StackPanel.Resources>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="{Binding VersionDisplay}" FontSize="16" FontWeight="SemiBold" Foreground="#F8FAFC" Margin="0,0,0,6" />
                            <Border Grid.Column="1" Background="#1E2B45" CornerRadius="12" Padding="12,7" Margin="14,0,0,0" VerticalAlignment="Center"
                                    Visibility="{Binding IsActive, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="Active" Foreground="#9BE7C4" FontSize="12" FontWeight="SemiBold" />
                            </Border>
                        </Grid>

                        <TextBlock Text="{Binding Directory}" Foreground="#A5B4FC" FontSize="12" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" />

                        <StackPanel Orientation="Horizontal" Margin="0,6,0,2">
                            <StackPanel.Resources>
                                <Style TargetType="FrameworkElement">
                                    <Setter Property="Margin" Value="0,0,6,0" />
                                </Style>
                            </StackPanel.Resources>
                            <Border Style="{StaticResource BadgeStyle}" Background="#0B2538">
                                <TextBlock Text="{Binding Source}" Foreground="#7DD3FC" FontSize="11" />
                            </Border>
                            <Border Style="{StaticResource BadgeStyle}" Background="#0B1F34">
                                <TextBlock Text="{Binding Architecture}" Foreground="#C084FC" FontSize="11" />
                            </Border>
                        </StackPanel>

                        <Border Background="#1A253A" BorderBrush="#26344D" BorderThickness="1" CornerRadius="10" Padding="10"
                                Visibility="{Binding HasNotes, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="{Binding NotesDisplay}" Foreground="#FDE047" FontSize="11" TextWrapping="Wrap" />
                        </Border>
                    </StackPanel>

                    <StackPanel Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="14,0,0,0">
                        <StackPanel.Resources>
                            <Style TargetType="FrameworkElement">
                                <Setter Property="Margin" Value="0,0,0,12" />
                            </Style>
                        </StackPanel.Resources>
                        <Button Content="Make active" Style="{StaticResource SecondaryButton}" Padding="14,12" MinWidth="158" HorizontalAlignment="Stretch"
                                Command="{Binding DataContext.SwitchRuntimeCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                CommandParameter="{Binding SwitchRequest}" IsEnabled="{Binding CanSwitch}" />
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>
    </Page.Resources>

    <Grid>
          <Grid x:Name="PageContentGrid"
              MinWidth="0"
              MaxWidth="1520"
              HorizontalAlignment="Center"
              Margin="40">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <ScrollViewer Grid.RowSpan="2" VerticalScrollBarVisibility="Auto" Padding="4,0,4,24">
                <StackPanel Orientation="Vertical">
                    <controls:PageTitleBar
                                   Title="PathPilot"
                                   Subtitle="Runtime PATH switchboard"
                                   IconGlyph="ðŸ›°ï¸"
                                   BadgeText="{Binding LastRefreshedDisplay}"
                                   Margin="0,0,0,18">
                        <controls:PageTitleBar.TrailingContent>
                            <StackPanel Orientation="Horizontal" Margin="0,0,10,0">
                                <Button Content="Refresh" Style="{StaticResource PrimaryButton}" Command="{Binding RefreshCommand}" Margin="0,0,20,0" />
                                <Button Content="Export JSON" Style="{StaticResource SecondaryButton}" Command="{Binding ExportJsonCommand}" Margin="0,0,20,0" />
                                <Button Content="Export Markdown" Style="{StaticResource SecondaryButton}" Command="{Binding ExportMarkdownCommand}" />
                            </StackPanel>
                        </controls:PageTitleBar.TrailingContent>
                        <controls:PageTitleBar.BodyContent>
                            <Border Style="{StaticResource CardStyle}" Padding="20" Background="#0F1F35">
                                <StackPanel>
                                    <StackPanel.Resources>
                                        <Style TargetType="FrameworkElement">
                                            <Setter Property="Margin" Value="0,0,0,8" />
                                        </Style>
                                    </StackPanel.Resources>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                        <StackPanel.Resources>
                                            <Style TargetType="FrameworkElement">
                                                <Setter Property="Margin" Value="0,0,10,0" />
                                            </Style>
                                        </StackPanel.Resources>
                                        <TextBlock Text="PathPilot" FontSize="18" FontWeight="SemiBold" Foreground="#F8FAFC" />
                                        <Button Content="Details" Style="{StaticResource SecondaryButton}" Padding="12,6" Margin="8,0,0,0" VerticalAlignment="Center"
                                                Command="{Binding ShowPageInfoCommand}" />
                                    </StackPanel>
                                    <TextBlock Text="Switch runtimes that own PATH without the clutter."
                                               Foreground="#CBD5E1" Margin="0,6,0,0" />
                                    <StackPanel Visibility="{Binding ShowPathPilotHero, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel.Resources>
                                            <Style TargetType="FrameworkElement">
                                                <Setter Property="Margin" Value="0,0,0,4" />
                                            </Style>
                                        </StackPanel.Resources>
                                        <TextBlock Text="PathPilot updates HKLM + machine PATH, affecting all accounts." Foreground="#E2E8F0" FontSize="12" />
                                        <TextBlock Text="Snapshot is taken before edits; confirm destinations before switching." Foreground="#A5B4FC" FontSize="11" />
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </controls:PageTitleBar.BodyContent>
                    </controls:PageTitleBar>

                    <StackPanel x:Name="MainLayoutHost" Margin="0,0,0,8" Orientation="Vertical">
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement">
                            <Setter Property="Margin" Value="0,0,0,20" />
                        </Style>
                    </StackPanel.Resources>
                    <Border Style="{StaticResource CardStyle}" Background="#102038" Padding="22" Margin="0,0,0,6">
                        <StackPanel>
                            <StackPanel.Resources>
                                <Style TargetType="FrameworkElement">
                                    <Setter Property="Margin" Value="0,0,0,8" />
                                </Style>
                            </StackPanel.Resources>
                            <TextBlock Text="Switch without surprises" FontSize="15" FontWeight="SemiBold" Foreground="#F8FAFC" />
                            <TextBlock Text="Review a runtime, then switch. Click Details for the deeper view." Foreground="#A5B4FC" FontSize="12" />
                        </StackPanel>
                    </Border>

                    <ListBox x:Name="RuntimesList"
                             ItemsSource="{Binding PagedRuntimes}"
                             Loaded="OnRuntimesLoaded"
                             Background="Transparent"
                             BorderThickness="0"
                             Foreground="#F8FAFC"
                             ItemTemplate="{StaticResource RuntimeCardTemplate}"
                             ScrollViewer.VerticalScrollBarVisibility="Disabled"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             ScrollViewer.CanContentScroll="True"
                             VirtualizingPanel.IsVirtualizing="True"
                             VirtualizingPanel.VirtualizationMode="Recycling"
                             SelectionMode="Single">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ux:VirtualizingAdaptiveTilePanel MinColumnWidth="440" MaxColumnWidth="780" MinColumns="1" MaxColumns="3" ColumnSpacing="28" RowSpacing="24" />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="0" />
                                <Setter Property="Margin" Value="0" />
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                <Setter Property="VerticalContentAlignment" Value="Stretch" />
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="BorderThickness" Value="0" />
                                <Setter Property="Focusable" Value="False" />
                            </Style>
                        </ListBox.ItemContainerStyle>
                    </ListBox>

                    <Border>
                        <Border.Style>
                            <Style TargetType="Border" BasedOn="{StaticResource CardStyle}">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding HasRuntimeData}" Value="False">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        <StackPanel>
                            <StackPanel.Resources>
                                <Style TargetType="FrameworkElement">
                                    <Setter Property="Margin" Value="0,0,0,6" />
                                </Style>
                            </StackPanel.Resources>
                            <TextBlock Text="No runtime inventory yet" FontSize="14" FontWeight="SemiBold" Foreground="#F8FAFC" />
                            <TextBlock Text="Run a scan to capture Python, JDK, Node, and .NET footprints before switching." Foreground="#94A3B8" FontSize="12" TextWrapping="Wrap" />
                            <Button Content="Scan runtimes" Style="{StaticResource PrimaryButton}" Width="150" Command="{Binding RefreshCommand}" />
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource CardStyle}" Visibility="{Binding HasWarnings, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel>
                            <StackPanel.Resources>
                                <Style TargetType="FrameworkElement">
                                    <Setter Property="Margin" Value="0,0,0,10" />
                                </Style>
                            </StackPanel.Resources>
                            <TextBlock Text="Warnings" FontSize="14" FontWeight="SemiBold" Foreground="#F8FAFC" />
                            <ItemsControl ItemsSource="{Binding Warnings}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#2F1F1F" BorderBrush="#F87171" BorderThickness="1" CornerRadius="8" Padding="10" Margin="0,0,0,8">
                                            <TextBlock Text="{Binding}" Foreground="#FECACA" TextWrapping="Wrap" />
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"
                                Visibility="{Binding HasMultiplePages, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel.Resources>
                            <Style TargetType="FrameworkElement">
                                <Setter Property="Margin" Value="0,0,10,0" />
                            </Style>
                        </StackPanel.Resources>
                        <TextBlock Text="{Binding PageDisplay}" Foreground="#C6D4EE" FontSize="12" VerticalAlignment="Center" />
                        <Button Content="Prev" Style="{StaticResource SecondaryButton}" Command="{Binding GoToPreviousPageCommand}" IsEnabled="{Binding CanGoToPreviousPage}" />
                        <Button Content="Next" Style="{StaticResource SecondaryButton}" Command="{Binding GoToNextPageCommand}" IsEnabled="{Binding CanGoToNextPage}" />
                    </StackPanel>
                </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <Grid Background="#880B172A" Visibility="{Binding IsInventoryLoading, Converter={StaticResource BooleanToVisibilityConverter}}" Panel.ZIndex="10">
            <Border Background="#0F172A" Padding="22" CornerRadius="14" BorderBrush="#1F2E46" BorderThickness="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement">
                            <Setter Property="Margin" Value="0,0,0,8" />
                        </Style>
                    </StackPanel.Resources>
                    <TextBlock Text="Collecting runtime inventory..." Foreground="#E2E8F0" FontWeight="SemiBold" />
                    <ProgressBar IsIndeterminate="True" Height="6" Width="220" />
                </StackPanel>
            </Border>
        </Grid>

        <Grid Background="#880B172A" Visibility="{Binding IsSwitchingPath, Converter={StaticResource BooleanToVisibilityConverter}}" Panel.ZIndex="16">
            <Border Background="#0F172A" Padding="22" CornerRadius="14" BorderBrush="#1F2E46" BorderThickness="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement">
                            <Setter Property="Margin" Value="0,0,0,8" />
                        </Style>
                    </StackPanel.Resources>
                    <TextBlock Text="Switching PATH winner..." Foreground="#E2E8F0" FontWeight="SemiBold" />
                    <ProgressBar IsIndeterminate="True" Height="6" Width="200" />
                </StackPanel>
            </Border>
        </Grid>

        <Grid Background="#B30B172A" Visibility="{Binding IsMachineScopeWarningOpen, Converter={StaticResource BooleanToVisibilityConverter}}" Panel.ZIndex="14">
            <Border Background="#0D1A2F" Padding="28" CornerRadius="18" BorderBrush="#2A3C5C" BorderThickness="1" MaxWidth="680" HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement">
                            <Setter Property="Margin" Value="0,0,0,10" />
                        </Style>
                    </StackPanel.Resources>
                    <TextBlock Text="Machine-wide change" FontSize="18" FontWeight="SemiBold" Foreground="#F8FAFC" />
                    <TextBlock Text="PathPilot will update HKLM + system PATH. This affects every Windows account." Foreground="#CBD5E1" TextWrapping="Wrap" />
                    <TextBlock Text="Proceed only if you trust the destination you're promoting." Foreground="#A5B4FC" TextWrapping="Wrap" />
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <StackPanel.Resources>
                            <Style TargetType="FrameworkElement">
                                <Setter Property="Margin" Value="0,0,10,0" />
                            </Style>
                        </StackPanel.Resources>
                        <Button Content="Cancel" Style="{StaticResource SecondaryButton}" Command="{Binding CancelMachineScopeWarningCommand}" MinWidth="110" />
                        <Button Content="Switch now" Style="{StaticResource PrimaryButton}" Command="{Binding DismissMachineScopeWarningCommand}" MinWidth="130" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <Grid Background="#880B172A" Visibility="{Binding IsInstallationsDialogOpen, Converter={StaticResource BooleanToVisibilityConverter}}" Panel.ZIndex="12">
            <Border Background="#0B1322" Padding="30" CornerRadius="18" BorderBrush="#1F2E46" BorderThickness="1" MaxWidth="960" HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement">
                            <Setter Property="Margin" Value="0,0,0,12" />
                        </Style>
                    </StackPanel.Resources>
                    <TextBlock Text="Available PATH targets" FontSize="18" FontWeight="SemiBold" Foreground="#F8FAFC" Margin="0,0,0,6" />
                    <TextBlock Text="Pick the installation to promote. PathPilot will back up the current PATH entry." Foreground="#CBD5E1" FontSize="12" TextWrapping="Wrap" Margin="0,0,0,10" />
                    <ScrollViewer MaxHeight="520" VerticalScrollBarVisibility="Auto" Margin="0,6,0,0" Padding="4,4,8,6">
                        <ItemsControl ItemsSource="{Binding InstallationsDialogRuntime.Installations}" ItemTemplate="{StaticResource InstallationTemplate}" Margin="0,0,6,0">
                            <ItemsControl.ItemContainerStyle>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="Margin" Value="0,0,0,8" />
                                </Style>
                            </ItemsControl.ItemContainerStyle>
                        </ItemsControl>
                    </ScrollViewer>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                        <Button Content="Close" Style="{StaticResource SecondaryButton}" Command="{Binding CloseInstallationsCommand}" MinWidth="110" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <Grid Background="#880B172A" Visibility="{Binding IsDetailsDialogOpen, Converter={StaticResource BooleanToVisibilityConverter}}" Panel.ZIndex="12">
            <Border Background="#0B1322" Padding="30" CornerRadius="18" BorderBrush="#1F2E46" BorderThickness="1" MaxWidth="960" HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement">
                            <Setter Property="Margin" Value="0,0,0,12" />
                        </Style>
                    </StackPanel.Resources>
                    <TextBlock Text="Runtime details" FontSize="18" FontWeight="SemiBold" Foreground="#F8FAFC" />
                    <TextBlock Text="{Binding DetailsDialogRuntime.Summary}" Foreground="#E2E8F0" TextWrapping="Wrap" />
                    <Border Background="#0F1F35" BorderBrush="#1F2E46" BorderThickness="1" CornerRadius="12" Padding="16" Margin="0,6,0,10">
                        <StackPanel>
                            <TextBlock Text="Active executable" FontWeight="SemiBold" Foreground="#CBD5E1" />
                            <TextBlock Text="{Binding DetailsDialogRuntime.ActiveExecutablePath}" Foreground="#E2E8F0" TextWrapping="Wrap" />
                            <TextBlock Text="PATH entry" FontWeight="SemiBold" Foreground="#CBD5E1" Margin="0,8,0,0" />
                            <TextBlock Text="{Binding DetailsDialogRuntime.PathEntry}" Foreground="#E2E8F0" TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>
                    <TextBlock Text="Installations" FontWeight="SemiBold" Foreground="#CBD5E1" />
                    <ItemsControl ItemsSource="{Binding DetailsDialogRuntime.Installations}" ItemTemplate="{StaticResource InstallationTemplate}" Margin="0,0,0,4" />
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
                        <Button Content="Close" Style="{StaticResource SecondaryButton}" Command="{Binding CloseDetailsCommand}" MinWidth="110" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <Grid Background="#880B172A" Visibility="{Binding IsResolutionDialogOpen, Converter={StaticResource BooleanToVisibilityConverter}}" Panel.ZIndex="12">
            <Border Background="#0B1322" Padding="26" CornerRadius="18" BorderBrush="#1F2E46" BorderThickness="1" MaxWidth="800" HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement">
                            <Setter Property="Margin" Value="0,0,0,10" />
                        </Style>
                    </StackPanel.Resources>
                    <TextBlock Text="PATH resolution order" FontSize="17" FontWeight="SemiBold" Foreground="#F8FAFC" />
                    <ScrollViewer MaxHeight="360" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding ResolutionDialogRuntime.ResolutionOrder}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource CardStyle}" Padding="12" Margin="0,0,0,10">
                                        <TextBlock Text="{Binding}" Foreground="#E2E8F0" TextWrapping="Wrap" />
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
                        <Button Content="Close" Style="{StaticResource SecondaryButton}" Command="{Binding CloseResolutionOrderCommand}" MinWidth="110" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <Grid Background="#880B172A" Visibility="{Binding IsPageInfoOpen, Converter={StaticResource BooleanToVisibilityConverter}}" Panel.ZIndex="13">
            <Border Background="#0B1322" Padding="28" CornerRadius="18" BorderBrush="#1F2E46" BorderThickness="1" MaxWidth="720" HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <StackPanel.Resources>
                        <Style TargetType="FrameworkElement">
                            <Setter Property="Margin" Value="0,0,0,10" />
                        </Style>
                    </StackPanel.Resources>
                    <TextBlock Text="About PathPilot" FontSize="18" FontWeight="SemiBold" Foreground="#F8FAFC" Margin="0,0,0,6" />
                    <TextBlock Text="PathPilot promotes one runtime to the machine PATH so every user session and shell resolves that toolchain consistently." Foreground="#CBD5E1" TextWrapping="Wrap" Margin="0,0,0,12" />
                    <TextBlock Text="How it works" FontWeight="SemiBold" Foreground="#CBD5E1" Margin="0,0,0,6" />
                    <ItemsControl>
                        <ItemsControl.Items>
                            <TextBlock Text="1) Inventory finds installed runtimes (Python, .NET, Node, JDK, etc.)." Foreground="#E2E8F0" TextWrapping="Wrap" />
                            <TextBlock Text="2) Switch lets you pick an installation to promote; PathPilot backs up the prior PATH entry." Foreground="#E2E8F0" TextWrapping="Wrap" />
                            <TextBlock Text="3) Details shows active executables, PATH entries, and installation sources for clarity." Foreground="#E2E8F0" TextWrapping="Wrap" />
                            <TextBlock Text="4) Resolution order lists how PATH will resolve if multiple installs exist." Foreground="#E2E8F0" TextWrapping="Wrap" />
                        </ItemsControl.Items>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Margin="0,0,0,6" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Border Background="#0F1F35" BorderBrush="#1F2E46" BorderThickness="1" CornerRadius="12" Padding="14" Margin="0,4,0,14">
                        <StackPanel>
                            <TextBlock Text="Safety" FontWeight="SemiBold" Foreground="#CBD5E1" />
                            <TextBlock Text="Changes are machine-wide (HKLM + system PATH). A snapshot is taken before switching; you can revert via activity log guidance." Foreground="#E2E8F0" TextWrapping="Wrap" />
                        </StackPanel>
                    </Border>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,4,0,0">
                        <Button Content="Close" Style="{StaticResource SecondaryButton}" Command="{Binding ClosePageInfoCommand}" MinWidth="110" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>
