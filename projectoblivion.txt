# Project Oblivion – Focused Deep Clean

## Goal
- Deliver the original deep-clean promise while keeping the UX stripped down: one page, one popup, full wipe.
- The popup owns the entire lifecycle with a PathPilot-style animation so users always know which stage is running.
- Every uninstall still runs the native vendor command, kills related processes, surfaces leftovers, and deletes whatever the user approves.

## Core Experience
- **One list page**: Search/sort installed apps, view size + source badges, hit `Uninstall`. No extra panes.
- **One popup**: Modal stays pinned until the operation finishes. It shows the timeline, checklists, and summary without navigating elsewhere.
- **PathPilot animation**: Borrow the circular pulse animation from PathPilot to show active stage. Timeline chips update below it.
- **User-controlled cleanup**: We gather every leftover (files, folders, registry keys, autoruns, tasks, drivers) and let the user deselect anything before removal.

## Popup Timeline
1. **Kickoff** – Popup opens with app name, version, and uninstall command preview. `Start` begins the run; `Cancel` closes before anything happens.
2. **Default uninstall** – Execute the vendor/uninstall command (winget/choco/scoop/msiexec/Appx). Stream stdout snippets into a collapsible log area. If elevation is required, prompt once.
3. **Process sweep** – Detect running processes/services referencing the install root or package family. Show list with auto-kill toggle and status (`Killed 4/5 processes`).
4. **Artifact discovery** – Scan file system (install root, ProgramData, AppData, Temp), registry (Uninstall, Services, Run, CLSID, App Paths), scheduled tasks, autoruns, drivers, env vars. Group artifacts with counts and select-all checkboxes.
5. **User selection hold** – Timeline pauses so the user can uncheck items (e.g., config files). Provide `Select none`, `Select all`, and search within the checklist.
6. **Cleanup execution** – Delete/remove the selected artifacts in buckets: Files/Folders → Registry → Tasks/Autoruns → Drivers → Misc. Failures remain highlighted with retry links.
7. **Summary** – Present freed space, removed vs skipped artifacts, elapsed time, and `View log` + `Close` buttons. Offer a `Copy summary` action for sharing.

## Technical Notes
- **Inventory**: Keep the consolidated sweep (winget/choco/scoop/Appx + uninstall hives) but add install-root hints, package families, and suspected services so the popup can run without re-querying.
- **Stage runner**: Build `automation/scripts/uninstall-app-deep.ps1` that emits structured JSON events (stage start/finish, log lines, artifact batches). The popup subscribes via PowerShell runspace streaming.
- **Process detection**: Match by path, package family name, window class, and service image path. Use built-in helpers (`Stop-Process`, `Stop-Service`, `taskkill /PID`) with retries.
- **Artifact resolver**: Reuse cleanup heuristics (CleanupPage) but flag each artifact with `Type`, `Path`, `Size`, `Confidence`, `RequiresElevation`.
- **Deletion**: Respect user selection order, request elevation only when needed, and short-circuit on catastrophic failures while keeping logs.
- **Telemetry/logs**: Store run metadata under `data/cleanup/<AppId>/oblivion-run.json` (artifacts found, selected, removed, skipped, failures, durations).

## Implementation Checklist
1. **Inventory enhancements** – Extend `automation/scripts/get-installed-app-footprint.ps1` to output install roots, suspected services/process names, and uninstall metadata.
2. **Deep uninstall script** – Author `automation/scripts/uninstall-app-deep.ps1` that performs: vendor uninstall → process sweep → artifact discovery → cleanup → summary, emitting streaming events for the UI.
3. **Automation helpers** – Expand `automation/modules/TidyWindow.Automation.psm1` with process correlation, artifact scanning, deletion utilities, and structured logging helpers.
4. **View models** – `ProjectOblivionViewModel` for the list, `ProjectOblivionPopupViewModel` for the modal (timeline state, artifact checklist, execute command, summary binding).
5. **UI** – `Views/ProjectOblivionPage.xaml` hosts the list + uninstall button. `Views/ProjectOblivionPopup.xaml` renders the animation ring, timeline chips, log expansion, artifact checklist, summary card.
